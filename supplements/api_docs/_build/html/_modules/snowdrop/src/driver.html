<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>snowdrop.src.driver &#8212; Python Platform 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for snowdrop.src.driver</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Tue Mar 13, 2018</span>
<span class="sd">Driver program of Python framework.</span>

<span class="sd">@author: A.Goumilevski</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.misc.termcolor</span> <span class="kn">import</span> <span class="n">cprint</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.model.factory</span> <span class="kn">import</span> <span class="n">import_model</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.model.model</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">simulationRange</span><span class="p">,</span><span class="n">getPeriods</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.prettyTable</span> <span class="kn">import</span> <span class="n">PrettyTable</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">saveToDatabase</span><span class="p">,</span><span class="n">saveToExcel</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.numeric.solver</span> <span class="kn">import</span> <span class="n">linear_solver</span><span class="p">,</span><span class="n">nonlinear_solver</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.numeric.filters.filter</span> <span class="kn">import</span> <span class="n">linear_filter</span><span class="p">,</span><span class="n">nonlinear_filter</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.graphs.util</span> <span class="kn">import</span> <span class="n">plot</span><span class="p">,</span><span class="n">plotSteadyState</span><span class="p">,</span><span class="n">plotImage</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.graphs.util</span> <span class="kn">import</span> <span class="n">plotEigenValues</span><span class="p">,</span><span class="n">plotDecomposition</span><span class="p">,</span><span class="n">plotHistogram</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.getData</span> <span class="kn">import</span> <span class="n">fetchData</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.numeric.solver</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">getOutputFolderPath</span>

<span class="n">out_dir</span> <span class="o">=</span> <span class="n">getOutputFolderPath</span><span class="p">()</span>
<span class="n">figures_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="s1">&#39;../graphs&#39;</span><span class="p">)))</span>
<span class="n">xl_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">)))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">figures_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">figures_dir</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">xl_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">xl_dir</span><span class="p">)</span>

<div class="viewcode-block" id="setParameters">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.setParameters">[docs]</a>
<span class="k">def</span> <span class="nf">setParameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">Solver</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Smoother</span><span class="p">,</span> 
                  <span class="n">Prior</span><span class="p">,</span> <span class="n">InitCondition</span><span class="p">,</span> <span class="n">SamplingMethod</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set model parameters.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type fname: Model.</span>
<span class="sd">        :param Solver: Solver algorithm.</span>
<span class="sd">        :type Solver: str.</span>
<span class="sd">        :param Filter: KF filter algorithm.</span>
<span class="sd">        :type Filter: str.</span>
<span class="sd">        :param Smoother: KF smoother algorithm.</span>
<span class="sd">        :type Smoother: str.</span>
<span class="sd">        :param Prior: Error covariance matrix estimation method.</span>
<span class="sd">        :type Prior: str.</span>
<span class="sd">        :param InitCondition: Endogenous variables initial condition method.</span>
<span class="sd">        :type InitCondition: str.</span>
<span class="sd">        :param SamplingMethod: Markov Chain Monte Carlo sampling algorithm.</span>
<span class="sd">        :type SamplingMethod: str.</span>
<span class="sd">        :returns:  Instance of Model class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.model.settings</span> <span class="kn">import</span> <span class="n">SmootherAlgorithm</span><span class="p">,</span> <span class="n">FilterAlgorithm</span><span class="p">,</span> <span class="n">SamplingAlgorithm</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.model.settings</span> <span class="kn">import</span> <span class="n">InitialCondition</span><span class="p">,</span> <span class="n">PriorAssumption</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Filter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Filter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span> <span class="o">=</span> <span class="kc">None</span>    
        <span class="k">elif</span> <span class="n">Filter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DURBIN_KOOPMAN&quot;</span><span class="p">:</span>         <span class="c1"># Non-diffuse Kalman Filter</span>
            <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span> <span class="o">=</span> <span class="n">FilterAlgorithm</span><span class="o">.</span><span class="n">Durbin_Koopman</span>
        <span class="k">elif</span> <span class="n">Filter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;NON_DIFFUSE_FILTER&quot;</span><span class="p">:</span>     <span class="c1"># Non diffuse Durbin-Koopman Kalman Filter</span>
            <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span> <span class="o">=</span> <span class="n">FilterAlgorithm</span><span class="o">.</span><span class="n">Non_Diffuse_Filter</span>
        <span class="k">elif</span> <span class="n">Filter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DIFFUSE&quot;</span><span class="p">:</span>                <span class="c1"># Diffuse Kalman Filter (transcription of Dynare code to Python)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span> <span class="o">=</span> <span class="n">FilterAlgorithm</span><span class="o">.</span><span class="n">Diffuse</span>        
        <span class="k">elif</span> <span class="n">Filter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PARTICLE&quot;</span><span class="p">:</span>               <span class="c1"># Particle Filter</span>
            <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span> <span class="o">=</span> <span class="n">FilterAlgorithm</span><span class="o">.</span><span class="n">Particle</span>
        <span class="k">elif</span> <span class="n">Filter</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;UNSCENTED&quot;</span><span class="p">:</span>              <span class="c1"># Unscented Kalman Filter</span>
            <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span> <span class="o">=</span> <span class="n">FilterAlgorithm</span><span class="o">.</span><span class="n">Unscented</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Filter algorithm </span><span class="si">{</span><span class="n">Filter</span><span class="si">}</span><span class="s2"> is not implemented... Resetting to Diffuse algorithm.&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span> 
            <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span> <span class="o">=</span> <span class="n">FilterAlgorithm</span><span class="o">.</span><span class="n">Diffuse</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">Smoother</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Smoother</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">Smoother</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BRYSONFRAZIER&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span> <span class="o">=</span> <span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">BrysonFrazier</span>  
        <span class="k">elif</span> <span class="n">Smoother</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DURBIN_KOOPMAN&quot;</span><span class="p">:</span>         <span class="c1"># Non-diffuse Kalman Smoother</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span> <span class="o">=</span> <span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Durbin_Koopman</span>
        <span class="k">elif</span> <span class="n">Smoother</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DIFFUSE&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span> <span class="o">=</span> <span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Diffuse</span>   
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Smoother algorithm </span><span class="si">{</span><span class="n">Smoother</span><span class="si">}</span><span class="s2"> is not implemented... Resetting to Diffuse algorithm.&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span> <span class="o">=</span> <span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Diffuse</span>  
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">FilterAlgorithm</span><span class="o">.</span><span class="n">Diffuse</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Diffuse</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Smoother </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span><span class="si">}</span><span class="s2"> should be set to </span><span class="si">{</span><span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Diffuse</span><span class="si">}</span><span class="s2">... Resetting.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span> <span class="o">=</span> <span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Diffuse</span> 
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">FILTER</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">FilterAlgorithm</span><span class="o">.</span><span class="n">Durbin_Koopman</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Durbin_Koopman</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Smoother </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span><span class="si">}</span><span class="s2"> should be set to </span><span class="si">{</span><span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Durbin_Koopman</span><span class="si">}</span><span class="s2">... Resetting.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SMOOTHER</span> <span class="o">=</span> <span class="n">SmootherAlgorithm</span><span class="o">.</span><span class="n">Durbin_Koopman</span> 
        
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Prior</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Prior</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;STARTINGVALUES&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">PRIOR</span> <span class="o">=</span> <span class="n">PriorAssumption</span><span class="o">.</span><span class="n">StartingValues</span>
        <span class="k">elif</span> <span class="n">Prior</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;EQUILIBRIUM&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">PRIOR</span> <span class="o">=</span> <span class="n">PriorAssumption</span><span class="o">.</span><span class="n">Equilibrium</span>
        <span class="k">elif</span> <span class="n">Prior</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DIFFUSE&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">PRIOR</span> <span class="o">=</span> <span class="n">PriorAssumption</span><span class="o">.</span><span class="n">Diffuse</span>
        <span class="k">elif</span> <span class="n">Prior</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ASYMPTOTIC&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">PRIOR</span> <span class="o">=</span> <span class="n">PriorAssumption</span><span class="o">.</span><span class="n">Asymptotic</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">InitCondition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">InitCondition</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;STEADYSTATE&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">=</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">SteadyState</span>
        <span class="k">elif</span> <span class="n">InitCondition</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;STARTINGVALUES&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">=</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">StartingValues</span>
        <span class="k">elif</span> <span class="n">InitCondition</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;HISTORY&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">=</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">History</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial condition </span><span class="si">{</span><span class="n">InitCondition</span><span class="si">}</span><span class="s2"> is not implemented... Resetting to Starting values.&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">=</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">StartingValues</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">SamplingMethod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;EMCEE&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Emcee</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PYMCMCSTAT&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Pymcmcstat_mh</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PYMCMCSTAT-MH&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Pymcmcstat_mh</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PYMCMCSTAT-AM&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Pymcmcstat_am</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PYMCMCSTAT-DR&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Pymcmcstat_dr</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PYMCMCSTAT-DRAM&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Pymcmcstat_dram</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PYMC3&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Pymc3</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PARTICLE-PMMH&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Particle_pmmh</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PARTICLE-SMC&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Particle_smc</span>
        <span class="k">elif</span> <span class="n">SamplingMethod</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PARTICLE-GIBBS&quot;</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Particle_gibbs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sampling algorithm </span><span class="si">{</span><span class="n">SamplingMethod</span><span class="si">}</span><span class="s2"> is not implemented... Resetting to Emcee algorithm.&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="o">=</span> <span class="n">SamplingAlgorithm</span><span class="o">.</span><span class="n">Emcee</span>
        
    <span class="k">return</span> <span class="n">model</span></div>

        

<div class="viewcode-block" id="importModel">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.importModel">[docs]</a>
<span class="k">def</span> <span class="nf">importModel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundary_conditions_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exogenous</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">InitCondition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">Prior</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">estimate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Solver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Smoother</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">shocks_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">steady_state_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">measurement_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">calibration_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">SamplingMethod</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">anticipate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">model_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">graph_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bSparse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import model.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: The path to yaml file name.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param order: Approximation order of solution of the non-linear system of equations.</span>
<span class="sd">        :type order: int.</span>
<span class="sd">        :param hist: Path to the history excel file. </span>
<span class="sd">        :type hist: str.</span>
<span class="sd">        :param boundary_conditions_path: Path to the boundary conditions excel file.  This file contains initial and terminal conditions.</span>
<span class="sd">        :type boundary_conditions_path: str.</span>
<span class="sd">        :param exogenous: List of exogenous variables.</span>
<span class="sd">        :type exogenous: list.</span>
<span class="sd">        :param InitCondition: Endogenous variables initial condition method.</span>
<span class="sd">        :type InitCondition: str.</span>
<span class="sd">        :param Prior: Error covariance matrix estimation method.</span>
<span class="sd">        :type Prior: str.</span>
<span class="sd">        :param estimate: If True estimate model parameters.</span>
<span class="sd">        :type estimate: bool.</span>
<span class="sd">        :param Solver: Solver algorithm.</span>
<span class="sd">        :type Solver: str.</span>
<span class="sd">        :param Filter: KF filter algorithm.</span>
<span class="sd">        :type Filter: str.</span>
<span class="sd">        :param Smoother: KF smoother algorithm.</span>
<span class="sd">        :type Smoother: str.</span>
<span class="sd">        :param shocks_file_path: Path to shock file.</span>
<span class="sd">        :type shocks_file_path: str.</span>
<span class="sd">        :param steady_state_file_path: Path to steady-state file.</span>
<span class="sd">        :type steady_state_file_path: str.</span>
<span class="sd">        :param measurement_file_path: Path to a file with measurement data.</span>
<span class="sd">        :type measurement_file_path: str. </span>
<span class="sd">        :param calibration_file_path: Path to calibration files or a file.</span>
<span class="sd">        :type calibration_file_path: list or str.</span>
<span class="sd">        :param use_cache: If True reads previously saved model from a file of model dump.</span>
<span class="sd">        :type use_cache: bool.</span>
<span class="sd">        :param anticipate: If True future shocks are anticipated.</span>
<span class="sd">        :type anticipate: bool.</span>
<span class="sd">        :param model_info: If True creates a pdf/latex model file.</span>
<span class="sd">        :type model_info: bool.</span>
<span class="sd">        :param graph_info: If True displays graph of model equations. The default is False.</span>
<span class="sd">        :type graph_info:  bool, optional</span>
<span class="sd">        :param bSparse: Use sparse matrix algebra.</span>
<span class="sd">        :type bSparse: bool.</span>
<span class="sd">        </span>
<span class="sd">        :returns:  Instance of Model class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.utils.interface</span> <span class="kn">import</span> <span class="n">loadModel</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.util</span> <span class="kn">import</span> <span class="n">updateFiles</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.model.settings</span> <span class="kn">import</span> <span class="n">SolverMethod</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.model.settings</span> <span class="kn">import</span> <span class="n">InitialCondition</span>
    
    <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="n">model_path</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="n">ext</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.bin&quot;</span><span class="p">)</span>
    
    <span class="n">model_file_exist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model_file_exist</span> <span class="ow">and</span> <span class="n">use_cache</span><span class="p">:</span>
        
        <span class="n">model</span> <span class="o">=</span> <span class="n">loadModel</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span>
                          <span class="n">shocks_file_path</span><span class="o">=</span><span class="n">shocks_file_path</span><span class="p">,</span>
                          <span class="n">steady_state_file_path</span><span class="o">=</span><span class="n">steady_state_file_path</span><span class="p">,</span>
                          <span class="n">calibration_file_path</span><span class="o">=</span><span class="n">calibration_file_path</span><span class="p">)</span>
        
        <span class="n">model</span><span class="o">.</span><span class="n">anticipate</span> <span class="o">=</span> <span class="n">anticipate</span>
        <span class="n">model</span><span class="o">.</span><span class="n">bSparse</span> <span class="o">=</span> <span class="n">bSparse</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Solver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;VILLEMOT&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">Villemot</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ANDERSONMOORE&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">AndersonMoore</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BINDERPESARAN&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">BinderPesaran</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;KLEIN&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">Klein</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;LBJ&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJ</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ABLR&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">ABLR</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;LBJAX&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJax</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">model</span><span class="o">.</span><span class="n">jaxdiff</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BLOCK&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">Block</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DM&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">DM</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJ</span>
                <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJ</span>
            <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">InitCondition</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">InitCondition</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;STEADYSTATE&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">=</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">SteadyState</span>
            <span class="k">elif</span> <span class="n">InitCondition</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;STARTINGVALUES&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">=</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">StartingValues</span>
            <span class="k">elif</span> <span class="n">InitCondition</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;HISTORY&quot;</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">=</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">History</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial condition </span><span class="si">{</span><span class="n">InitCondition</span><span class="si">}</span><span class="s2"> is not implemented... Resetting to Starting values.&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">=</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">StartingValues</span>

        <span class="c1"># Update python generated files   </span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">updateFiles</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;/preprocessor&quot;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>       
        <span class="n">smodel</span> <span class="o">=</span> <span class="n">import_model</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="n">hist</span><span class="p">,</span>
                              <span class="n">boundary_conditions_path</span><span class="o">=</span><span class="n">boundary_conditions_path</span><span class="p">,</span>
                              <span class="n">exogenous</span><span class="o">=</span><span class="n">exogenous</span><span class="p">,</span><span class="n">shocks_file_path</span><span class="o">=</span><span class="n">shocks_file_path</span><span class="p">,</span>
                              <span class="n">steady_state_file_path</span><span class="o">=</span><span class="n">steady_state_file_path</span><span class="p">,</span>
                              <span class="n">calibration_file_path</span><span class="o">=</span><span class="n">calibration_file_path</span><span class="p">,</span>
                              <span class="n">measurement_file_path</span><span class="o">=</span><span class="n">measurement_file_path</span><span class="p">)</span>
        <span class="n">smodel</span><span class="o">.</span><span class="n">bSparse</span> <span class="o">=</span> <span class="n">bSparse</span>
        <span class="n">infos</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="n">smodel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;filename&#39;</span> <span class="p">:</span> <span class="n">fname</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Solver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;VILLEMOT&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">Villemot</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ANDERSONMOORE&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">AndersonMoore</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BINDERPESARAN&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">BinderPesaran</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;KLEIN&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">Klein</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;LBJ&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJ</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;LBJAX&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJax</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">jaxdiff</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ABLR&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">ABLR</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;BLOCK&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">Block</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">Solver</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;DM&quot;</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">DM</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJ</span>
                <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">smodel</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJ</span>
            <span class="n">smodel</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">smodel</span><span class="p">,</span><span class="n">anticipate</span><span class="o">=</span><span class="n">anticipate</span><span class="p">,</span><span class="n">infos</span><span class="o">=</span><span class="n">infos</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">estimate</span> <span class="o">=</span> <span class="n">estimate</span>
        <span class="n">model</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">order</span>
        
        <span class="c1"># Set model parameters</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">setParameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">Solver</span><span class="p">,</span><span class="n">Filter</span><span class="p">,</span><span class="n">Smoother</span><span class="p">,</span><span class="n">Prior</span><span class="p">,</span><span class="n">InitCondition</span><span class="p">,</span><span class="n">SamplingMethod</span><span class="p">)</span>
        <span class="n">simulationRange</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        
        <span class="c1"># Serialize model into file</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.interface</span> <span class="kn">import</span> <span class="n">saveModel</span>
        <span class="n">saveModel</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">model_info</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.misc.text2latex</span> <span class="kn">import</span> <span class="n">saveDocument</span>
        <span class="n">saveDocument</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">graph_info</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="c1">#   Create model equations graph</span>
        <span class="n">img_file_name</span> <span class="o">=</span> <span class="s2">&quot;Equations_Graph.png&quot;</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.info.graphs</span> <span class="kn">import</span> <span class="n">createGraph</span><span class="p">,</span> <span class="n">createClusters</span>
        <span class="n">createGraph</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">img_file_name</span><span class="p">)</span>
        <span class="n">cluster_file_name</span> <span class="o">=</span> <span class="s2">&quot;Minimum_Spanning_Tree.png&quot;</span>
        <span class="n">createClusters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">cluster_file_name</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">model</span></div>



<div class="viewcode-block" id="findEigenValues">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.findEigenValues">[docs]</a>
<span class="k">def</span> <span class="nf">findEigenValues</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">steady_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find eigen values of system of equations at steady state.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to model file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.</span>
<span class="sd">        :param Output: Boolean variable.  If set saves steady state solution to excel file and sqlite database.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        </span>
<span class="sd">        :returns: Steady state solution.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    
    <span class="c1"># Import model</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../models/template.yaml&#39;</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">importModel</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
     
    <span class="n">eig</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">find_eigen_values</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">steady_state</span><span class="p">)</span>
    <span class="n">ev</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">eig</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">nev</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">+</span><span class="mf">1.e-10</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ev</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nev</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nev</span><span class="si">}</span><span class="s2"> eigen values of model transition matrix are larger than one.&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
            <span class="c1"># from snowdrop.src.model.settings import PriorAssumption</span>
            <span class="c1"># if model.PRIOR == PriorAssumption.Equilibrium:</span>
            <span class="c1">#     cprint(&quot;Equilibrium prior assumption is not applicable for non-stationary models... Please use different assumption!.&quot;,&quot;red&quot;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Stationary model&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="c1"># print()</span>
        <span class="c1"># cprint(&#39;Number of unstable roots: %d&#39; % nev,&#39;blue&#39;)</span>
        <span class="c1"># cprint(&#39;Eigen Values:&#39;,&#39;blue&#39;)</span>
        <span class="c1"># cprint([&#39;{:.2e}&#39;.format(abs(x)) for x in ev],&#39;blue&#39;)</span>

    <span class="k">return</span>  <span class="n">eig</span></div>



<div class="viewcode-block" id="findSteadyStateSolution">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.findSteadyStateSolution">[docs]</a>
<span class="k">def</span> <span class="nf">findSteadyStateSolution</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">excel_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find steady state solution.</span>
<span class="sd">    </span>
<span class="sd">    This function uses variables starting values as initial condition for an iterative algorithm.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to model file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.</span>
<span class="sd">        :param Output: Boolean variable.  If set saves steady state solution to excel file and sqlite database.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        :param excel_dir: Pth to directory where excel steady state file will be saved.</span>
<span class="sd">        :type excel_dir: str.</span>
<span class="sd">        </span>
<span class="sd">        :returns: Steady state solution.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">global</span> <span class="n">xl_dir</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    
    <span class="c1"># Import model</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../models/template.yaml&#39;</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">importModel</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
     
    <span class="c1"># Get parameter names</span>
    <span class="n">par_names</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
    <span class="c1"># Get parameter values</span>
    <span class="n">param_values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">param_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="n">param_values</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Get variables</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;new_variables&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
        <span class="n">new_vars</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;new_variables&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_vars</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># Find steady-state</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">,</span> <span class="n">ss_growth</span> <span class="o">=</span> <span class="n">linear_solver</span><span class="o">.</span><span class="n">find_steady_state</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ss</span><span class="p">,</span> <span class="n">ss_growth</span> <span class="o">=</span> <span class="n">nonlinear_solver</span><span class="o">.</span><span class="n">find_steady_state</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    
    <span class="c1"># model.steady_state  = dict(zip(var,ss))</span>
    <span class="c1"># model.steady_growth = dict(zip(var,ss_growth))</span>
        
    <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s1">&#39;Steady-State Solution:&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">sv</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span> <span class="k">if</span>  <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_vars</span><span class="p">][:</span><span class="n">n</span><span class="p">]</span>
        <span class="n">sv</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">cprint</span><span class="p">(</span><span class="n">sv</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">Output</span> <span class="p">:</span>
        <span class="c1"># Save results in excel file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">excel_dir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">excel_dir</span><span class="p">):</span>
            <span class="n">xl_dir</span> <span class="o">=</span> <span class="n">excel_dir</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ex_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xl_dir</span><span class="p">,</span><span class="s1">&#39;Steady_State.csv&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">ex_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xl_dir</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_Steady_State.csv&#39;</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ex_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">par_names</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ss</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">param_values</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
              
        <span class="n">par_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PARAM_&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">par_names</span><span class="p">]</span>
        <span class="n">columns</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_names</span><span class="p">,</span><span class="n">var</span><span class="p">)</span>                  
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="c1"># Save steady-state solution to Python database</span>
            <span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../data&#39;</span><span class="p">))</span>
            <span class="n">dbfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span><span class="s1">&#39;db/ss.sqlite&#39;</span><span class="p">))</span>
            <span class="n">sqlitedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dbfilename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">sqlitedir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sqlitedir</span><span class="p">)</span>
            <span class="c1"># SQLITE is case insensitive.  Therefore, append parameter names with PAR_ prefix.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param_values</span><span class="p">,</span><span class="n">ss</span><span class="p">)</span>
            <span class="n">saveToDatabase</span><span class="p">(</span><span class="n">dbfilename</span><span class="o">=</span><span class="n">dbfilename</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
        
    <span class="k">return</span>  <span class="n">ss</span><span class="p">,</span> <span class="n">ss_growth</span></div>



<div class="viewcode-block" id="findSteadyStateSolutions">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.findSteadyStateSolutions">[docs]</a>
<span class="k">def</span> <span class="nf">findSteadyStateSolutions</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">number_of_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">par_range</span><span class="o">=</span><span class="p">{},</span><span class="n">Plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find steady state solution for a range of parameters.</span>
<span class="sd">    </span>
<span class="sd">    The parameters range is defined in the &quot;options&quot; sections of YAML model file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to model file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.</span>
<span class="sd">        :param number_of_steps: Number of steps of parameter range.</span>
<span class="sd">        :type number_of_steps: int.</span>
<span class="sd">        :param par_range: Parameters range.</span>
<span class="sd">        :type par_range: dictionary.</span>
<span class="sd">        :param Plot: Boolean variable.  If set to True shows graphs.</span>
<span class="sd">        :type Plot: bool.</span>
<span class="sd">        :param Output: Boolean variable.  If set to True saves graphs.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        </span>
<span class="sd">        :returns: List of steady state arrays for given parameter range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../../supplements/models/temp.yaml&#39;</span><span class="p">))</span>
        <span class="c1"># Import model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">importModel</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
       
    <span class="c1"># Get variables   </span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
    <span class="c1"># Get parameters</span>
    <span class="n">par_names</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
    
    <span class="n">arr_ss</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">par_ss</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">data2</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">orig_par_values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">par</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">par_names</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">arr1</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">arr2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">par_values</span> <span class="o">=</span> <span class="n">orig_par_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">par_range</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="n">par_range</span><span class="p">[</span><span class="n">par</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">par</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">par</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_steps</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">number_of_steps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_par</span> <span class="o">=</span> <span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_par</span> <span class="o">=</span> <span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">number_of_steps</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">par_values</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_par</span>
                <span class="c1"># Set new calibration parameters</span>
                <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">par_values</span>
                <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span><span class="p">:</span>
                    <span class="n">ss</span><span class="p">,</span> <span class="n">ss_growth</span> <span class="o">=</span> <span class="n">linear_solver</span><span class="o">.</span><span class="n">find_steady_state</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ss</span><span class="p">,</span> <span class="n">ss_growth</span>  <span class="o">=</span> <span class="n">nonlinear_solver</span><span class="o">.</span><span class="n">find_steady_state</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="c1">#arr.append({par:new_par,&#39;parameters&#39;:par_values,&#39;steady_state&#39;:ss})</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_par</span><span class="p">,</span><span class="n">ss</span><span class="p">))</span>
                <span class="n">arr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par_values</span><span class="p">,</span><span class="n">ss</span><span class="p">))</span>
                <span class="n">arr2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_par</span><span class="p">,</span><span class="n">ss</span><span class="p">))</span>
            <span class="n">arr_ss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="n">par_ss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr1</span><span class="p">)</span>
            <span class="n">data2</span><span class="p">[</span><span class="n">par</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr2</span>
            
    <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig_par_values</span>
            
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
        
    <span class="k">if</span> <span class="n">Plot</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr_ss</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Steady-State Solutions&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
            <span class="n">plotSteadyState</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">figures_dir</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span><span class="n">arr_ss</span><span class="o">=</span><span class="n">arr_ss</span><span class="p">,</span><span class="n">par_ss</span><span class="o">=</span><span class="n">par_ss</span><span class="p">)</span>
                
    <span class="k">if</span> <span class="n">Output</span><span class="p">:</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="n">par_names</span> <span class="o">+</span> <span class="n">s</span>
        
        <span class="c1"># Save results in excel file</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ex_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../../supplements/data/Steady_State.csv&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">ex_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;.././supplements/data/&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_Steady_State.csv&#39;</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ex_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">yIter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
                <span class="n">dim1</span><span class="p">,</span><span class="n">dim2</span> <span class="o">=</span> <span class="n">yIter</span><span class="o">.</span><span class="n">shape</span>
                <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim1</span><span class="p">):</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">yIter</span><span class="p">[</span><span class="n">it</span><span class="p">,:]</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">par_values</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Save steady-state solution in Python database</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="n">dbfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../../supplements/data/db/ss_param_range.sqlite&#39;</span><span class="p">))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># Save results in Python database</span>
            <span class="n">saveToDatabase</span><span class="p">(</span><span class="n">dbfilename</span><span class="o">=</span><span class="n">dbfilename</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">arr_ss</span><span class="p">,</span><span class="n">par_ss</span><span class="p">,</span><span class="n">par_names</span><span class="p">,</span><span class="n">data2</span></div>



<div class="viewcode-block" id="getImpulseResponseFunctions">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.getImpulseResponseFunctions">[docs]</a>
<span class="k">def</span> <span class="nf">getImpulseResponseFunctions</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">Plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get impulse response functions (IRF).</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to model file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :type Plot: bool.</span>
<span class="sd">        :param Output: Boolean variable.  If set then saves graphs.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        </span>
<span class="sd">        :returns: IRF for given parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span><span class="p">,</span><span class="n">dates</span>  <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">irf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">Plot</span><span class="o">=</span><span class="n">Plot</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="n">Output</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span><span class="p">,</span><span class="n">dates</span></div>



<div class="viewcode-block" id="optimize">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.optimize">[docs]</a>
<span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="n">fpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">plot_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">model_info</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call main driver program.</span>
<span class="sd">    </span>
<span class="sd">    Runs model optimization.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fpath: Path to model file.</span>
<span class="sd">        :type fpath: str.        </span>
<span class="sd">        :param fout: Path to output excel file.</span>
<span class="sd">        :type fout: str.</span>
<span class="sd">        :param Output: If set outputs simulation results to excel file and Python sqlite database.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        :param output_dir: Path to output directory.</span>
<span class="sd">        :type output_dir: str.</span>
<span class="sd">        :param plot_variables: Names of variables to plot.</span>
<span class="sd">        :type plot_variables: list.</span>
<span class="sd">        :param model_info: If True creates a pdf/latex model file.</span>
<span class="sd">        :type model_info: bool.</span>
<span class="sd">        :returns: Optimization results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.optimization.optimize</span> <span class="kn">import</span> <span class="n">run</span>
    <span class="n">run</span><span class="p">(</span><span class="n">fpath</span><span class="o">=</span><span class="n">fpath</span><span class="p">,</span><span class="n">fout</span><span class="o">=</span><span class="n">fout</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="n">Output</span><span class="p">,</span><span class="n">plot_variables</span><span class="o">=</span><span class="n">plot_variables</span><span class="p">,</span><span class="n">model_info</span><span class="o">=</span><span class="n">model_info</span><span class="p">)</span></div>

  

<div class="viewcode-block" id="kalman_filter">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.kalman_filter">[docs]</a>
<span class="k">def</span> <span class="nf">kalman_filter</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">T</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">output_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">decomp_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">anticipate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">meas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">InitCondition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Prior</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">calibration_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">Solver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Smoother</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs Kalman filtering.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to model file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.</span>
<span class="sd">        :param y0: Starting (or guessed) values of the solution.</span>
<span class="sd">        :type y0: numpy array.</span>
<span class="sd">        :param T: Number of time periods.</span>
<span class="sd">        :type T: int.</span>
<span class="sd">        :param output_variables: output variables.</span>
<span class="sd">        :type output_variables: list.  </span>
<span class="sd">        :param Plot: Boolean variable.If this flag is raised then plots graphs.</span>
<span class="sd">        :type Plot: bool.</span>
<span class="sd">        :param decomp_variables: List of decomposition variables.</span>
<span class="sd">        :type decomp_variables: list.</span>
<span class="sd">        :param anticipate: It True then future shocks are anticipated.</span>
<span class="sd">        :type anticipate: bool.</span>
<span class="sd">        :param Output: If set outputs simulation results to excel file and Python sqlite database.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        :param output_dir: Path to output directory.</span>
<span class="sd">        :type output_dir: str.</span>
<span class="sd">        :param hist: Path to history excel file. It contains starting and terminal values of endogenous variables.</span>
<span class="sd">        :type hist: str.</span>
<span class="sd">        :param boundary_conditions_path: Path to the boundary conditions excel file.  This file contains initial and terminal conditions.</span>
<span class="sd">        :type boundary_conditions_path: str.</span>
<span class="sd">        :param meas: Path to a file with measurement data.</span>
<span class="sd">        :type meas: str. </span>
<span class="sd">        :param InitCondition: (StartingValues,SteadyState) </span>
<span class="sd">           If StartingValues then use starting values</span>
<span class="sd">           If SteadyState then use steady state as starting values</span>
<span class="sd">        :type InitialCondition: str.</span>
<span class="sd">        :param Prior: (StartingValues,DiffusePrior,Equilibrium) If Rosenberg then applies algorithm to find initial values of state variables.</span>
<span class="sd">           If StartingValues then use starting values for covariance matrices</span>
<span class="sd">           If SteadyState then use steady state for covariance matrices</span>
<span class="sd">           If Equilibrium then solve Lyapunov equation to find steady state covariance matrices.</span>
<span class="sd">        :type Prior: str.</span>
<span class="sd">        :param estimate_Posterior: If this flag is raised, then calibrate model parameters and apply Kalman Filter with the new calibrated parameters.</span>
<span class="sd">        :type estimate_Posterior: bool. </span>
<span class="sd">        :param fout: Path to output excel file.</span>
<span class="sd">        :type fout: str.</span>
<span class="sd">        :param calibration_file_path: Path to a calibration file or files.</span>
<span class="sd">        :type calibration_file_path: str or list.</span>
<span class="sd">        :param Solver: Name of numerical method to solve the system of equations.</span>
<span class="sd">        :type Solver: str.</span>
<span class="sd">        :param Filter: Name of Kalman filter algorithm.</span>
<span class="sd">        :type Filter: str.</span>
<span class="sd">        :param Smoother: Name of Kalman filter smoother algorithm.</span>
<span class="sd">        :type Smoother: str.</span>
<span class="sd">        :param calibration_file_path: If True the transition equations, variables, shocks are combined with the measurement ones.</span>
<span class="sd">        :type calibration_file_path: bool.</span>
<span class="sd">        </span>
<span class="sd">        :returns: Kalman filter results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">out</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">output_variables</span><span class="o">=</span><span class="n">output_variables</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="n">Output</span><span class="p">,</span>
              <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span><span class="n">fout</span><span class="o">=</span><span class="n">fout</span><span class="p">,</span><span class="n">Plot</span><span class="o">=</span><span class="n">Plot</span><span class="p">,</span><span class="n">decomp_variables</span><span class="o">=</span><span class="n">decomp_variables</span><span class="p">,</span>
              <span class="n">anticipate</span><span class="o">=</span><span class="n">anticipate</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="n">hist</span><span class="p">,</span><span class="n">meas</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">InitCondition</span><span class="o">=</span><span class="n">InitCondition</span><span class="p">,</span>
              <span class="n">Prior</span><span class="o">=</span><span class="n">Prior</span><span class="p">,</span><span class="n">calibration_file_path</span><span class="o">=</span><span class="n">calibration_file_path</span><span class="p">,</span><span class="n">Solver</span><span class="o">=</span><span class="n">Solver</span><span class="p">,</span>
              <span class="n">Filter</span><span class="o">=</span><span class="n">Filter</span><span class="p">,</span><span class="n">Smoother</span><span class="o">=</span><span class="n">Smoother</span><span class="p">,</span><span class="n">runKalmanFilter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">out</span></div>

    
    
<div class="viewcode-block" id="estimate">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.estimate">[docs]</a>
<span class="k">def</span> <span class="nf">estimate</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">output_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">Output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">meas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Prior</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">estimate_Posterior</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">estimateOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;SLSQP&quot;</span><span class="p">,</span><span class="n">burn</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">Ndraws</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
             <span class="n">Niter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">resetParameters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fit_data_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">estimate_ML</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">runKalmanFilter</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimates model parameters.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to model file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.</span>
<span class="sd">        :param y0: Starting (or guessed) values of the solution.</span>
<span class="sd">        :type y0: numpy array.</span>
<span class="sd">        :param fout: Path to output excel file.</span>
<span class="sd">        :type fout: str.</span>
<span class="sd">        :param Plot: Boolean variable.If this flag is raised then plots graphs.</span>
<span class="sd">        :type Plot: bool.</span>
<span class="sd">        :param decomp_variables: List of decomposition variables.</span>
<span class="sd">        :param Output: If set outputs simulation results to excel file and Python sqlite database.</span>
<span class="sd">        :type Output: bool. </span>
<span class="sd">        :param output_dir: Path to output directory.</span>
<span class="sd">        :type output_dir: str.</span>
<span class="sd">        :param meas: Path to a file with measurement data.</span>
<span class="sd">        :type meas: str. </span>
<span class="sd">        :type Prior: str.</span>
<span class="sd">        :param estimate_Posterior: If this flag is raised, then calibrate model parameters and apply Kalman Filter with the new calibrated parameters.</span>
<span class="sd">        :type estimate_Posterior: bool. </span>
<span class="sd">        :param estimateOnly: If this flag is raised, then only estimate model parameters.</span>
<span class="sd">        :type estimateOnly: bool.</span>
<span class="sd">        :param algorithm: Algorithm applied to minimiza likelihood function.</span>
<span class="sd">        :type algorith: str.</span>
<span class="sd">        :param burn: Number of samples to discard.</span>
<span class="sd">        :type burn: int.</span>
<span class="sd">        :param Ndraws: The number of draws of Markov Chain Monte Carlo parameters sampling.</span>
<span class="sd">        :type Ndraws: int. </span>
<span class="sd">        :param Niter: The number of iterations.  It is used in Markov Chain Monte Carlo sampling of parameters.</span>
<span class="sd">        :type Niter: int.  </span>
<span class="sd">        :param sample: Boolean variable. If this flag is raised then run Markov Chain Monte Carlo parameters sampling.</span>
<span class="sd">        :type sample: bool. </span>
<span class="sd">        :param resetParameters: If True resets parameters to the samples mean  values.</span>
<span class="sd">        :type resetParameters: bool</span>
<span class="sd">        :param method: Algorithm of Markov Chain Monte Carlo sampling.</span>
<span class="sd">        :type method: str.</span>
<span class="sd">        :param fit_data_only: If True calibrate model parameters by minimizing sum of standard deviations of errors of model fit to data.  </span>
<span class="sd">                         Otherwise, calibrate model by maximizing sum of the prior likelihood of model parameters and the likelihood of model fit to data.</span>
<span class="sd">        :type fit_data_only: bool</span>
<span class="sd">        :param estimate_ML: If True estimate maimum likelihood only.</span>
<span class="sd">        :type estimate_ML: bool.</span>
<span class="sd">        :param runKalmanFilter: If True runs Kalman filter after estimation, otherwise - runs forecast,</span>
<span class="sd">        :type runKalmanFilter: bool.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :returns: Model estimation.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="n">out</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">fout</span><span class="o">=</span><span class="n">fout</span><span class="p">,</span><span class="n">output_variables</span><span class="o">=</span><span class="n">output_variables</span><span class="p">,</span>
              <span class="n">Output</span><span class="o">=</span><span class="n">Output</span><span class="p">,</span><span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span><span class="n">meas</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">Prior</span><span class="o">=</span><span class="n">Prior</span><span class="p">,</span>
              <span class="n">Plot</span><span class="o">=</span><span class="n">Plot</span><span class="p">,</span><span class="n">estimate_Posterior</span><span class="o">=</span><span class="n">estimate_Posterior</span><span class="p">,</span>
              <span class="n">estimateOnly</span><span class="o">=</span><span class="n">estimateOnly</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
              <span class="n">burn</span><span class="o">=</span><span class="n">burn</span><span class="p">,</span><span class="n">Ndraws</span><span class="o">=</span><span class="n">Ndraws</span><span class="p">,</span><span class="n">Niter</span><span class="o">=</span><span class="n">Niter</span><span class="p">,</span><span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span>
              <span class="n">resetParameters</span><span class="o">=</span><span class="n">resetParameters</span><span class="p">,</span><span class="n">Parallel</span><span class="o">=</span><span class="n">Parallel</span><span class="p">,</span>
              <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span><span class="n">fit_data_only</span><span class="o">=</span><span class="n">fit_data_only</span><span class="p">,</span>
              <span class="n">estimate_ML</span><span class="o">=</span><span class="n">estimate_ML</span><span class="p">,</span>
              <span class="n">runKalmanFilter</span><span class="o">=</span><span class="n">runKalmanFilter</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">out</span></div>



<div class="viewcode-block" id="run">
<a class="viewcode-back" href="../../../source/snowdrop.src.html#snowdrop.src.driver.run">[docs]</a>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">Tmax</span><span class="o">=</span><span class="mf">1.e6</span><span class="p">,</span><span class="n">irf</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">output_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">decomp_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">anticipate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">PlotSurface</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Plot3D</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">output_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">boundary_conditions_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">exogenous</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">meas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">InitCondition</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Prior</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">estimate_Posterior</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">estimateOnly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;SLSQP&quot;</span><span class="p">,</span><span class="n">burn</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">Ndraws</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">Niter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">sample</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">resetParameters</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Parallel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">MULT</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">shocks_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">steady_state_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">calibration_file_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Solver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Smoother</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fit_data_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">estimate_ML</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">opt_ss_continue</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">graph_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">model_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">runKalmanFilter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">orth_shocks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main driver program.</span>
<span class="sd">    </span>
<span class="sd">    It runs simulations, finds steady state solution, plots graphs, and saves results to excel files and Python sqlite databases.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to model file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.</span>
<span class="sd">        :param y0: Starting (or guessed) values of the solution.</span>
<span class="sd">        :type y0: numpy array.</span>
<span class="sd">        :param order: Approximation order of non-linear system of equations.</span>
<span class="sd">        :type order: int.</span>
<span class="sd">        :param T: Number of time periods.</span>
<span class="sd">        :type T: int.</span>
<span class="sd">        :param Tmax: Maximum number of periods to display in graphs.</span>
<span class="sd">        :type Tmax: int.</span>
<span class="sd">        :param irf: IRF variable.</span>
<span class="sd">        :type irf: int.</span>
<span class="sd">        :param prefix: Prefix name.  It is used to plot and output variables which name starts with prefix.</span>
<span class="sd">        :type prefix: str.</span>
<span class="sd">        :param output_variables: output variables.</span>
<span class="sd">        :type output_variables: list.  </span>
<span class="sd">        :param Plot: Boolean variable.If this flag is raised then plots graphs.</span>
<span class="sd">        :type Plot: bool.</span>
<span class="sd">        :param decomp_variables: List of decomposition variables.</span>
<span class="sd">        :type decomp_variables: list.</span>
<span class="sd">        :param anticipate: It True then future shocks are anticipated.</span>
<span class="sd">        :type anticipate: bool.</span>
<span class="sd">        :param PlotSurface: Boolean variable. If this flag is raised then plots 2D graphs.</span>
<span class="sd">        :type PlotSurface: bool. </span>
<span class="sd">        :param Plot3D: Boolean variable. If this flag is raised then plots 3D graphs.</span>
<span class="sd">        :type Plot3D: bool.</span>
<span class="sd">        :param Output: If set outputs simulation results to excel file and Python sqlite database.</span>
<span class="sd">        :type Output: bool.    </span>
<span class="sd">        :param output_dir: Path to output directory.</span>
<span class="sd">        :type output_dir: str.            </span>
<span class="sd">        :param hist: Path to history excel file. It contains starting and terminal values of endogenous variables.</span>
<span class="sd">        :type hist: str.</span>
<span class="sd">        :param boundary_conditions_path: Path to the boundary conditions excel file.  This file contains initial and terminal conditions.</span>
<span class="sd">        :type boundary_conditions_path: str.</span>
<span class="sd">        :param exogenous: List of exogenous variables.</span>
<span class="sd">        :type exogenous: list.</span>
<span class="sd">        :param meas: Path to a file with measurement data.</span>
<span class="sd">        :type meas: str. </span>
<span class="sd">        :param InitCondition: (StartingValues,SteadyState) </span>
<span class="sd">           If StartingValues is set, then use starting values</span>
<span class="sd">           If SteadyState is set, then use steady state as starting values</span>
<span class="sd">        :param Prior: (StartingValues,DiffusePrior,Equilibrium) If Rosenberg then applies algorithm to find initial values of state variables.</span>
<span class="sd">           If StartingValues then use starting values for covariance matrices</span>
<span class="sd">           If SteadyState then use steady state for covariance matrices</span>
<span class="sd">           If Equilibrium then solve Lyapunov equation to find steady state covariance matrices.</span>
<span class="sd">        :type Prior: str.</span>
<span class="sd">        :param estimate_Posterior: If this flag is raised, then calibrate model parameters and apply Kalman Filter with the new calibrated parameters.</span>
<span class="sd">        :type estimate_Posterior: bool. </span>
<span class="sd">        :param estimateOnly: If this flag is raised, then only estimate model parameters.</span>
<span class="sd">        :type estimateOnly: bool.</span>
<span class="sd">        :param algorithm: Algorithm applied to minimiza likelihood function.</span>
<span class="sd">        :type algorith: str.</span>
<span class="sd">        :param burn: Number of samples to discard.</span>
<span class="sd">        :type burn: int.</span>
<span class="sd">        :param Ndraws: The number of draws of Markov Chain Monte Carlo parameters sampling.</span>
<span class="sd">        :type Ndraws: int. </span>
<span class="sd">        :param Niter: The number of iterations.  It is used in Markov Chain Monte Carlo sampling of parameters.</span>
<span class="sd">        :type Niter: int.  </span>
<span class="sd">        :param sample: Boolean variable. If this flag is raised then run Markov Chain Monte Carlo parameters sampling.</span>
<span class="sd">        :type sample: bool. </span>
<span class="sd">        :param resetParameters: If True resets parameters to the samples mean  values.</span>
<span class="sd">        :type resetParameters: bool</span>
<span class="sd">        :param method: Algorithm of Markov Chain Monte Carlo sampling.</span>
<span class="sd">        :type method: str.</span>
<span class="sd">        :param fout: Path to output excel file.</span>
<span class="sd">        :type fout: str.</span>
<span class="sd">        :param MULT: Multiplier defining terminal time.  If set greater than one than </span>
<span class="sd">                     solution will be computed for this extended time range interval.</span>
<span class="sd">        :type MULT: float.   </span>
<span class="sd">        :param shocks_file_path: Path to shock file.</span>
<span class="sd">        :type shocks_file_path: str.</span>
<span class="sd">        :param steady_state_file_path: Path to steady-state file.</span>
<span class="sd">        :type steady_state_file_path: str.</span>
<span class="sd">        :param calibration_file_path: Path to a calibration file or files.</span>
<span class="sd">        :type calibration_file_path: str or list.</span>
<span class="sd">        :param Solver: Name of numerical method to solve the system of equations.</span>
<span class="sd">        :type Solver: str.</span>
<span class="sd">        :param Filter: Name of Kalman filter algorithm.</span>
<span class="sd">        :type Filter: str.</span>
<span class="sd">        :param Smoother: Name of Kalman filter smoother algorithm.</span>
<span class="sd">        :type Smoother: str.</span>
<span class="sd">        :param fit_data_only: If True calibrate model parameters by minimizing sum of standard deviations of errors of model fit to data.  </span>
<span class="sd">                         Otherwise, calibrate model by maximizing sum of the prior likelihood of model parameters and the likelihood of model fit to data.</span>
<span class="sd">        :type fit_data_only: bool</span>
<span class="sd">        :param estimate_ML: If True estimate maimum likelihood only.</span>
<span class="sd">        :type estimate_ML: bool.</span>
<span class="sd">        :param header: Graph header.</span>
<span class="sd">        :type header: str.</span>
<span class="sd">        :param opt_ss_continue: If set and steady state solution is invalid, then find steady state and continue simulations.</span>
<span class="sd">        :type opt_ss_continue: bool.</span>
<span class="sd">        :param graph_info: If True shows model equations graph.</span>
<span class="sd">        :type graph_info: bool.</span>
<span class="sd">        :param calibration_file_path: If True the transition equations, variables, shocks are combined with the measurement ones.</span>
<span class="sd">        :type calibration_file_path: bool.</span>
<span class="sd">        :param use_cache: If True reads previously saved model from a file of model dump.</span>
<span class="sd">        :type use_cache: bool.</span>
<span class="sd">        :param model_info: If True creates a pdf/latex model file.</span>
<span class="sd">        :type model_info: bool.</span>
<span class="sd">        :param Sparse: If True use sparse matrices algebra.</span>
<span class="sd">        :type Sparse: bool.</span>
<span class="sd">        :param runKalmanFilter: If True runs Kalman Filter.</span>
<span class="sd">        :type runKalmanFilter: bool.</span>
<span class="sd">        :param orth_shocks: If True shocks are orthogonalized (applied only for linear models).</span>
<span class="sd">        :type orth_shocks: bool.</span>
<span class="sd">        </span>
<span class="sd">        :returns: Simulation results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">figures_dir</span><span class="p">,</span> <span class="n">xl_dir</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.model.settings</span> <span class="kn">import</span> <span class="n">InitialCondition</span><span class="p">,</span><span class="n">BoundaryConditions</span><span class="p">,</span><span class="n">BoundaryCondition</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">output_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">figures_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s1">&#39;graphs&#39;</span><span class="p">)))</span>
        <span class="n">xl_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">figures_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">figures_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">xl_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">xl_dir</span><span class="p">)</span>
        
    <span class="c1"># Sanity check</span>
    <span class="k">if</span> <span class="n">estimate_Posterior</span> <span class="ow">and</span> <span class="n">estimate_ML</span> <span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Please choose either posterior estimate or likelihood estimate.  Exitting... &quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">estimate_Posterior</span> <span class="ow">and</span>  <span class="n">fit_data_only</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Please choose either posterior estimate or data fit estimate.  Exitting... &quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">estimate_ML</span> <span class="ow">and</span>  <span class="n">fit_data_only</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Please choose either likelihood estimate or dat fit estimate.  Exitting... &quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">estimateOnly</span><span class="p">:</span>
        <span class="n">estimate_Posterior</span> <span class="o">=</span> <span class="kc">True</span>
        
    <span class="n">estimate</span> <span class="o">=</span> <span class="n">estimate_Posterior</span> <span class="ow">or</span> <span class="n">estimateOnly</span> <span class="ow">or</span> <span class="n">estimate_ML</span> <span class="ow">or</span> <span class="n">fit_data_only</span>
    
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s1">&#39;../models/template.yaml&#39;</span><span class="p">))</span>
        <span class="c1"># Import model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">importModel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="n">hist</span><span class="p">,</span><span class="n">boundary_conditions_path</span><span class="o">=</span><span class="n">boundary_conditions_path</span><span class="p">,</span>
                            <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span><span class="n">exogenous</span><span class="o">=</span><span class="n">exogenous</span><span class="p">,</span><span class="n">InitCondition</span><span class="o">=</span><span class="n">InitCondition</span><span class="p">,</span>
                            <span class="n">Prior</span><span class="o">=</span><span class="n">Prior</span><span class="p">,</span><span class="n">estimate</span><span class="o">=</span><span class="n">estimate</span><span class="p">,</span><span class="n">Solver</span><span class="o">=</span><span class="n">Solver</span><span class="p">,</span>
                            <span class="n">Filter</span><span class="o">=</span><span class="n">Filter</span><span class="p">,</span><span class="n">Smoother</span><span class="o">=</span><span class="n">Smoother</span><span class="p">,</span>
                            <span class="n">shocks_file_path</span><span class="o">=</span><span class="n">shocks_file_path</span><span class="p">,</span>
                            <span class="n">steady_state_file_path</span><span class="o">=</span><span class="n">steady_state_file_path</span><span class="p">,</span>
                            <span class="n">calibration_file_path</span><span class="o">=</span><span class="n">calibration_file_path</span><span class="p">,</span>
                            <span class="n">measurement_file_path</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">model_info</span><span class="o">=</span><span class="n">model_info</span><span class="p">,</span>
                            <span class="n">graph_info</span><span class="o">=</span><span class="n">graph_info</span><span class="p">,</span><span class="n">SamplingMethod</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                            <span class="n">anticipate</span><span class="o">=</span><span class="n">anticipate</span><span class="p">,</span><span class="n">use_cache</span><span class="o">=</span><span class="n">use_cache</span><span class="p">,</span><span class="n">bSparse</span><span class="o">=</span><span class="n">Sparse</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Set model parameters</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">setParameters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">Solver</span><span class="p">,</span><span class="n">Filter</span><span class="p">,</span><span class="n">Smoother</span><span class="p">,</span><span class="n">Prior</span><span class="p">,</span><span class="n">InitCondition</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">anticipate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">anticipate</span> <span class="o">=</span> <span class="n">anticipate</span>
            
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># # Solving non-linear model by linear solver.  Just kidding...</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.equations</span> <span class="kn">import</span> <span class="n">topology</span>
        <span class="n">topology</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        
    <span class="n">model</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">meas_df</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Save model info into pdf file</span>
    <span class="k">if</span> <span class="n">model_info</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.misc.text2latex</span> <span class="kn">import</span> <span class="n">saveDocument</span>
        <span class="n">saveDocument</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        
    <span class="c1"># Create model equations graph</span>
    <span class="k">if</span> <span class="n">graph_info</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.info.graphs</span> <span class="kn">import</span> <span class="n">createGraph</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.info.graphs</span> <span class="kn">import</span> <span class="n">createClusters</span>
        <span class="c1">#from vinfo.graphs import getInfo</span>
        <span class="c1">#getInfo(model)</span>
        <span class="n">img_file_name</span> <span class="o">=</span> <span class="s2">&quot;Equations_Graph.png&quot;</span>
        <span class="n">createGraph</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">img_file_name</span><span class="p">)</span>
        <span class="n">img_file_name</span> <span class="o">=</span> <span class="s2">&quot;Minimum_Spanning_Tree.png&quot;</span>
        <span class="n">createClusters</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">img_file_name</span><span class="p">)</span>
    
    <span class="n">epsilonhat</span><span class="p">,</span><span class="n">etahat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
<span class="c1">#    print(&#39;Variables:&#39;)</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>


<span class="c1">#    print(&#39;shocks:&#39;)</span>
    <span class="n">shock_names</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;shocks&#39;</span><span class="p">]</span>
    <span class="n">shock_values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;shocks&#39;</span><span class="p">]</span>
<span class="c1">#    print(shock_names)</span>
    
<span class="c1">#    print(&#39;Parameters:&#39;)</span>
    <span class="n">par_names</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
    <span class="n">par_values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
<span class="c1">#    pv = [n+&quot;=&quot;+str(v) for n,v in zip(par_names,par_values)]</span>
<span class="c1">#    pv.sort()       </span>
<span class="c1">#    print(pv)</span>
<span class="c1">#    print()</span>

    <span class="c1"># Build dictionary of shock leads and lags</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.utils.equations</span> <span class="kn">import</span> <span class="n">getMaxLeadsLags</span>
    <span class="c1"># Gets maximum of leads and minimum of lags of equations shock variables</span>
    <span class="n">max_lead_shock</span><span class="p">,</span><span class="n">min_lag_shock</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">shock_lead</span><span class="p">,</span><span class="n">shock_lag</span> <span class="o">=</span> \
            <span class="n">getMaxLeadsLags</span><span class="p">(</span><span class="n">eqs</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="n">shock_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">max_lead_shock</span> <span class="o">&gt;</span> <span class="n">min_lag_shock</span><span class="p">:</span>
        <span class="n">shockLeadsLags</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">shock_lag</span><span class="p">,</span><span class="o">**</span><span class="n">shock_lead</span><span class="p">}</span>
        <span class="n">LeadsLags</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shock_names</span><span class="p">))}</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shockLeadsLags</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">shock_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">leadlag</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">leadlag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">leadlag</span><span class="p">)</span>
            <span class="n">LeadsLags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">LeadsLags</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">leadlag</span><span class="p">])</span>
        <span class="n">util</span><span class="o">.</span><span class="n">shockLeadsLags</span> <span class="o">=</span> <span class="n">LeadsLags</span>    

    
    <span class="k">if</span> <span class="s1">&#39;Npaths&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
        <span class="n">Npaths</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;Npaths&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Npaths</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="k">if</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="mi">101</span>
        
    <span class="k">if</span> <span class="s1">&#39;frequency&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">skip</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rng</span><span class="p">,</span><span class="n">dates</span><span class="p">,</span><span class="n">start_filter</span><span class="p">,</span><span class="n">end_filter</span><span class="p">,</span><span class="n">filter_rng</span><span class="p">,</span><span class="n">Time</span><span class="p">,</span><span class="n">T</span> <span class="o">=</span> <span class="n">simulationRange</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>   
    <span class="n">periods</span> <span class="o">=</span> <span class="n">getPeriods</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">rng</span><span class="p">)</span>
         
    <span class="n">util</span><span class="o">.</span><span class="n">PERMANENT_SHOCK</span> <span class="o">=</span> <span class="s1">&#39;shock_values&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;periods&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span>
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">terminal_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">BoundaryCondition</span><span class="o">.</span><span class="n">Condition</span> <span class="o">=</span> <span class="n">BoundaryConditions</span><span class="o">.</span><span class="n">ZeroDerivativeBoundaryCondition</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">BoundaryCondition</span><span class="o">.</span><span class="n">Condition</span> <span class="o">=</span> <span class="n">BoundaryConditions</span><span class="o">.</span><span class="n">FixedBoundaryCondition</span>
    
    <span class="k">if</span> <span class="n">meas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">meas</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">measurement_file_path</span>
        
    <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;measurement_variables&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
        <span class="n">measurement_variables</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;measurement_variables&#39;</span><span class="p">]</span>
        <span class="n">measurement_shocks</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;measurement_shocks&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;measurement_shocks&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">measurement_equations</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">measurement_equations</span>
        <span class="n">Q</span><span class="p">,</span><span class="n">H</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">getCovarianceMatricies</span><span class="p">(</span><span class="n">measurement_variables</span><span class="p">,</span><span class="n">measurement_shocks</span><span class="p">,</span><span class="n">measurement_equations</span><span class="p">,</span><span class="n">shock_names</span><span class="p">,</span><span class="n">model</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">meas</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;xlsx&#39;</span> <span class="ow">or</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;xls&#39;</span><span class="p">:</span>
            <span class="n">meas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">meas</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">meas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">infer_datetime_format</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
       
        <span class="k">if</span> <span class="s1">&#39;frequency&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">data_sources</span><span class="p">:</span>
            <span class="n">obs_freq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data_sources</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obs_freq</span> <span class="o">=</span> <span class="s1">&#39;AS&#39;</span>
        <span class="n">meas_df</span>  <span class="o">=</span> <span class="n">fetchData</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data_sources</span><span class="p">,</span><span class="n">meas_df</span><span class="o">=</span><span class="n">meas_df</span><span class="p">,</span><span class="n">fpath</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="n">obs_freq</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">meas_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>    
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fstart</span> <span class="o">=</span> <span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fend</span> <span class="o">=</span> <span class="n">filter_rng</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">meas_df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">fstart</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">meas_df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">fend</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">())</span>
                <span class="n">meas_df</span> <span class="o">=</span> <span class="n">meas_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">dates</span> <span class="o">&lt;</span> <span class="n">fstart</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span> <span class="c1"># Insert nan rows to dataframe for periods less than start of filter range </span>
                    <span class="n">tmp_rng</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                    <span class="n">skip</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_rng</span><span class="p">)</span>
                    <span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">tmp_rng</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">meas_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
                    <span class="n">meas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">tmp_df</span><span class="p">,</span><span class="n">meas_df</span><span class="p">))</span>
                <span class="n">rng_meas</span> <span class="o">=</span> <span class="n">meas_df</span><span class="o">.</span><span class="n">index</span>
    
            <span class="n">df_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">meas_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">common</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">measurement_variables</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_columns</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">common</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">meas</span> <span class="o">=</span> <span class="n">meas_df</span><span class="p">[</span><span class="n">measurement_variables</span><span class="p">]</span>
                <span class="n">meas</span> <span class="o">=</span> <span class="n">meas</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">measurement_variables</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;_&quot;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df_columns</span><span class="p">:</span>
                        <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meas_df</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">meas_df</span><span class="p">))</span>
                <span class="n">meas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                        
            <span class="n">missing_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">meas</span><span class="p">)</span>
            <span class="n">ind_non_missing</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">obs</span> <span class="ow">in</span> <span class="n">missing_obs</span><span class="p">:</span>
                <span class="n">ind_non_missing</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">meas</span> <span class="o">=</span> <span class="kc">None</span>  
        <span class="n">rng_meas</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">measurement_variables</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span>
  
    <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">checkSteadyState</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">variables</span><span class="p">)</span>
        <span class="n">err2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">err</span><span class="o">*</span><span class="n">err</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err2</span> <span class="o">&gt;</span> <span class="mf">1.e-10</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opt_ss_continue</span><span class="p">:</span>
                <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Incorrect steady state: the sum of the equations squared residuals is, </span><span class="si">{0:.1e}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err2</span><span class="p">),</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">snowdrop.src.gui.dialog</span> <span class="kn">import</span> <span class="n">showDialog</span> 
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;  The sum of the equations squared residuals is: </span><span class="si">{0:.1e}</span><span class="s2">. </span><span class="se">\n</span><span class="s2">Do you want to continue?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err2</span><span class="p">)</span>
                <span class="n">yes_no</span> <span class="o">=</span> <span class="n">showDialog</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Incorrect steady state&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">yes_no</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">yes_no</span> <span class="o">==</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>   
                    <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Incorrect steady state: the sum of the squared equations residuals is, err=</span><span class="si">{0:.1e}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Exitting ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err2</span><span class="p">),</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">y</span><span class="p">,</span><span class="n">dates</span><span class="p">,</span><span class="n">variables</span><span class="p">,</span><span class="n">rng</span><span class="p">,</span><span class="n">periods</span><span class="p">,</span><span class="n">model</span>
                
    <span class="n">ss</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">ev</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">bellman</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">==</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">SteadyState</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1">#print(&quot;Finding a steady-state solution. It uses starting variable values.&quot;)</span>
                <span class="c1">#print()</span>
                <span class="n">ss</span><span class="p">,</span> <span class="n">growth</span> <span class="o">=</span> <span class="n">findSteadyStateSolution</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span> <span class="o">=</span> <span class="n">ss</span>
                <span class="n">model</span><span class="o">.</span><span class="n">steady_growth</span> <span class="o">=</span> <span class="n">growth</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">steady_state</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span><span class="p">:</span>
                        <span class="n">ss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">steady_state</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>  
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Steady state variable </span><span class="si">{}</span><span class="s2"> is missing. Please correct steady-state variables. Exitting...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
                        <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span>
            
            <span class="c1"># Find eigen values</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="n">findEigenValues</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">steady_state</span><span class="o">=</span><span class="n">ss</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">ev</span> <span class="o">=</span> <span class="n">ev</span>
            
        <span class="c1"># If stationary solution is given then use it as a starting value</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">==</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">SteadyState</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">ss</span>
        <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="o">==</span> <span class="n">InitialCondition</span><span class="o">.</span><span class="n">History</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Set starting values</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setStartingValues</span><span class="p">(</span><span class="n">hist</span><span class="o">=</span><span class="n">hist</span><span class="p">)</span>
            
    <span class="c1"># Assign starting values</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">y0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
            
    <span class="c1">###     Check if model has a stationary solution.</span>
    <span class="c1"># # Model is stationary if all eigen values are less than one</span>
    <span class="c1"># bStationary1 = np.all(abs(ev)&lt;1.0)</span>
    <span class="c1"># # Or if the norm of functions at steady state is small...</span>
    <span class="c1"># func = model.functions[&quot;f_static&quot;](ss,par_values,shock_values)</span>
    <span class="c1"># err = np.linalg.norm(func)</span>
    <span class="c1"># bStationary2 = err &lt; 1.e-6</span>
    <span class="c1"># bStationary = bStationary1 and bStationary2</span>
                
    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="n">samples</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">lrx_filter</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">hp_filter</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">estimate</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Please add parameters priors in model file!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.estimation.estimate</span> <span class="kn">import</span> <span class="n">run</span>
            <span class="n">elapsed</span><span class="p">,</span><span class="n">new_par_values</span><span class="p">,</span><span class="n">est_stds</span><span class="p">,</span><span class="n">Qest</span><span class="p">,</span><span class="n">Hest</span><span class="p">,</span><span class="n">priors</span> <span class="o">=</span> \
                <span class="n">run</span><span class="p">(</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span>
                          <span class="n">Qm</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span><span class="n">Hm</span><span class="o">=</span><span class="n">H</span><span class="p">,</span><span class="n">obs</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">steady_state</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span>
                          <span class="n">ind_non_missing</span><span class="o">=</span><span class="n">ind_non_missing</span><span class="p">,</span>
                          <span class="n">fit_data_only</span><span class="o">=</span><span class="n">fit_data_only</span><span class="p">,</span>
                          <span class="n">estimate_Posterior</span><span class="o">=</span><span class="n">estimate_Posterior</span><span class="p">,</span>
                          <span class="n">estimate_ML</span><span class="o">=</span><span class="n">estimate_ML</span><span class="p">,</span>
                          <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_par_values</span>
            <span class="n">model</span><span class="o">.</span><span class="n">priors</span> <span class="o">=</span> <span class="n">priors</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Qest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">Qest</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Hest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">H</span> <span class="o">=</span> <span class="n">Hest</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_par_values</span> <span class="o">=</span> <span class="n">par_values</span>
    
    <span class="k">if</span> <span class="n">estimateOnly</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model</span>
        
    <span class="k">if</span> <span class="n">sample</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.bayes.mcmc</span> <span class="kn">import</span> <span class="n">sample</span>
        <span class="n">new_par_values</span><span class="p">,</span><span class="n">param_names</span><span class="p">,</span><span class="n">samples</span> <span class="o">=</span> \
            <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span><span class="n">obs</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">Qm</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span><span class="n">Hm</span><span class="o">=</span><span class="n">H</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                   <span class="n">parameters</span><span class="o">=</span><span class="n">new_par_values</span><span class="p">,</span><span class="n">steady_state</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span><span class="n">burn</span><span class="o">=</span><span class="n">burn</span><span class="p">,</span>
                   <span class="n">Ndraws</span><span class="o">=</span><span class="n">Ndraws</span><span class="o">+</span><span class="n">burn</span><span class="p">,</span><span class="n">Niter</span><span class="o">=</span><span class="n">Niter</span><span class="p">,</span><span class="n">ind_non_missing</span><span class="o">=</span><span class="n">ind_non_missing</span><span class="p">,</span>
                   <span class="n">resetParameters</span><span class="o">=</span><span class="n">resetParameters</span><span class="p">,</span><span class="n">Parallel</span><span class="o">=</span><span class="n">Parallel</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="n">Output</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_par_values</span>
            
        
    <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">bellman</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.dp</span> <span class="kn">import</span> <span class="n">bellman</span>
        <span class="n">iterations</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">max_f</span><span class="p">,</span><span class="n">elapsed</span> <span class="o">=</span> <span class="n">bellman</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        
    <span class="k">elif</span> <span class="n">runKalmanFilter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">Q</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">H</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">meas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span> 
        <span class="c1"># Apply Kalman filter</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span><span class="p">:</span>
            <span class="n">iterations</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">epsilonhat</span><span class="p">,</span><span class="n">etahat</span><span class="p">,</span><span class="n">max_f</span><span class="p">,</span><span class="n">elapsed</span> <span class="o">=</span> \
                <span class="n">linear_filter</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">Qm</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span><span class="n">Hm</span><span class="o">=</span><span class="n">H</span><span class="p">,</span>
                              <span class="n">obs</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">MULT</span><span class="o">=</span><span class="n">MULT</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span><span class="n">missing_obs</span><span class="o">=</span><span class="n">missing_obs</span><span class="p">,</span>
                              <span class="n">ind_non_missing</span><span class="o">=</span><span class="n">ind_non_missing</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iterations</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">epsilonhat</span><span class="p">,</span><span class="n">etahat</span><span class="p">,</span><span class="n">max_f</span><span class="p">,</span><span class="n">elapsed</span> <span class="o">=</span> \
                <span class="n">nonlinear_filter</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">Qm</span><span class="o">=</span><span class="n">Q</span><span class="p">,</span><span class="n">Hm</span><span class="o">=</span><span class="n">H</span><span class="p">,</span>
                                 <span class="n">obs</span><span class="o">=</span><span class="n">meas</span><span class="p">,</span><span class="n">MULT</span><span class="o">=</span><span class="n">MULT</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span><span class="n">missing_obs</span><span class="o">=</span><span class="n">missing_obs</span><span class="p">,</span>
                                 <span class="n">ind_non_missing</span><span class="o">=</span><span class="n">ind_non_missing</span><span class="p">)</span>
    
        <span class="c1"># Apply LRX and HP filters</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.filters.filters</span> <span class="kn">import</span> <span class="n">LRXfilter</span><span class="p">,</span> <span class="n">HPfilter</span>
        
        <span class="n">nm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">measurement_variables</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nm</span><span class="p">):</span>
            <span class="n">meas_vars</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">measurement_variables</span><span class="p">]</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="n">meas_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;_meas&quot;</span> <span class="ow">in</span> <span class="n">mv</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">measurement_variables</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;obs_&quot;</span> <span class="ow">in</span> <span class="n">mv</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">measurement_variables</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
                <span class="n">pr</span> <span class="o">=</span> <span class="n">ss</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ss</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">y_meas</span> <span class="o">=</span> <span class="n">meas</span><span class="p">[</span><span class="n">skip</span><span class="p">:,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">y_meas</span> <span class="o">=</span> <span class="n">y_meas</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y_meas</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_meas</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">v1</span> <span class="o">=</span> <span class="n">LRXfilter</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_meas</span><span class="p">,</span><span class="n">lmbd</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">w1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">w2</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">w3</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dprior</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">prior</span><span class="o">=</span><span class="n">pr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">v2</span> <span class="o">=</span> <span class="n">HPfilter</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">y_meas</span><span class="p">,</span><span class="n">lmbd</span><span class="o">=</span><span class="mi">100</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">skip</span><span class="p">):</span>
                        <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                        <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meas</span><span class="p">))</span>
                    <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meas</span><span class="p">))</span>
                <span class="n">lrx_filter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
                <span class="n">hp_filter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
                
        <span class="n">lrx_filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lrx_filter</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="n">hp_filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hp_filter</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>            
        <span class="c1"># Solve equations by iterations by applying Newton&#39;s method.</span>
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">irf</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">orth_shocks</span><span class="p">):</span>
                <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.solver.util</span> <span class="kn">import</span> <span class="n">orthogonalize_shocks</span>
                <span class="n">linear_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
                <span class="n">orthogonalize_shocks</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                
            <span class="n">iterations</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yIter</span><span class="p">,</span><span class="n">max_f</span><span class="p">,</span><span class="n">elapsed</span> <span class="o">=</span> \
                <span class="n">linear_solver</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span>
                                       <span class="n">steady_state</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">Npaths</span><span class="o">=</span><span class="n">Npaths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iterations</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yIter</span><span class="p">,</span><span class="n">max_f</span><span class="p">,</span><span class="n">elapsed</span> <span class="o">=</span> \
                <span class="n">nonlinear_solver</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span>
                                          <span class="n">steady_state</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">Npaths</span><span class="o">=</span><span class="n">Npaths</span><span class="p">,</span><span class="n">MULT</span><span class="o">=</span><span class="n">MULT</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">irf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Set shocks to zero</span>
                <span class="k">if</span> <span class="s1">&#39;shock_values&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                    <span class="n">orig_shock_values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;shock_values&#39;</span><span class="p">)</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;shock_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig_shock_values</span><span class="o">*</span><span class="mi">0</span>
                    
                <span class="c1"># Solve equations</span>
                <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span><span class="p">:</span>     
                    <span class="n">iterations_ss</span><span class="p">,</span><span class="n">y_ss</span><span class="p">,</span><span class="n">yIter_ss</span><span class="p">,</span><span class="n">max_f_ss</span><span class="p">,</span><span class="n">elapsed_ss</span> <span class="o">=</span> \
                        <span class="n">linear_solver</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span>
                                               <span class="n">steady_state</span><span class="o">=</span><span class="n">ss</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">Npaths</span><span class="o">=</span><span class="n">Npaths</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iterations_ss</span><span class="p">,</span><span class="n">y_ss</span><span class="p">,</span><span class="n">yIter_ss</span><span class="p">,</span><span class="n">max_f_ss</span><span class="p">,</span><span class="n">elapsed_ss</span> <span class="o">=</span> \
                        <span class="n">nonlinear_solver</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span>
                                                  <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">Npaths</span><span class="o">=</span><span class="n">Npaths</span><span class="p">,</span><span class="n">MULT</span><span class="o">=</span><span class="n">MULT</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="s1">&#39;shock_values&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;shock_values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">orig_shock_values</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">steady_state</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                    <span class="n">steady_state</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
                        <span class="n">steady_state</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">steady_state</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">steady_state</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">steady_state</span>
                        
                <span class="n">y_ss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">steady_state</span><span class="p">,</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
             
            <span class="c1"># Compute difference</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_ss</span><span class="p">)]</span>
              
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Elapsed time: </span><span class="si">%.2f</span><span class="s2"> (seconds)&quot;</span> <span class="o">%</span> <span class="n">elapsed</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of iterations: </span><span class="si">{</span><span class="n">iterations</span><span class="si">}</span><span class="s2">; error: </span><span class="si">{</span><span class="n">max_f</span><span class="si">:</span><span class="s2">.1e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">Output</span><span class="p">:</span>  
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c1"># Print results</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">output_data</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">output_data</span> <span class="o">=</span> <span class="n">yy</span>
            <span class="n">nrow</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">output_variables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">)]</span>
                <span class="n">output_data</span> <span class="o">=</span>  <span class="n">output_data</span><span class="p">[:,</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">variables</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shock_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">shock_values</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">column_names</span> <span class="o">+=</span> <span class="n">shock_names</span>
                    <span class="n">nrow</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">output_data</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">shock_values</span><span class="p">))</span>
                    <span class="n">output_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">output_data</span><span class="p">[:</span><span class="n">nrow</span><span class="p">],</span><span class="n">shock_values</span><span class="p">[:</span><span class="n">nrow</span><span class="p">]))</span>
<span class="c1">#                elif nd == 1:</span>
<span class="c1">#                    column_names += shock_names</span>
<span class="c1">#                    nrow = len(output_data)</span>
<span class="c1">#                    shock_values = np.repeat((shock_values,shock_values))</span>
<span class="c1">#                    output_data = np.column_stack((output_data,shock_values))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lrx_filter</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">column_names</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;LRX_&quot;</span><span class="o">+</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">measurement_variables</span><span class="p">,</span><span class="n">meas_vars</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;_meas&quot;</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                                <span class="p">[</span><span class="s2">&quot;LRX_&quot;</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">measurement_variables</span><span class="p">,</span><span class="n">meas_vars</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;obs_&quot;</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
                <span class="n">filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nrow</span><span class="p">,</span><span class="n">nm</span><span class="p">))</span>
                <span class="n">filtered</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">filtered</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">lrx_filter</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="n">nrow</span><span class="p">])]</span> <span class="o">=</span> <span class="n">lrx_filter</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="n">nrow</span><span class="p">]</span>
                <span class="n">output_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">output_data</span><span class="p">[:</span><span class="n">nrow</span><span class="p">],</span><span class="n">filtered</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hp_filter</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">column_names</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;HP_&quot;</span><span class="o">+</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">measurement_variables</span><span class="p">,</span><span class="n">meas_vars</span><span class="p">)</span><span class="k">if</span> <span class="s2">&quot;_meas&quot;</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span> <span class="o">+</span> \
                                <span class="p">[</span><span class="s2">&quot;HP_&quot;</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">measurement_variables</span><span class="p">,</span><span class="n">meas_vars</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;obs_&quot;</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
                <span class="n">filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nrow</span><span class="p">,</span><span class="n">nm</span><span class="p">))</span>
                <span class="n">filtered</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">filtered</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">lrx_filter</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="n">nrow</span><span class="p">])]</span> <span class="o">=</span> <span class="n">hp_filter</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="n">nrow</span><span class="p">]</span>
                <span class="n">output_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">output_data</span><span class="p">[:</span><span class="n">nrow</span><span class="p">],</span><span class="n">filtered</span><span class="p">))</span>
            <span class="n">pTable</span> <span class="o">=</span> <span class="n">PrettyTable</span><span class="p">(</span><span class="n">column_names</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">date</span> <span class="o">=</span> <span class="n">rng</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                        <span class="n">date</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">date</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">output_data</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
                <span class="n">pTable</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">pTable</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s2">&quot;4.2&quot;</span> 
            <span class="nb">print</span><span class="p">(</span><span class="n">pTable</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>

        <span class="c1"># Save results in csv file</span>
        <span class="k">if</span> <span class="n">fout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xl_dir</span><span class="p">,</span><span class="s1">&#39;Data.csv&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fout</span><span class="p">)):</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">xl_dir</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fout</span><span class="p">)))</span>
                
        <span class="n">fdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fout</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fdir</span><span class="p">)</span>
            
        <span class="n">var_labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;variables_labels&quot;</span><span class="p">]</span>
        <span class="n">saveToExcel</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fout</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">variable_names</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span>
                    <span class="n">var_labels</span><span class="o">=</span><span class="n">var_labels</span><span class="p">,</span><span class="n">par_values</span><span class="o">=</span><span class="n">par_values</span><span class="p">,</span>
                    <span class="n">par_names</span><span class="o">=</span><span class="n">par_names</span><span class="p">,</span><span class="n">output_variables</span><span class="o">=</span><span class="n">output_variables</span><span class="p">,</span>
                    <span class="n">rng</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span><span class="n">Npaths</span><span class="o">=</span><span class="n">Npaths</span><span class="p">)</span>
        
        <span class="c1"># if n &lt; 10000:  #Python sqlite database has a limited number of columns</span>
        <span class="c1">#     # Save solution to Python database</span>
        <span class="c1">#     data_dir = os.path.dirname(os.path.abspath(fout))</span>
        <span class="c1">#     if shocks_file_path is None:</span>
        <span class="c1">#         dbfilename = os.path.abspath(os.path.join(data_dir,&#39;db/sol.sqlite&#39;))</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         name,ext = os.path.splitext(os.path.basename(shocks_file_path))</span>
        <span class="c1">#         dbfilename = os.path.abspath(os.path.join(data_dir,&#39;db&#39;,name+&#39;.sqlite&#39;))</span>
        <span class="c1">#     sqlitedir = os.path.dirname(dbfilename)</span>
        <span class="c1">#     if not os.path.isdir(sqlitedir):</span>
        <span class="c1">#         os.makedirs(sqlitedir)</span>
        <span class="c1">#     if dates is None:</span>
        <span class="c1">#         saveToDatabase(dbfilename=dbfilename,data=np.array(yy),columns=s)</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         saveToDatabase(dbfilename=dbfilename,data=np.array(yy),columns=np.append([&quot;PATH&quot;,&quot;DATE&quot;],s),dates=dates)</span>

    
    <span class="k">if</span> <span class="n">graph_info</span><span class="p">:</span>
        <span class="n">plotImage</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">figures_dir</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="n">img_file_name</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="n">Plot</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">sample</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">isLinear</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">param_orig_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">param_names</span><span class="p">]</span>
            <span class="n">plotHistogram</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">figures_dir</span><span class="p">,</span><span class="n">priors</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">priors</span><span class="p">,</span>
                          <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">param_names</span><span class="p">,</span>
                          <span class="n">parameters</span><span class="o">=</span><span class="n">param_orig_values</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
                 
            
        <span class="c1"># Plot eigen values</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ev</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span> 
            <span class="n">plotEigenValues</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">figures_dir</span><span class="p">,</span><span class="n">ev</span><span class="o">=</span><span class="n">ev</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">decomp_variables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting Endogenous Variables&quot;</span><span class="p">)</span>
            <span class="n">var_labels</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;variables_labels&quot;</span><span class="p">,{})</span>
            <span class="n">plot</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">figures_dir</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">variable_names</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span>
                 <span class="n">meas_values</span><span class="o">=</span><span class="n">meas_df</span><span class="p">,</span><span class="n">meas_variables</span><span class="o">=</span><span class="n">measurement_variables</span><span class="p">,</span>
                 <span class="n">lrx_filter</span><span class="o">=</span><span class="n">lrx_filter</span><span class="p">,</span><span class="n">hp_filter</span><span class="o">=</span><span class="n">hp_filter</span><span class="p">,</span><span class="n">Tmax</span><span class="o">=</span><span class="n">Tmax</span><span class="p">,</span>
                 <span class="n">output_variables</span><span class="o">=</span><span class="n">output_variables</span><span class="p">,</span><span class="n">var_labels</span><span class="o">=</span><span class="n">var_labels</span><span class="p">,</span>
                 <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span><span class="n">rng_meas</span><span class="o">=</span><span class="n">rng_meas</span><span class="p">,</span><span class="n">irf</span><span class="o">=</span><span class="n">irf</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
                 <span class="n">Npaths</span><span class="o">=</span><span class="n">Npaths</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="n">Output</span><span class="p">)</span> <span class="c1"># ,steady_state=ss</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plotting Decomposition of Endogenous Variables&quot;</span><span class="p">)</span>
            <span class="n">plotDecomposition</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">figures_dir</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>
                              <span class="n">variables_names</span><span class="o">=</span><span class="n">variables</span><span class="p">,</span><span class="n">decomp_variables</span><span class="o">=</span><span class="n">decomp_variables</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span>
                              <span class="n">isKF</span><span class="o">=</span><span class="ow">not</span> <span class="n">meas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">,</span>
                              <span class="n">save</span><span class="o">=</span><span class="n">Output</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">runKalmanFilter</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">,</span><span class="n">dates</span><span class="p">,</span><span class="n">epsilonhat</span><span class="p">,</span><span class="n">etahat</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y</span><span class="p">,</span><span class="n">dates</span></div>

 
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">Python Platform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/modules.html">snowdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../info.html">Python Platform</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Alexei Goumilevski.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>