<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>snowdrop.src.utils.util &#8212; Python Platform 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for snowdrop.src.utils.util</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span> <span class="k">as</span> <span class="n">la</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">messagebox</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.misc.termcolor</span> <span class="kn">import</span> <span class="n">cprint</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.db</span> <span class="kn">import</span> <span class="n">create_sqlitefile</span><span class="p">,</span><span class="n">insert_values</span><span class="p">,</span><span class="n">get_data</span><span class="p">,</span><span class="n">print_data</span>
   
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">working_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s2">&quot;../..&quot;</span><span class="p">))</span>


<div class="viewcode-block" id="caseInsensitiveDict">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.caseInsensitiveDict">[docs]</a>
<span class="k">def</span> <span class="nf">caseInsensitiveDict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert keys of a dictionary to upper case.&quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">m</span></div>



<div class="viewcode-block" id="MyDict">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.MyDict">[docs]</a>
<span class="k">class</span> <span class="nc">MyDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary class with keys diagnostics.&quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Key: &quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; not found&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span></div>

        

<div class="viewcode-block" id="isPositiveDefinite">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.isPositiveDefinite">[docs]</a>
<span class="k">def</span> <span class="nf">isPositiveDefinite</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return true when input is positive-definite, via Cholesky.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">cholesky</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">lower</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="n">la</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span></div>

  
    
<div class="viewcode-block" id="nearestPositiveDefinite">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.nearestPositiveDefinite">[docs]</a>
<span class="k">def</span> <span class="nf">nearestPositiveDefinite</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the nearest positive-definite matrix to input.</span>

<span class="sd">    A Python/Numpy port of John D&#39;Errico&#39;s `nearestSPD` MATLAB code [1], which</span>
<span class="sd">    credits [2].</span>

<span class="sd">    Referemces:</span>
<span class="sd">        </span>
<span class="sd">        [1] https://www.mathworks.com/matlabcentral/fileexchange/42885-nearestspd</span>
<span class="sd">    </span>
<span class="sd">        [2] N.J. Higham, &quot;Computing a nearest symmetric positive semidefinite</span>
<span class="sd">        matrix&quot; (1988): https://doi.org/10.1016/0024-3795(88)90223-6</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">V</span><span class="p">))</span>
    <span class="n">A2</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span> <span class="o">+</span> <span class="n">H</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">A3</span> <span class="o">=</span> <span class="p">(</span><span class="n">A2</span> <span class="o">+</span> <span class="n">A2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">isPositiveDefinite</span><span class="p">(</span><span class="n">A3</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">A3</span>

    <span class="n">spacing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">spacing</span><span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
    <span class="c1"># The above is different from [1]. It appears that MATLAB&#39;s `chol` Cholesky</span>
    <span class="c1"># decomposition will accept matrixes with exactly 0-eigenvalue, whereas</span>
    <span class="c1"># Numpy&#39;s will not. So where [1] uses `eps(mineig)` (where `eps` is Matlab</span>
    <span class="c1"># for `np.spacing`), we use the above definition. CAVEAT: our `spacing`</span>
    <span class="c1"># will be much larger than [1]&#39;s `eps(mineig)`, since `mineig` is usually on</span>
    <span class="c1"># the order of 1e-16, and `eps(1e-16)` is on the order of 1e-34, whereas</span>
    <span class="c1"># `spacing` will, for Gaussian random matrixes of small dimension, be on</span>
    <span class="c1"># othe order of 1e-16. In practice, both ways converge, as the unit test</span>
    <span class="c1"># below suggests.</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">isPositiveDefinite</span><span class="p">(</span><span class="n">A3</span><span class="p">):</span>
        <span class="n">mineig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">la</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">A3</span><span class="p">)))</span>
        <span class="n">A3</span> <span class="o">+=</span> <span class="n">I</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">mineig</span> <span class="o">*</span> <span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">spacing</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">A3</span></div>


    
<div class="viewcode-block" id="save">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.save">[docs]</a>
<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">variable_names</span><span class="p">,</span><span class="n">dates</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save results either to a database or to an excel file based on file name extension.</span>
<span class="sd">       </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: The path to output file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param data: The 2D array of data.</span>
<span class="sd">        :type data: array.</span>
<span class="sd">        :param variable_names: List of output variables names.</span>
<span class="sd">        :type variable_names: list.</span>
<span class="sd">        :param dates: List of dates.</span>
<span class="sd">        :type dates: list.  </span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.sqlite&quot;</span><span class="p">:</span>
        <span class="n">saveToDatabase</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">variable_names</span><span class="p">,</span><span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
        <span class="n">saveToExcel</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">variable_names</span><span class="o">=</span><span class="n">variable_names</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">messagebox</span><span class="o">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s2">&quot;Input File Extension&quot;</span><span class="p">,</span><span class="s2">&quot;Only saving of data to files with extensions: sqlite or csv is supported! </span><span class="se">\n</span><span class="s2">You are trying to save data to a file with extension: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span></div>

 
    
<div class="viewcode-block" id="saveToDatabase">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.saveToDatabase">[docs]</a>
<span class="k">def</span> <span class="nf">saveToDatabase</span><span class="p">(</span><span class="n">dbfilename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">columns</span><span class="p">,</span><span class="n">dates</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save data to Python sqlite database.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param dbfilename: Path to output sqlite database file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param data: The 2D array of data.</span>
<span class="sd">        :type data: array.</span>
<span class="sd">        :param columns: List of output variables names.</span>
<span class="sd">        :type columns: list.</span>
<span class="sd">        :param dates: List of dates.</span>
<span class="sd">        :type dates: list.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">create_sqlitefile</span><span class="p">(</span><span class="n">dbfilename</span><span class="p">,</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">insert_values</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">dates</span><span class="p">)</span></div>

    
    
<div class="viewcode-block" id="saveToExcel">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.saveToExcel">[docs]</a>
<span class="k">def</span> <span class="nf">saveToExcel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">par_values</span><span class="p">,</span><span class="n">variable_names</span><span class="p">,</span><span class="n">var_labels</span><span class="o">=</span><span class="p">{},</span><span class="n">output_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">par_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Npaths</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save results to excel file.</span>
<span class="sd">        </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to output excel file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :type data: Data array.</span>
<span class="sd">        :param data: numpy.array.</span>
<span class="sd">        :type par_values: Parameters values.</span>
<span class="sd">        :param par_values: list.</span>
<span class="sd">        :param variable_names: Variables names.</span>
<span class="sd">        :type variable_names: list.</span>
<span class="sd">        :param var_labels: Variables labels.</span>
<span class="sd">        :type var_labels: list.</span>
<span class="sd">        :param variable_names: Variables names.</span>
<span class="sd">        :type variable_names: list.</span>
<span class="sd">        :param output_variables: List of output variables names.</span>
<span class="sd">        :type output_variables: list.</span>
<span class="sd">        :param par_names: List of parameters names.</span>
<span class="sd">        :type par_names: list.</span>
<span class="sd">        :param rng: List of dates.</span>
<span class="sd">        :type rng: list.</span>
<span class="sd">        :param Npaths: Number of simulation paths.</span>
<span class="sd">        :type Npaths: int.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../../data/Data.csv&#39;</span><span class="p">))</span>
              
    <span class="c1"># Sort variables by name</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variable_names</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">variable_names</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">]</span>
    <span class="c1"># Filter out lead and lag variables</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">var_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;_plus_&#39;</span> <span class="ow">in</span> <span class="n">n</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;_minus_&#39;</span> <span class="ow">in</span> <span class="n">n</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;__&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">output_variables</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">output_variables</span><span class="p">:</span>
                    <span class="n">output_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="n">names</span> <span class="o">=</span> <span class="n">var_names</span> <span class="o">+</span> <span class="n">par_names</span>
    <span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Dates&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">names</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">var_names</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Npaths</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">Npaths</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">columns</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">var_labels</span><span class="p">):</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">var_labels</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot;;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">var_labels</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="s2">&quot;Comments,&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">labels</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">yIter</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yIter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">dim1</span><span class="p">,</span><span class="n">dim2</span> <span class="o">=</span> <span class="n">yIter</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">if</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">dim1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">T</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dim1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">yIter</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">indices</span><span class="p">]</span> 
                <span class="k">if</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">year</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">rng</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">par_values</span><span class="p">))</span> <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">par_values</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>


   
<div class="viewcode-block" id="saveScenariosToExcel">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.saveScenariosToExcel">[docs]</a>
<span class="k">def</span> <span class="nf">saveScenariosToExcel</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">scenarios</span><span class="p">,</span><span class="n">par_values</span><span class="p">,</span><span class="n">variables_names</span><span class="p">,</span><span class="n">variables_labels</span><span class="p">,</span><span class="n">output_variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">par_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save results to excel file.</span>
<span class="sd">        </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to output excel file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :type scenarios: Scenarios.</span>
<span class="sd">        :param scenarios: list.</span>
<span class="sd">        :type par_values: Data array.</span>
<span class="sd">        :param par_values: list.</span>
<span class="sd">        :param variables_names: Variables names.</span>
<span class="sd">        :type variables_names: list.</span>
<span class="sd">        :param output_variables: List of output variables names.</span>
<span class="sd">        :type output_variables: list.</span>
<span class="sd">        :param par_names: List of parameters names.</span>
<span class="sd">        :type par_names: list.</span>
<span class="sd">        :param rng: List of dates.</span>
<span class="sd">        :type rng: list.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">xlsxwriter</span> <span class="k">as</span> <span class="nn">writer</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../../data/Data.csv&#39;</span><span class="p">))</span>
    <span class="n">fdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fdir</span><span class="p">)</span>
    
    <span class="c1"># Sort variables by name</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">variables_labels</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">variables_labels</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>  <span class="n">variables_names</span><span class="p">]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Dates&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">names</span> <span class="o">+</span> <span class="n">par_names</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">par_names</span><span class="p">)</span>
    
    <span class="n">wb</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">Workbook</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">scenario</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scenarios</span><span class="p">):</span>
        <span class="n">wsht_name</span> <span class="o">=</span> <span class="s2">&quot;Baseline&quot;</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;Scenario #&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">wsht</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span><span class="n">wsht_name</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Write variables names</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
            <span class="n">wsht</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
        <span class="c1"># Write dates</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">rng</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> 
            <span class="n">wsht</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y&quot;</span><span class="p">))</span>
        <span class="c1"># Write series</span>
        <span class="n">nrows</span><span class="p">,</span><span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">scen</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scenario</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">scen</span><span class="o">.</span><span class="n">values</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> 
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="n">wsht</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">col</span><span class="p">,</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>    
                    <span class="n">wsht</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">col</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
        <span class="c1"># Write parameters</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nparams</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">par_values</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> 
            <span class="n">wsht</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">ncols</span><span class="o">+</span><span class="n">col</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
            
    <span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
    <span class="n">wb</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">del</span> <span class="n">wb</span></div>

          

<div class="viewcode-block" id="saveTimeSeries">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.saveTimeSeries">[docs]</a>
<span class="k">def</span> <span class="nf">saveTimeSeries</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">sheetName</span><span class="o">=</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">postfix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save time series to excel file.</span>
<span class="sd">        </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to output excel file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param data: Data.</span>
<span class="sd">        :type data: pd.Series, list, dict.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fdir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fdir</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="n">x</span><span class="o">+</span><span class="n">postfix</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">excel_writer</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="n">sheetName</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">d</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">prefix</span><span class="o">+</span><span class="n">x</span><span class="o">+</span><span class="n">postfix</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="n">d</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">excel_writer</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">sheet_name</span><span class="o">=</span><span class="n">sheetName</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">),</span><span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">variables</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="n">postfix</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="n">postfix</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;to_pydatetime&#39;</span><span class="p">):</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">:</span>
                        <span class="n">rng</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>                    
                    <span class="n">rng</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span>
                
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">rng</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rng</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="n">ts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
                        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">txt</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span>

                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">txt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="read">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.read">[docs]</a>
<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read data either from a database or an excel file based on file name extension.</span>
<span class="sd">        </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to input file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param Output: Boolean variable.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../data/Data.csv&#39;</span><span class="p">))</span>
        
    <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.sqlite&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">readDataFromDatabase</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="n">Output</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.csv&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">readDataFromExcel</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="n">Output</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">messagebox</span><span class="o">.</span><span class="n">showwarning</span><span class="p">(</span><span class="s2">&quot;Input File Extension&quot;</span><span class="p">,</span><span class="s2">&quot;Only reading data of files with extensions: sqlite or csv is supported! </span><span class="se">\n</span><span class="s2">You are trying to read data from a file with extension: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span></div>

        
          
<div class="viewcode-block" id="readDataFromExcel">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.readDataFromExcel">[docs]</a>
<span class="k">def</span> <span class="nf">readDataFromExcel</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read data from excel file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to input file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param Output: Boolean variable.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../data/sol.sqlite&#39;</span><span class="p">))</span>
        
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">ln</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>
                
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
                
    <span class="k">if</span> <span class="n">Output</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                
    <span class="k">return</span> <span class="n">rows</span><span class="p">,</span><span class="n">columns</span></div>

    

<div class="viewcode-block" id="readDataFromDatabase">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.readDataFromDatabase">[docs]</a>
<span class="k">def</span> <span class="nf">readDataFromDatabase</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Output</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read data from database.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param fname: Path to input file.</span>
<span class="sd">        :type fname: str.</span>
<span class="sd">        :param Output: Boolean variable.</span>
<span class="sd">        :type Output: bool.</span>
<span class="sd">        :returns: rows and column names from database.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">dbfilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../data/sol.sqlite&#39;</span><span class="p">))</span>
        
    <span class="n">rows</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">dbfilename</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">Output</span><span class="p">:</span>
        <span class="n">print_data</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span><span class="n">rows</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">rows</span><span class="p">,</span><span class="n">columns</span></div>



<div class="viewcode-block" id="getNamesAndValues">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.getNamesAndValues">[docs]</a>
<span class="k">def</span> <span class="nf">getNamesAndValues</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[];</span><span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="n">els</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">els</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">els</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">els</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">els</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">names</span><span class="p">,</span> <span class="n">values</span></div>



<div class="viewcode-block" id="importModel">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.importModel">[docs]</a>
<span class="k">def</span> <span class="nf">importModel</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="n">startDate</span><span class="p">,</span><span class="n">endDate</span><span class="p">,</span><span class="n">shocks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write GUI form data to YAML template text file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param file_path: Path to output yaml file.</span>
<span class="sd">        :type file_path: str.</span>
<span class="sd">        :param startDate: Start date of simulation.</span>
<span class="sd">        :type startDate: str.</span>
<span class="sd">        :param endDate: End date of simulation.</span>
<span class="sd">        :type endDate: str.</span>
<span class="sd">        :param shocks: Dictionary of dates and corresponding shocks.</span>
<span class="sd">        :type shocks: dict.</span>
<span class="sd">        :return: Model object.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.utils.getXmlData</span> <span class="kn">import</span> <span class="n">readXmlModelFile</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.gui.mytable</span> <span class="kn">import</span> <span class="n">m</span><span class="p">,</span><span class="n">showTable</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.model.factory</span> <span class="kn">import</span> <span class="n">instantiate_model</span>
    
    <span class="n">txtEqs</span><span class="p">,</span><span class="n">txtParams</span><span class="p">,</span><span class="n">txtParamsRange</span><span class="p">,</span><span class="n">txtEndogVars</span><span class="p">,</span><span class="n">txtExogVars</span><span class="p">,</span><span class="n">txtShocks</span><span class="p">,</span><span class="n">txtRange</span><span class="p">,</span><span class="n">txtFreq</span><span class="p">,</span><span class="n">txtModelName</span> <span class="o">=</span> <span class="n">readXmlModelFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        
    <span class="n">frequencies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Annually&quot;</span><span class="p">:</span><span class="s2">&quot;YS&quot;</span><span class="p">,</span> <span class="s2">&quot;Quarterly&quot;</span><span class="p">:</span><span class="s2">&quot;QS&quot;</span><span class="p">,</span> <span class="s2">&quot;Monthly&quot;</span><span class="p">:</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span> <span class="s2">&quot;Weekly&quot;</span><span class="p">:</span><span class="s2">&quot;W&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily&quot;</span><span class="p">:</span><span class="s2">&quot;D&quot;</span><span class="p">}</span> 
    <span class="n">freqs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Annually&quot;</span><span class="p">,</span> <span class="s2">&quot;Quarterly&quot;</span><span class="p">,</span> <span class="s2">&quot;Monthly&quot;</span><span class="p">,</span> <span class="s2">&quot;Weekly&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily&quot;</span><span class="p">]</span>
    
    <span class="n">start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">endDate</span><span class="p">,</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="n">frequencies</span><span class="p">[</span><span class="n">txtFreq</span><span class="p">])</span><span class="o">.</span><span class="n">date</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="p">[[</span><span class="n">start</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">start</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">start</span><span class="o">.</span><span class="n">day</span><span class="p">],[</span><span class="n">end</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">end</span><span class="o">.</span><span class="n">month</span><span class="p">,</span><span class="n">end</span><span class="o">.</span><span class="n">day</span><span class="p">]]</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
            
    <span class="n">paramNames</span><span class="p">,</span><span class="n">paramValues</span> <span class="o">=</span> <span class="n">getNamesAndValues</span><span class="p">(</span><span class="n">txtParams</span><span class="p">)</span>
    <span class="n">endogVariablesNames</span><span class="p">,</span><span class="n">endogVariablesValues</span> <span class="o">=</span> <span class="n">getNamesAndValues</span><span class="p">(</span><span class="n">txtEndogVars</span><span class="p">)</span>
    <span class="n">exogVariablesNames</span><span class="p">,</span><span class="n">exogVariablesValues</span> <span class="o">=</span> <span class="n">getNamesAndValues</span><span class="p">(</span><span class="n">txtExogVars</span><span class="p">)</span>
    <span class="n">shockNames</span><span class="p">,</span> <span class="n">shockValues</span> <span class="o">=</span> <span class="n">getNamesAndValues</span><span class="p">(</span><span class="n">txtShocks</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">shocks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vals</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">shockNames</span><span class="p">)</span>
        <span class="n">showTable</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Shock Editor&quot;</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">shockNames</span><span class="p">,</span><span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">shocks</span> <span class="o">=</span> <span class="n">m</span>   
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Date </span><span class="si">{0}</span><span class="s2">: shock </span><span class="si">{1}</span><span class="s2">=</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">sh</span><span class="p">))</span>
                
    <span class="n">calibration</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">eqs</span> <span class="o">=</span> <span class="n">txtEqs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;Sirius Model&quot;</span>
    
    <span class="n">equations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">eq</span> <span class="ow">in</span> <span class="n">eqs</span><span class="p">:</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span><span class="s2">&quot;**&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="n">equations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">equations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eq</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">endogVariablesNames</span><span class="p">,</span><span class="n">endogVariablesValues</span><span class="p">):</span>
        <span class="n">calibration</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">exogVariablesNames</span><span class="p">,</span><span class="n">exogVariablesValues</span><span class="p">):</span>
        <span class="n">calibration</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">paramNames</span><span class="p">,</span><span class="n">paramValues</span><span class="p">):</span>
        <span class="n">calibration</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                
    <span class="n">symbols</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">endogVariablesNames</span><span class="p">,</span> <span class="s2">&quot;shocks&quot;</span><span class="p">:</span> <span class="n">shockNames</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="n">paramNames</span><span class="p">}</span>
        
    <span class="n">periods</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Get periods</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">shocks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;%Y/%m/</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">d2</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">d1</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="p">:</span>
                <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                
    <span class="n">shock_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Get shocks list</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">shocks</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">shocks</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">shockNames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">shock_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
            
    <span class="n">freq</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">))</span> <span class="k">if</span> <span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">txtFreq</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;shock_values&quot;</span><span class="p">:</span> <span class="n">shock_values</span><span class="p">,</span> <span class="s2">&quot;range&quot;</span><span class="p">:</span> <span class="n">rng</span><span class="p">,</span> <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s2">&quot;periods&quot;</span><span class="p">:</span> <span class="n">periods</span><span class="p">}</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;calibration&quot;</span><span class="p">:</span> <span class="n">calibration</span><span class="p">,</span> <span class="s2">&quot;equations&quot;</span><span class="p">:</span> <span class="n">equations</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="n">options</span><span class="p">,</span> <span class="s2">&quot;symbols&quot;</span><span class="p">:</span> <span class="n">symbols</span><span class="p">}</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">instantiate_model</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">file_path</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">model</span></div>

        
    
<div class="viewcode-block" id="SaveToYaml">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.SaveToYaml">[docs]</a>
<span class="k">def</span> <span class="nf">SaveToYaml</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;YAML Model&quot;</span><span class="p">,</span><span class="n">shock_names</span><span class="o">=</span><span class="p">[],</span><span class="n">shock_values</span><span class="o">=</span><span class="p">[],</span>
             <span class="n">variables_names</span><span class="o">=</span><span class="p">[],</span><span class="n">variables_init_values</span><span class="o">=</span><span class="p">[],</span><span class="n">param_names</span><span class="o">=</span><span class="p">[],</span>
             <span class="n">param_values</span><span class="o">=</span><span class="p">[],</span><span class="n">exog_var</span><span class="o">=</span><span class="p">[],</span><span class="n">equations</span><span class="o">=</span><span class="p">[],</span><span class="n">varLabels</span><span class="o">=</span><span class="p">{},</span><span class="n">eqsLabels</span><span class="o">=</span><span class="p">[],</span>
             <span class="n">comments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">time_range</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">param_range</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">bInp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write GUI form data to YAML template text file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param file: Path to output yaml file.</span>
<span class="sd">        :type file: str.</span>
<span class="sd">        :param description: Description of model.</span>
<span class="sd">        :type description: str.</span>
<span class="sd">        :param shock_names: List of shock names.</span>
<span class="sd">        :type shock_names: List.</span>
<span class="sd">        :param shock_values: List of shock values.</span>
<span class="sd">        :type shock_values: List.</span>
<span class="sd">        :param variables_names: Variables names.</span>
<span class="sd">        :type variables_names: List.</span>
<span class="sd">        :param variables_init_values: Initial values of variables.</span>
<span class="sd">        :type variables_init_values: List.</span>
<span class="sd">        :param param_names: Names of parameters.</span>
<span class="sd">        :type param_names: List.</span>
<span class="sd">        :param param_values: Values of parameters.</span>
<span class="sd">        :type param_values: List.</span>
<span class="sd">        :param exog_var: Exogenous variables.</span>
<span class="sd">        :type exog_var: List.</span>
<span class="sd">        :param equations: Model equations.</span>
<span class="sd">        :type equations: List.</span>
<span class="sd">        :param varLabels: Variables labels.</span>
<span class="sd">        :type varLabels: List.</span>
<span class="sd">        :param eqsLabels: Equations labels.</span>
<span class="sd">        :type eqsLabels: List.</span>
<span class="sd">        :param comments: Equations comments.</span>
<span class="sd">        :type comments: List.</span>
<span class="sd">        :param time_range: Time range.</span>
<span class="sd">        :type time_range: str.</span>
<span class="sd">        :param freq: Frequency of time series.</span>
<span class="sd">        :type freq: str.</span>
<span class="sd">        :param periods: Periods in which shocks are applied.</span>
<span class="sd">        :type periods: List.</span>
<span class="sd">        :param param_range: Range of parameters.</span>
<span class="sd">        :type param_range: List.</span>
<span class="sd">        :param bInp: Flag that is used to indicate that a steady-state and a dynamic models should be generated.</span>
<span class="sd">        :type bInp: bool.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fout</span> <span class="o">=</span> <span class="s1">&#39;template&#39;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="n">fdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../../models&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">fout</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">fdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span><span class="n">fout</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span><span class="p">))</span>
    <span class="n">file_path_dyn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span><span class="n">fout</span> <span class="o">+</span> <span class="s1">&#39;.yaml&#39;</span><span class="p">))</span>
    <span class="n">file_path_ss</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span><span class="n">fout</span> <span class="o">+</span> <span class="s1">&#39;_ss.yaml&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;.inp&quot;</span><span class="p">:</span>
            <span class="n">file_path_dyn</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="n">ext</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_dyn.yaml&quot;</span><span class="p">)</span>
            <span class="n">file_path_ss</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="n">ext</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;_ss.yaml&quot;</span><span class="p">)</span>
    
    <span class="c1"># Replace curly brackets</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">equations</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">equations</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">equations</span><span class="p">)</span>
    <span class="n">equations</span> <span class="o">=</span> <span class="n">equations</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
    <span class="n">eqs</span> <span class="o">=</span> <span class="n">equations</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">eqs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">eqs</span><span class="p">))</span>
    
    <span class="c1"># Check equations labels</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eqsLabels</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">eqsLabels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">eqs</span><span class="p">):</span>
        <span class="n">eqsLabels</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">eqs</span><span class="p">)</span>
            
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exog_var</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="n">exog_var</span> <span class="o">=</span> <span class="n">exog_var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">exog_var</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="n">new_param_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">param_names</span><span class="o">+</span><span class="n">temp</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">shock_names</span><span class="p">)</span>
    
    
    <span class="k">if</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">bInp</span> <span class="ow">and</span> <span class="s2">&quot;_ss&quot;</span> <span class="ow">in</span> <span class="n">equations</span><span class="p">:</span> <span class="c1">#ag</span>
        
        <span class="c1"># Create dynamic model file</span>
        <span class="n">Output</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">file_path_dyn</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">variables_names</span><span class="p">,</span><span class="n">shock_names</span><span class="p">,</span><span class="n">new_param_names</span><span class="p">,</span>
           <span class="n">eqs</span><span class="p">,</span><span class="n">param_names</span><span class="p">,</span><span class="n">param_values</span><span class="p">,</span><span class="n">exog_var</span><span class="p">,</span><span class="n">variables_init_values</span><span class="p">,</span><span class="n">time_range</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">periods</span><span class="p">,</span>
           <span class="n">shock_values</span><span class="p">,</span><span class="n">param_range</span><span class="p">,</span><span class="n">eqsLabels</span><span class="o">=</span><span class="n">eqsLabels</span><span class="p">,</span><span class="n">varLabels</span><span class="o">=</span><span class="n">varLabels</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span><span class="n">bInp</span><span class="o">=</span><span class="n">bInp</span><span class="p">)</span>
            
        <span class="c1"># Create steady-state model file</span>
        <span class="n">Output</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="n">file_path_ss</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">variables_names</span><span class="p">,</span><span class="n">shock_names</span><span class="p">,</span><span class="n">new_param_names</span><span class="p">,</span>
           <span class="n">eqs</span><span class="p">,</span><span class="n">param_names</span><span class="p">,</span><span class="n">param_values</span><span class="p">,</span><span class="n">exog_var</span><span class="p">,</span><span class="n">variables_init_values</span><span class="p">,</span><span class="n">time_range</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">periods</span><span class="p">,</span>
           <span class="n">shock_values</span><span class="p">,</span><span class="n">param_range</span><span class="p">,</span><span class="n">eqsLabels</span><span class="o">=</span><span class="n">eqsLabels</span><span class="p">,</span><span class="n">varLabels</span><span class="o">=</span><span class="n">varLabels</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">,</span><span class="n">bInp</span><span class="o">=</span><span class="n">bInp</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        
        <span class="c1"># Create template model file</span>
        <span class="n">Output</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">file_path</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">variables_names</span><span class="p">,</span><span class="n">shock_names</span><span class="p">,</span><span class="n">new_param_names</span><span class="p">,</span>
           <span class="n">eqs</span><span class="p">,</span><span class="n">param_names</span><span class="p">,</span><span class="n">param_values</span><span class="p">,</span><span class="n">exog_var</span><span class="p">,</span><span class="n">variables_init_values</span><span class="p">,</span><span class="n">time_range</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span><span class="n">periods</span><span class="p">,</span>
           <span class="n">shock_values</span><span class="p">,</span><span class="n">param_range</span><span class="p">,</span><span class="n">eqsLabels</span><span class="o">=</span><span class="n">eqsLabels</span><span class="p">,</span><span class="n">varLabels</span><span class="o">=</span><span class="n">varLabels</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="n">comments</span><span class="p">)</span></div>

      
        
<div class="viewcode-block" id="Output">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.Output">[docs]</a>
<span class="k">def</span> <span class="nf">Output</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">file_path</span><span class="p">,</span><span class="n">description</span><span class="p">,</span><span class="n">variables_names</span><span class="p">,</span><span class="n">shock_names</span><span class="p">,</span><span class="n">new_param_names</span><span class="p">,</span>
           <span class="n">eqs</span><span class="p">,</span><span class="n">param_names</span><span class="p">,</span><span class="n">param_values</span><span class="p">,</span><span class="n">exog_var</span><span class="p">,</span><span class="n">variables_init_values</span><span class="p">,</span><span class="n">time_range</span><span class="p">,</span><span class="n">freq</span><span class="p">,</span>
           <span class="n">periods</span><span class="p">,</span><span class="n">shock_values</span><span class="p">,</span><span class="n">param_range</span><span class="p">,</span><span class="n">eqsLabels</span><span class="o">=</span><span class="p">[],</span><span class="n">varLabels</span><span class="o">=</span><span class="p">{},</span><span class="n">comments</span><span class="o">=</span><span class="p">[],</span><span class="n">bInp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Output text to YAML model file.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">comments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">eqs</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;name: &#39;</span> <span class="o">+</span> <span class="n">description</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;symbols: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   variables : [&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   shocks : [&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shock_names</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   parameters : [&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_param_names</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">equations: </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
             <span class="k">for</span> <span class="n">lb</span><span class="p">,</span><span class="n">eq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">comments</span><span class="p">,</span><span class="n">eqs</span><span class="p">):</span>
                 <span class="k">if</span> <span class="ow">not</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   # &#39;</span> <span class="o">+</span> <span class="n">lb</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> 
                 <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="n">lable</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">eq</span> <span class="o">=</span> <span class="n">lable</span> <span class="o">+</span> <span class="s2">&quot; : &quot;</span> <span class="o">+</span> <span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span>
                 <span class="k">if</span> <span class="n">bInp</span> <span class="ow">and</span> <span class="s2">&quot;_ss&quot;</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
                     <span class="k">continue</span>
                 <span class="n">e</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                 <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   - &#39;</span> <span class="o">+</span> <span class="n">e</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">neqs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">eqs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">neqs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">neqs</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">eq1</span> <span class="o">=</span> <span class="n">eqs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">eq2</span> <span class="o">=</span> <span class="n">eqs</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="s2">&quot;_ss&quot;</span> <span class="ow">in</span> <span class="n">eq2</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">eq2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_ss&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">eq1</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">lastEq</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">if</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   - &#39;</span> <span class="o">+</span> <span class="n">e</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">eq2</span> <span class="o">=</span> <span class="n">eqs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">eqs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">eq2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_ss&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">e</span> <span class="ow">and</span> <span class="n">lastEq</span> <span class="o">!=</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;   - &#39;</span> <span class="o">+</span> <span class="n">e</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">calibration:&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   # PARAMETERS&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param_names</span><span class="p">,</span><span class="n">param_values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="ow">and</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   &#39;</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   # EXOGENOUS VARIABLES&#39;</span><span class="p">)</span>  
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">exog_var</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   &#39;</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="s2">&quot; : &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   # STARTING VALUES OF ENDOGENOUS VARIABLES&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">variables_names</span><span class="p">,</span><span class="n">variables_init_values</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   &#39;</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">varLabels</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">labels:&#39;</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">varLabels</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   &#39;</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">varLabels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">options:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time_range</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;[&quot;</span> <span class="ow">in</span> <span class="n">time_range</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   range : &#39;</span> <span class="o">+</span> <span class="n">time_range</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   T : &#39;</span> <span class="o">+</span> <span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shock_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   frequency : &#39;</span> <span class="o">+</span> <span class="n">freq</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">periods</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   periods : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">periods</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">   shock_values : [[&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">shock_values</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;]]&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">param_range</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">,</span><span class="s2">&quot; : &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">left</span><span class="p">,</span><span class="n">right</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">right</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">   &#39;</span> <span class="o">+</span> <span class="n">left</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">right</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span></div>

        
<div class="viewcode-block" id="getNamesValues">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.getNamesValues">[docs]</a>
<span class="k">def</span> <span class="nf">getNamesValues</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return list of names and values.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param arr: Array</span>
<span class="sd">        :type arr: List.</span>
<span class="sd">        :return: Variables names and values</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">names</span><span class="p">,</span><span class="n">values</span></div>

     
    
<div class="viewcode-block" id="tracefunc">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.tracefunc">[docs]</a>
<span class="k">def</span> <span class="nf">tracefunc</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Trace calls to a function.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">&quot;call&quot;</span><span class="p">:</span>
        <span class="n">indent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&gt; call function &quot;</span><span class="p">,</span>  <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s2">&quot;return&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="n">indent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;exit function &quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">indent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">tracefunc</span></div>


    
<div class="viewcode-block" id="deleteFiles">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.deleteFiles">[docs]</a>
<span class="k">def</span> <span class="nf">deleteFiles</span><span class="p">(</span><span class="n">path_to_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete files in a directory matching a pattern.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_to_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_dir</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>



<div class="viewcode-block" id="correctLabel">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.correctLabel">[docs]</a>
<span class="k">def</span> <span class="nf">correctLabel</span><span class="p">(</span><span class="n">lbl</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Correct a variable name.</span>
<span class="sd">    </span>
<span class="sd">    For example, variable name x_minus_1 will be changed to x(-1)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ind1</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_plus_&quot;</span><span class="p">)</span>
    <span class="n">ind2</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_minus_&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ind1</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">ind2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lbl</span>
    <span class="n">ind3</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="n">digit</span> <span class="o">=</span> <span class="n">digit1</span> <span class="o">=</span> <span class="n">lbl</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind3</span><span class="p">:]</span>
    <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">digit</span> <span class="ow">and</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">digit</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">digit</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
        <span class="n">digit2</span> <span class="o">=</span> <span class="n">digit</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">digit3</span> <span class="o">=</span> <span class="n">digit</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">digit1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">digit2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">digit3</span><span class="p">))</span>
            
    <span class="n">name</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_plus_&quot;</span><span class="o">+</span><span class="n">digit</span><span class="p">,</span><span class="s2">&quot;(&quot;</span><span class="o">+</span><span class="n">digit1</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_minus_&quot;</span><span class="o">+</span><span class="n">digit</span><span class="p">,</span><span class="s2">&quot;(-&quot;</span><span class="o">+</span><span class="n">digit1</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">name</span></div>



<div class="viewcode-block" id="getMap">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.getMap">[docs]</a>
<span class="k">def</span> <span class="nf">getMap</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return map of model variable names to report variable names.&quot;&quot;&quot;</span>
    <span class="n">m</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">m</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">m</span>        </div>

    

<div class="viewcode-block" id="correctVariablesNames">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.correctVariablesNames">[docs]</a>
<span class="k">def</span> <span class="nf">correctVariablesNames</span><span class="p">(</span><span class="n">variable_names</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Correct names of FSGM model variables so that they are consistent with names of variables of Fame reports.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">re</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">fname</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;../../data/map.csv&#39;</span><span class="p">))</span>
    <span class="n">variablesMap</span> <span class="o">=</span> <span class="n">getMap</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variable_names</span><span class="p">)):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">variable_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">variablesMap</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
               <span class="n">v</span> <span class="o">=</span> <span class="n">variablesMap</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">:</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="n">n</span><span class="p">[:</span><span class="n">j</span><span class="p">]</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">n2</span> <span class="ow">in</span> <span class="n">variablesMap</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">variablesMap</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span>
            <span class="n">variable_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> 
            <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="s2">&quot; -&gt; &quot;</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">variable_names</span></div>



<div class="viewcode-block" id="correctHeaderOfCsvFile">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.correctHeaderOfCsvFile">[docs]</a>
<span class="k">def</span> <span class="nf">correctHeaderOfCsvFile</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span><span class="n">fout</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Correct header of Csv files so that names of variables are consistent with names of variables of Fame reports.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        
    <span class="n">header</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_variables_names</span> <span class="o">=</span> <span class="n">correctVariablesNames</span><span class="p">(</span><span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>
        
    <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_variables_names</span><span class="p">)</span>
       
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">new_variables_names</span></div>



<div class="viewcode-block" id="correctHeaders">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.correctHeaders">[docs]</a>
<span class="k">def</span> <span class="nf">correctHeaders</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Correct columns names.&quot;&quot;&quot;</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">fin</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">&quot;../../data/&quot;</span> <span class="o">+</span> <span class="n">fname</span><span class="p">))</span>
    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s2">&quot;../../../FSGMreports/BASE/Data/&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_folder</span><span class="p">):</span>
        <span class="n">fout</span> <span class="o">=</span> <span class="n">out_folder</span> <span class="o">+</span> <span class="n">fname</span>
        <span class="n">correctHeaderOfCsvFile</span><span class="p">(</span><span class="n">fin</span><span class="o">=</span><span class="n">fin</span><span class="p">,</span><span class="n">fout</span><span class="o">=</span><span class="n">fout</span><span class="p">)</span></div>



<div class="viewcode-block" id="getExogenousSeries">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.getExogenousSeries">[docs]</a>
<span class="k">def</span> <span class="nf">getExogenousSeries</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert exogenous series to 2D array.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.f</span>
<span class="sd">        :return: Pandas data frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;0&quot;</span><span class="p">:</span><span class="s2">&quot;YS&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">:</span><span class="s2">&quot;QS&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">:</span><span class="s2">&quot;MS&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">:</span><span class="s2">&quot;W&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">:</span><span class="s2">&quot;D&quot;</span><span class="p">}</span> <span class="c1">#Annually,Quarterly,Monthly,Weekly,Daily</span>
    
    <span class="n">freq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;freq&quot;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;frequency&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="mi">0</span>
            
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">exog_data</span>
    <span class="n">exog_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
        <span class="n">model</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
        <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rng</span><span class="p">,</span><span class="n">dates</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">T</span> <span class="o">=</span> <span class="n">simulationRange</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>   
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">exo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">ser</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">exo</span><span class="p">]</span>
                <span class="n">ser</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">ser</span><span class="p">[</span><span class="n">index</span><span class="o">&lt;</span><span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">ser</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
                <span class="n">exog_data</span><span class="p">[</span><span class="n">exo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ser</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span>
                
            <span class="k">return</span> <span class="n">exog_data</span>
                    
        <span class="k">for</span> <span class="n">exo</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">ser</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">exo</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ser</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ser</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">frequencies</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">index</span>
                <span class="n">val</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">ind1</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
                <span class="n">ind2</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">notna</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">ser</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">ser</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">ser</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-10</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="mf">1.e-10</span>
                    <span class="n">val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
  
                <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="n">ser2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">val</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">dates</span><span class="p">)</span>
                <span class="n">ser2</span><span class="o">.</span><span class="n">bfill</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ser2</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ser2</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">1.e-10</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">ser2</span><span class="o">.</span><span class="n">values</span>
                
                <span class="c1">#TODO Period zero is starting values. Check if zero should be inserted at the beginning.</span>
                <span class="n">exog_data</span><span class="p">[</span><span class="n">exo</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>                     
                      
            <span class="k">if</span> <span class="n">debug</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">val</span><span class="p">)):</span>
                <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Series </span><span class="si">{</span><span class="n">exo</span><span class="si">}</span><span class="s2"> contains NAN values.  Replacing Nans with previous or later values...&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                      
    <span class="k">return</span> <span class="n">exog_data</span></div>

                        
            

<div class="viewcode-block" id="simulationRange">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.simulationRange">[docs]</a>
<span class="k">def</span> <span class="nf">simulationRange</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return and set the  date range of simulations.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.</span>
<span class="sd">        :param freq: Dates frequency.</span>
<span class="sd">        :type freq: str.</span>
<span class="sd">        :param T: Time span of simulations.</span>
<span class="sd">        :type T: int.</span>
<span class="sd">        :return: pandas date_range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;0&quot;</span><span class="p">:</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">:</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">:</span><span class="s2">&quot;M&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">:</span><span class="s2">&quot;W&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">:</span><span class="s2">&quot;D&quot;</span><span class="p">}</span> <span class="c1">#Annually,Quarterly,Monthly,Weekly,Daily</span>
    <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rng</span><span class="p">,</span><span class="n">dates</span><span class="p">,</span><span class="n">Time</span><span class="p">,</span><span class="n">start_filter</span><span class="p">,</span><span class="n">end_filter</span><span class="p">,</span><span class="n">filter_rng</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
    
    <span class="k">if</span> <span class="n">freq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;frequency&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="mi">0</span>
            
    <span class="k">if</span> <span class="s1">&#39;range&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;range&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">start_filter</span> <span class="o">=</span> <span class="n">start</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">end_filter</span> <span class="o">=</span> <span class="n">end</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">rng</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="n">frequencies</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">end</span><span class="o">.</span><span class="n">year</span><span class="o">-</span><span class="n">start</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rng</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">Time</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">end</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
                <span class="n">rng</span> <span class="o">=</span> <span class="n">rng</span><span class="p">[:</span><span class="n">T</span><span class="p">]</span>
                <span class="n">Time</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">year</span><span class="p">,</span><span class="n">end</span><span class="o">.</span><span class="n">year</span><span class="o">+</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#Time = dates.datestr2num(rng.strftime(&#39;%B %d, %Y&#39;))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                    <span class="n">T</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">T</span> <span class="o">=</span> <span class="mi">101</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2025</span><span class="o">+</span><span class="n">T</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="n">frequencies</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">end</span><span class="o">.</span><span class="n">year</span><span class="o">-</span><span class="n">start</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%Y&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rng</span><span class="p">]</span>
            <span class="n">Time</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">T</span> <span class="o">=</span> <span class="mi">101</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">T</span>
        <span class="n">Time</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">rng</span>
              
    <span class="k">if</span> <span class="s1">&#39;filter_range&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
        <span class="n">rngf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;filter_range&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rngf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rngf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">start_filter</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">rngf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">previous_period</span> <span class="o">=</span> <span class="n">start_filter</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">previous_period</span> <span class="o">=</span> <span class="n">start_filter</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">previous_period</span> <span class="o">=</span> <span class="n">start_filter</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">previous_period</span> <span class="o">=</span> <span class="n">start_filter</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">previous_period</span> <span class="o">=</span> <span class="n">start_filter</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">previous_period</span> <span class="o">&lt;</span> <span class="n">start</span><span class="p">:</span>
                <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Changing starting date &#39;</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">&#39; to &#39;</span><span class="si">{</span><span class="n">previous_period</span><span class="si">}</span><span class="s2">&#39; to ensure that filtartion starts after starting date&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">previous_period</span>
            <span class="n">end_filter</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">rngf</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">filter_rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start_filter</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="n">end_filter</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="n">frequencies</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">freq</span><span class="p">)])</span>
        
    <span class="n">model</span><span class="o">.</span><span class="n">date_range</span> <span class="o">=</span> <span class="n">dates</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
        
    <span class="k">return</span> <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">rng</span><span class="p">,</span><span class="n">dates</span><span class="p">,</span><span class="n">start_filter</span><span class="p">,</span><span class="n">end_filter</span><span class="p">,</span><span class="n">filter_rng</span><span class="p">,</span><span class="n">Time</span><span class="p">,</span><span class="n">T</span></div>

        

<div class="viewcode-block" id="getDate">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.getDate">[docs]</a>
<span class="k">def</span> <span class="nf">getDate</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        <span class="c1">#date = dt.datetime.strptime(d,&#39;%Y-%m-%d&#39;)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
            <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
            <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> 
            <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">date</span></div>



<div class="viewcode-block" id="getPeriods">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.getPeriods">[docs]</a>
<span class="k">def</span> <span class="nf">getPeriods</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return list of periods.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param model: Model object.</span>
<span class="sd">        :type model: Model.</span>
<span class="sd">        :param T: Time span of simulations.</span>
<span class="sd">        :type T: int.</span>
<span class="sd">        :return: List of periods.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">periods</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s1">&#39;periods&#39;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
        <span class="n">per</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;periods&#39;</span><span class="p">,[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">per</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">per</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">per</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">periods</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">rngs</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">per</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
                            <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
                            <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> 
                            <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rngs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                            <span class="n">d1</span> <span class="o">=</span> <span class="n">rngs</span><span class="o">.</span><span class="n">date</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">d2</span> <span class="o">=</span> <span class="n">rngs</span><span class="o">.</span><span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">d1</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="p">:</span>
                                <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">per</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span> 
                <span class="k">if</span> <span class="n">per</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">periods</span> <span class="o">=</span> <span class="n">per</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">per</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rngs</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rngs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                        <span class="n">d1</span> <span class="o">=</span> <span class="n">rngs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">d2</span> <span class="o">=</span> <span class="n">rngs</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">d1</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="p">:</span>
                            <span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">break</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">per</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">int</span><span class="p">):</span>
                <span class="n">periods</span> <span class="o">=</span> <span class="n">per</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">per</span><span class="p">]</span>
                
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">rng</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">periods</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">per</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> 
                    <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> 
                    <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> 
                    <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">date</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">d2</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="n">d1</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">d2</span><span class="p">:</span>
                        <span class="n">periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    
    <span class="k">return</span> <span class="n">periods</span></div>


 
<div class="viewcode-block" id="findVariableLag">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.findVariableLag">[docs]</a>
<span class="k">def</span> <span class="nf">findVariableLag</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find lag of a variable given its name.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param x: Variable name.</span>
<span class="sd">        :type x: str.</span>
<span class="sd">        :return: Lag of a variable.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s1">&#39;_minus_&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_minus_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;_minus_&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">lag</span> <span class="o">-=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;_m&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_m&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;_m&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">lag</span> <span class="o">-=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">ind1</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
        <span class="n">ind2</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="n">lag</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind1</span><span class="p">:</span><span class="n">ind2</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">lag</span>  </div>


 
<div class="viewcode-block" id="findVariableLead">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.findVariableLead">[docs]</a>
<span class="k">def</span> <span class="nf">findVariableLead</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find lead of a variable given its name.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">        :param x: Variable name.</span>
<span class="sd">        :type x: str.</span>
<span class="sd">        :return: Lead of a variable.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lead</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s1">&#39;_plus_&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_plus_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;_plus_&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">lead</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;_p&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_p&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;_p&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">:]</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">lead</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">ind1</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
        <span class="n">ind2</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="n">lead</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind1</span><span class="p">:</span><span class="n">ind2</span><span class="p">])</span>
 
    
    <span class="k">return</span> <span class="n">lead</span></div>



<div class="viewcode-block" id="compare">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.compare">[docs]</a>
<span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="n">save</span><span class="p">,</span><span class="n">fnames</span><span class="p">,</span><span class="n">legends</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare time series in two excel files.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.utils.merge</span> <span class="kn">import</span> <span class="n">merge</span>

    <span class="c1"># Read data</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fnames</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="n">fname</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="n">var</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">variables</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">var</span><span class="p">]</span>
            
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">6</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="n">i</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">variables</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">ii</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">legends</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                    <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">ii</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s1">&#39;results/compare_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">))</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">outputFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;results/compare.pdf&quot;</span><span class="p">))</span>
        <span class="n">merge</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span><span class="n">files</span><span class="p">)</span> </div>

              
        
<div class="viewcode-block" id="getVariableValue">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.getVariableValue">[docs]</a>
<span class="k">def</span> <span class="nf">getVariableValue</span><span class="p">(</span><span class="n">eqs</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span><span class="n">v</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">var_names</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span><span class="n">m</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces variables in STEADY_STATE function with values.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        eqs : list</span>
<span class="sd">            Equations.</span>
<span class="sd">        v : str</span>
<span class="sd">            Name of a variable.</span>
<span class="sd">        var_names : list</span>
<span class="sd">            List of variables names.</span>
<span class="sd">        m : dict</span>
<span class="sd">            Map of varaiables names and values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Value of a variable.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>  
    <span class="k">for</span> <span class="n">eq</span> <span class="ow">in</span> <span class="n">eqs</span><span class="p">:</span>
        <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">eq</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">v</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">:</span>
                <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="s2">&quot;(-1)&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
                <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="s2">&quot;(+1)&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
                <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="s2">&quot;(1)&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">exec</span><span class="p">(</span><span class="n">eq</span><span class="p">,{</span><span class="s2">&quot;__builtins__&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span><span class="n">m</span><span class="p">)</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>


    
<div class="viewcode-block" id="replaceExpressions">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.replaceExpressions">[docs]</a>
<span class="k">def</span> <span class="nf">replaceExpressions</span><span class="p">(</span><span class="n">eqs</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces variables in STEADY_STATE function with values.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        eqs : list</span>
<span class="sd">            Equations.</span>
<span class="sd">        m : dict</span>
<span class="sd">            Map of varaiables names and values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Equations with replaced steady state values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="s2">&quot;STEADY_STATE&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="n">lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">eq</span> <span class="ow">in</span> <span class="n">eqs</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">while</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
            <span class="n">ind1</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
            <span class="n">ind2</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">ind1</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">eq</span><span class="p">[:</span><span class="n">ind1</span><span class="p">]</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="n">ind1</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ind2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">ind1</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">ind2</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;util.replaceExpressions error: missing closing parenthis.&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">+=</span> <span class="n">fn</span> <span class="o">+</span> <span class="s2">&quot;(&#39;&quot;</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="s2">&quot;&#39;)&quot;</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind2</span><span class="p">:]</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">eq</span>
        <span class="c1"># if fn in eqtn:</span>
        <span class="c1">#     print(&#39;eq:&#39;,eqtn,&#39;\n   &#39;,s)</span>
        <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">lst</span>       </div>

        
<div class="viewcode-block" id="saveLeadLagIncidence">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.saveLeadLagIncidence">[docs]</a>
<span class="k">def</span> <span class="nf">saveLeadLagIncidence</span><span class="p">(</span><span class="n">lli</span><span class="p">,</span><span class="n">isLinearModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store lead lag incidence matrix in a file.</span>
<span class="sd">    </span>
<span class="sd">    If model is non-linear delete the lead lag incidence file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        lli : numpy.array</span>
<span class="sd">            Matrix of variables leads and lags.</span>
<span class="sd">        isLinearModel : bool</span>
<span class="sd">            True if model is linear and False otherwise.</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;data/cpp/lli.csv&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">isLinearModel</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lli</span><span class="p">)):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lli</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span></div>

        
            
        
<div class="viewcode-block" id="create_config_file">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.create_config_file">[docs]</a>
<span class="k">def</span> <span class="nf">create_config_file</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">variables_names</span><span class="p">,</span><span class="n">initial_values</span><span class="p">,</span><span class="n">shock_names</span><span class="p">,</span><span class="n">shock_values</span><span class="p">,</span><span class="n">parameters_names</span><span class="p">,</span><span class="n">parameters_values</span><span class="p">,</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create files with data fot initial endogenous variables value, parameters and shock values.</span>
<span class="sd">    </span>
<span class="sd">    These files are created when model option GENERATE_CPP_CODE is set to True.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        T : int.</span>
<span class="sd">            Number of time steps.</span>
<span class="sd">        variables_names : list.</span>
<span class="sd">            Names of endogenous variables.</span>
<span class="sd">        variables_names : list.</span>
<span class="sd">            Names of endogenous variables.</span>
<span class="sd">        initial_values : numpy array.</span>
<span class="sd">            Initial values of endogenous variables.</span>
<span class="sd">        shock_names : list.</span>
<span class="sd">            Names of shock variables.</span>
<span class="sd">        shock_values : list.</span>
<span class="sd">            Shocks values.</span>
<span class="sd">        parameters_names : list.</span>
<span class="sd">            Names of model parameters.</span>
<span class="sd">        parameters_values : numpy array.</span>
<span class="sd">            Parameters values.</span>
<span class="sd">        shocks : dictionary.</span>
<span class="sd">            Model options.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s2">&quot;shock_values&quot;</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">shock_values</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shock_values&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shock_values</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shock_values</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shock_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
               <span class="n">shock_values</span> <span class="o">=</span> <span class="n">shock_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="n">shock_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shock_values</span><span class="p">)</span>
    <span class="n">periods</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="s2">&quot;periods&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;periods&quot;</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">else</span> <span class="kc">None</span>
    
    <span class="c1"># Write variables initial values</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;data/cpp/initial_values.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Writing data to a file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Period,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_values</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">initial_values</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">initial_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initial_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initial_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
                          
        
    <span class="c1"># Write parameters values</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;data/cpp/parameters.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Writing data to a file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Period,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters_names</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters_values</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">parameters_values</span><span class="p">])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">parameters_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters_values</span><span class="p">[:,</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> 
            
    <span class="c1"># Write shocks values</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;data/cpp/shocks.csv&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Writing data to a file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Period,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shock_names</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">n_shocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shock_names</span><span class="p">)</span>
            
        <span class="c1"># If periods is not present in model options it means that shock is permanent.</span>
        <span class="c1"># Then add zeros to shocks to indicate transient nature of shocks.</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Period t=0 defines starting values.  So insert zero shocks...</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;0&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shocks</span><span class="p">)])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">periods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">shock_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shock_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">shock_values</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shock_values</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;0&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shocks</span><span class="p">)])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">shock_values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shock_values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">shock_values</span><span class="p">):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">shock_values</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>        
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;0&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_shocks</span><span class="p">)])</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

                
            
<div class="viewcode-block" id="compareTrollFiles">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.compareTrollFiles">[docs]</a>
<span class="k">def</span> <span class="nf">compareTrollFiles</span><span class="p">(</span><span class="n">fpath1</span><span class="p">,</span><span class="n">fpath2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compare steady state values in two excel files.&quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    
    <span class="c1"># Read data</span>
    <span class="n">file_path1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;snowdrop/data/Troll/FSGM3&quot;</span><span class="p">,</span> <span class="n">fpath1</span><span class="p">))</span>
    <span class="n">file_path2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;snowdrop/data/Troll/FSGM3&quot;</span><span class="p">,</span> <span class="n">fpath2</span><span class="p">))</span>
    <span class="n">fout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;data/Troll/FSGM3/comparison.csv&quot;</span><span class="p">))</span>
    
    
    <span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path1</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path2</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keys1</span><span class="p">,</span><span class="n">vals1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">keys2</span><span class="p">,</span><span class="n">vals2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">df2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">keys1</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys1</span><span class="p">]</span>
    <span class="n">keys2</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keys2</span><span class="p">]</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys1</span><span class="p">,</span><span class="n">vals1</span><span class="p">))</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys2</span><span class="p">,</span><span class="n">vals2</span><span class="p">))</span>
    <span class="n">keys</span>  <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">m2</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">arr</span>   <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">m1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">/</span><span class="n">m2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">m1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">m2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">m1</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">m2</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">diff</span><span class="p">]</span>
        <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Var&quot;</span><span class="p">,</span><span class="s2">&quot;Troll&quot;</span><span class="p">,</span><span class="s2">&quot;Framework&quot;</span><span class="p">,</span><span class="s2">&quot;Relative Difference&quot;</span><span class="p">])</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fout</span><span class="p">)</span></div>

    
    
<div class="viewcode-block" id="read_and_combine_text">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.read_and_combine_text">[docs]</a>
<span class="k">def</span> <span class="nf">read_and_combine_text</span><span class="p">(</span><span class="n">fpath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span><span class="n">_if_</span><span class="o">=</span><span class="s2">&quot;!if&quot;</span><span class="p">,</span><span class="n">_else_</span><span class="o">=</span><span class="s2">&quot;!else&quot;</span><span class="p">,</span><span class="n">_end_</span><span class="o">=</span><span class="s2">&quot;!end&quot;</span><span class="p">,</span><span class="n">_import_</span><span class="o">=</span><span class="s2">&quot;!import&quot;</span><span class="p">,</span>
                          <span class="n">transition_variables</span><span class="o">=</span><span class="s2">&quot;!transition_variables&quot;</span><span class="p">,</span>
                          <span class="n">transition_shocks</span><span class="o">=</span><span class="s2">&quot;!transition_shocks&quot;</span><span class="p">,</span>
                          <span class="n">measurement_variables</span><span class="o">=</span><span class="s2">&quot;!measurement_variables&quot;</span><span class="p">,</span>
                          <span class="n">measurement_shocks</span><span class="o">=</span><span class="s2">&quot;!measurement_shocks&quot;</span><span class="p">,</span>
                          <span class="n">parameters</span><span class="o">=</span><span class="s2">&quot;!parameters&quot;</span><span class="p">,</span>
                          <span class="n">transition_equations</span><span class="o">=</span><span class="s2">&quot;!transition_equations&quot;</span><span class="p">,</span>
                          <span class="n">measurement_equations</span><span class="o">=</span><span class="s2">&quot;!measurement_equations&quot;</span><span class="p">,</span>
                          <span class="n">stop</span><span class="o">=</span><span class="s2">&quot;!stop&quot;</span><span class="p">,</span><span class="n">Legend</span><span class="o">=</span><span class="s2">&quot;Legend&quot;</span><span class="p">,</span>
                          <span class="n">conditions</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine separate parts of file text.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.misc.termcolor</span> <span class="kn">import</span> <span class="n">cprint</span>
    
    <span class="n">fdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> 
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">original_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fname</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">line</span> <span class="o">:=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">():</span>
            <span class="n">original_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        
    <span class="n">m</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Legend&quot;</span><span class="p">:</span> <span class="n">Legend</span><span class="p">,</span> <span class="s2">&quot;!stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">}</span>
    <span class="n">special</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">keyWords</span> <span class="o">=</span> <span class="p">[</span><span class="n">transition_variables</span><span class="p">,</span><span class="n">transition_shocks</span><span class="p">,</span>
                <span class="n">measurement_variables</span><span class="p">,</span><span class="n">measurement_shocks</span><span class="p">,</span>
                <span class="n">parameters</span><span class="p">,</span><span class="n">transition_equations</span><span class="p">,</span>
                <span class="n">measurement_equations</span><span class="p">,</span><span class="n">Legend</span><span class="p">]</span>
   
    <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">content</span><span class="o">=</span><span class="p">[];</span> <span class="n">start</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keyWords</span><span class="p">:</span>
        <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
    <span class="c1"># Preparse !if, !else, !end directives</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">original_lines</span><span class="p">:</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;% &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">_if_</span><span class="p">):</span>
            <span class="n">block1</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">block2</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">expr</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">,</span><span class="s2">&quot; not &quot;</span><span class="p">)</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">conditions</span><span class="p">[</span><span class="n">condition</span><span class="p">]))</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">include</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expr</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">,</span><span class="s2">&quot;not &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span><span class="s2">&quot;True&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;false&quot;</span><span class="p">,</span><span class="s2">&quot;False&quot;</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">include</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">_else_</span><span class="p">):</span>
            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">include</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">include</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="ow">and</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">_end_</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">block1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
                        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Included block #1 for condition: </span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">conditions</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Included block #1 for condition: </span><span class="si">{</span><span class="n">expr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">block2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">condition</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
                        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Included block #2 for condition: </span><span class="si">{</span><span class="n">condition</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">conditions</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Included block #2 for condition: </span><span class="si">{</span><span class="n">expr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">include</span><span class="p">:</span>
                    <span class="n">block1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">elif</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">states</span><span class="p">:</span>
                    <span class="n">block2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                
    <span class="c1"># Import files</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">_import_</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;(&quot;</span> <span class="ow">in</span> <span class="n">ln</span> <span class="ow">and</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">:</span>
                <span class="n">ind1</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span>
                <span class="n">ind2</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
                <span class="n">fl</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">ind1</span><span class="p">:</span><span class="n">ind2</span><span class="p">]</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span><span class="n">fl</span><span class="p">))</span>
            <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;.text&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
        
    
    <span class="c1"># Combine text for each key word block        </span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;;&quot;</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">ln</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">keyWords</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">line</span>
            
    <span class="c1"># Combine all pieces together</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keyWords</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">special</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">txt</span></div>

            

<div class="viewcode-block" id="getOutputFolderPath">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.getOutputFolderPath">[docs]</a>
<span class="k">def</span> <span class="nf">getOutputFolderPath</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;PLATFORM_OUTPUT_FOLDER&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s1">&#39;../supplements&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>      
    <span class="k">return</span> <span class="n">output_dir</span></div>

          
    
<div class="viewcode-block" id="compareResults">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.compareResults">[docs]</a>
<span class="k">def</span> <span class="nf">compareResults</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span><span class="n">variables</span><span class="p">,</span><span class="n">dates</span><span class="p">,</span><span class="n">filter_range</span><span class="p">,</span><span class="n">fdir</span><span class="p">):</span>
    
     <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
     <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    
     <span class="c1"># start.end = dates[0],dates[-1]</span>
     <span class="n">filter_start</span><span class="p">,</span><span class="n">filter_end</span> <span class="o">=</span> <span class="n">filter_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">filter_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
     <span class="n">start</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">filter_start</span><span class="p">)</span>
     <span class="n">end</span> <span class="o">=</span> <span class="n">getDate</span><span class="p">(</span><span class="n">filter_end</span><span class="p">)</span>
     
     <span class="n">lbls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span><span class="s2">&quot;Iris&quot;</span><span class="p">,</span><span class="s2">&quot;Difference&quot;</span><span class="p">]</span>
     <span class="n">Outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Filter&quot;</span><span class="p">,</span><span class="s2">&quot;Smooth&quot;</span><span class="p">]</span>
     <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Outputs</span><span class="p">):</span>
         <span class="n">filtr</span> <span class="o">=</span> <span class="p">{}</span>
         <span class="n">results</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
         <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
             <span class="k">if</span> <span class="s2">&quot;_plus_&quot;</span> <span class="ow">in</span> <span class="n">n</span> <span class="ow">or</span> <span class="s2">&quot;_minus_&quot;</span> <span class="ow">in</span> <span class="n">n</span><span class="p">:</span>
                 <span class="k">continue</span>
             <span class="n">data</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>
             <span class="n">m</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">))</span>
             <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="n">m</span><span class="p">],</span> <span class="n">dates</span><span class="p">[:</span><span class="n">m</span><span class="p">])</span>
             <span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
             <span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;#Q&#39;</span><span class="p">)</span>
             <span class="n">filtr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span>
            
         <span class="c1"># Read Iris results</span>
         <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span> <span class="s1">&#39;../Iris/Ireland/data/kf_&#39;</span><span class="o">+</span><span class="n">output</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">))</span>
         <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
         
         <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
         <span class="n">rows</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
         <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables</span><span class="p">):</span>
             <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span><span class="n">columns</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
             <span class="n">filtr</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
             <span class="n">df</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
             <span class="n">diff</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">-</span><span class="n">filtr</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
             <span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
             <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
             <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lbls</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">lbls</span><span class="p">))</span>
             <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
             
         <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
         <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span><span class="s1">&#39;../graphs/kf_comp_&#39;</span><span class="o">+</span><span class="n">output</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">)),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span></div>

      
<div class="viewcode-block" id="output">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.output">[docs]</a>
<span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span><span class="n">names</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>  
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> 
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;C:/Temp/</span><span class="si">{</span><span class="n">fdir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="Encoder">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.Encoder">[docs]</a>
<span class="k">class</span> <span class="nc">Encoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<div class="viewcode-block" id="Encoder.default">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.Encoder.default">[docs]</a>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
            
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>
</div>

    
<div class="viewcode-block" id="saveData">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.saveData">[docs]</a>
<span class="k">def</span> <span class="nf">saveData</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fdir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">fdir</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span> 
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">json_data</span> <span class="o">=</span><span class="s1">&#39;[&quot;&#39;</span><span class="o">+</span> <span class="s1">&#39;&quot;,&quot;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&quot;]&#39;</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="bp">cls</span><span class="o">=</span><span class="n">Encoder</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">f</span><span class="p">)</span></div>

           
    
<div class="viewcode-block" id="loadData">
<a class="viewcode-back" href="../../../../source/snowdrop.src.utils.html#snowdrop.src.utils.util.loadData">[docs]</a>
<span class="k">def</span> <span class="nf">loadData</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.utils.equations</span> <span class="kn">import</span> <span class="n">build_func</span>
    
    <span class="n">arr</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">lfunc</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fdir</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;lfunc&#39;</span><span class="p">:</span>
                <span class="n">lfunc</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">build_func</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lfunc</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;hist_rng&quot;</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;_data&quot;</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span> 
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">ts</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;ms&#39;</span><span class="p">)</span>
                    <span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>    
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span></div>

    
    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>   
     
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;snowdrop/models/QPM/model_Lshocks.model&#39;</span><span class="p">))</span>
        
    <span class="n">txt</span> <span class="o">=</span> <span class="n">read_and_combine_text</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span><span class="n">conditions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fiscalswitch&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span><span class="s2">&quot;wedgeswitch&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
    
    <span class="c1"># model_file = os.path.abspath(os.path.join(working_dir,&#39;snowdrop/models/Sirius/chile_model.xml&#39;))</span>
    
    <span class="c1"># # Shocks</span>
    <span class="c1"># shocks = {&#39;2025/1/1&#39;: {&#39;e_dot_cpi&#39;:1, &#39;e_lgdp_gap&#39;:-1}}     </span>
    
    <span class="c1"># # Instantaiate a model</span>
    <span class="c1"># model = importModel(file_path=model_file,startDate=&#39;2000/1/1&#39;,endDate=&#39;2010/1/1&#39;,shocks=shocks) </span>
    <span class="c1"># print(model)</span>
    
    <span class="c1"># from snowdrop.src.driver import run</span>
    
    <span class="c1"># output_variables = [&#39;dot4_cpi&#39;,&#39;dot4_cpi_x&#39;,&#39;dot4_gdp&#39;,&#39;lgdp_gap&#39;,&#39;lx_gdp_gap&#39;,&#39;mci&#39;,&#39;rmc&#39;,&#39;rr&#39;,&#39;rr_gap&#39;]</span>
    <span class="c1"># run(model=model,output_variables=output_variables,Plot=True)</span>
        
    <span class="c1"># eq = &quot;a = p*STEADY_STATE(b) + (1-b)*STEADY_STATE(b)**2&quot;</span>
    <span class="c1"># eq = replaceExpressions([eq])</span>
    <span class="c1"># print(eq)</span>
  
    <span class="c1"># endog = [&#39;E_WRL_PRODOIL_R&#39;,&#39;ISR_ACT_R&#39;,&#39;ISR_BREVAL_N&#39;,&#39;ISR_B_N&#39;,&#39;ISR_B_RAT&#39;,&#39;ISR_CFOOD_R&#39;,&#39;ISR_CNCOM_R&#39;,&#39;ISR_COIL_R&#39;,&#39;ISR_COM_FE_R&#39;,&#39;ISR_COM_RK_P&#39;,&#39;ISR_CPINCOM_P&#39;,&#39;ISR_CPIX_P&#39;,&#39;ISR_CPI_P&#39;,&#39;ISR_CURBAL_N&#39;,&#39;ISR_C_LIQ_R&#39;,&#39;ISR_C_OLG_R&#39;,&#39;ISR_C_R&#39;,&#39;ISR_C_RAT&#39;,&#39;ISR_DELTA&#39;,&#39;ISR_EPS&#39;,&#39;ISR_FACTFOOD_R&#39;,&#39;ISR_FACT_R&#39;,&#39;ISR_FXPREM&#39;,&#39;ISR_GC_N&#39;,&#39;ISR_GC_R&#39;,&#39;ISR_GC_RAT&#39;,&#39;ISR_GDEF_N&#39;,&#39;ISR_GDEF_RAT&#39;,&#39;ISR_GDEF_TAR&#39;,&#39;ISR_GDPINC_N&#39;,&#39;ISR_GDPSIZE&#39;,&#39;ISR_GDP_FE_R&#39;,&#39;ISR_GDP_N&#39;,&#39;ISR_GDP_R&#39;,&#39;ISR_GE_N&#39;,&#39;ISR_GISTOCK_R&#39;,&#39;ISR_GI_N&#39;,&#39;ISR_GI_R&#39;,&#39;ISR_GI_RAT&#39;,&#39;ISR_GNP_R&#39;,&#39;ISR_GOVCHECK&#39;,&#39;ISR_GSUB_N&#39;,&#39;ISR_GTARIFF_N&#39;,&#39;ISR_G_R&#39;,&#39;ISR_IFOODA_R&#39;,&#39;ISR_IFOOD_R&#39;,&#39;ISR_IMETALA_R&#39;,&#39;ISR_IMETAL_R&#39;,&#39;ISR_IM_R&#39;,&#39;ISR_INFCPI&#39;,&#39;ISR_INFCPIX&#39;,&#39;ISR_INFEXP&#39;,&#39;ISR_INFL&#39;,&#39;ISR_INFPIM&#39;,&#39;ISR_INFWAGE&#39;,&#39;ISR_INFWAGEEFF&#39;,&#39;ISR_INFWEXP&#39;,&#39;ISR_INT&#39;,&#39;ISR_INT10&#39;,&#39;ISR_INTC&#39;,&#39;ISR_INTCORP&#39;,&#39;ISR_INTCOST_N&#39;,&#39;ISR_INTCOST_RAT&#39;,&#39;ISR_INTGB&#39;,&#39;ISR_INTMP&#39;,&#39;ISR_INTMPU&#39;,&#39;ISR_INTNFA&#39;,&#39;ISR_INTRF&#39;,&#39;ISR_INTRF10&#39;,&#39;ISR_INTXM10&#39;,&#39;ISR_INVESTP_R&#39;,&#39;ISR_INVEST_R&#39;,&#39;ISR_INVEST_RAT&#39;,&#39;ISR_IOILA_R&#39;,&#39;ISR_IOIL_R&#39;,&#39;ISR_IT_R&#39;,&#39;ISR_IT_RAT&#39;,&#39;ISR_J&#39;,&#39;ISR_KG_R&#39;,&#39;ISR_K_R&#39;,&#39;ISR_LABH_FE_R&#39;,&#39;ISR_LABH_R&#39;,&#39;ISR_LAB_FE_R&#39;,&#39;ISR_LAB_R&#39;,&#39;ISR_LF_FE_R&#39;,&#39;ISR_LF_R&#39;,&#39;ISR_LSTAX_RAT&#39;,&#39;ISR_MET_RK_P&#39;,&#39;ISR_MKTPREM&#39;,&#39;ISR_MKTPREMSM&#39;,&#39;ISR_MPC&#39;,&#39;ISR_MPCINV&#39;,&#39;ISR_NFAREVAL_N&#39;,&#39;ISR_NFA_D&#39;,&#39;ISR_NFA_RAT&#39;,&#39;ISR_NPOPB_R&#39;,&#39;ISR_NPOPH_R&#39;,&#39;ISR_NPOP_R&#39;,&#39;ISR_NTRFPSPILL_FE_R&#39;,&#39;ISR_OILRECEIPT_N&#39;,&#39;ISR_OILSUB_N&#39;,&#39;ISR_PART&#39;,&#39;ISR_PARTH&#39;,&#39;ISR_PARTH_DES&#39;,&#39;ISR_PARTH_FE&#39;,&#39;ISR_PARTH_W&#39;,&#39;ISR_PART_DES&#39;,&#39;ISR_PART_FE&#39;,&#39;ISR_PCFOOD_P&#39;,&#39;ISR_PCOIL_P&#39;,&#39;ISR_PCW_P&#39;,&#39;ISR_PC_P&#39;,&#39;ISR_PFM_P&#39;,&#39;ISR_PFOOD_P&#39;,&#39;ISR_PGDP_P&#39;,&#39;ISR_PGDP_P_AVG&#39;,&#39;ISR_PG_P&#39;,&#39;ISR_PIMADJ_P&#39;,&#39;ISR_PIMA_P&#39;,&#39;ISR_PIM_P&#39;,&#39;ISR_PIT_P&#39;,&#39;ISR_PI_P&#39;,&#39;ISR_PMETAL_P&#39;,&#39;ISR_POIL_P&#39;,&#39;ISR_POIL_P_SUB&#39;,&#39;ISR_PRIMSUR_N&#39;,&#39;ISR_PRIMSUR_TAR&#39;,&#39;ISR_PRODFOOD_R&#39;,&#39;ISR_PSAVING_N&#39;,&#39;ISR_PXMF_P&#39;,&#39;ISR_PXMUNADJ_P&#39;,&#39;ISR_PXM_P&#39;,&#39;ISR_PXT_P&#39;,&#39;ISR_Q_P&#39;,&#39;ISR_R&#39;,&#39;ISR_R10&#39;,&#39;ISR_RC&#39;,&#39;ISR_RC0_SM&#39;,&#39;ISR_RC0_WM&#39;,&#39;ISR_RCI&#39;,&#39;ISR_RCORP&#39;,&#39;ISR_REER&#39;,&#39;ISR_RK_P&#39;,&#39;ISR_RPREM&#39;,&#39;ISR_R_NEUT&#39;,&#39;ISR_SOVPREM&#39;,&#39;ISR_SOVPREMSM&#39;,&#39;ISR_SUB_OIL&#39;,&#39;ISR_TAU_C&#39;,&#39;ISR_TAU_K&#39;,&#39;ISR_TAU_L&#39;,&#39;ISR_TAU_OIL&#39;,&#39;ISR_TAXC_N&#39;,&#39;ISR_TAXC_RAT&#39;,&#39;ISR_TAXK_N&#39;,&#39;ISR_TAXK_RAT&#39;,&#39;ISR_TAXLH_N&#39;,&#39;ISR_TAXL_N&#39;,&#39;ISR_TAXL_RAT&#39;,&#39;ISR_TAXOIL_N&#39;,&#39;ISR_TAX_N&#39;,&#39;ISR_TAX_RAT&#39;,&#39;ISR_TB_N&#39;,&#39;ISR_TFPEFFECT_R&#39;,&#39;ISR_TFPKGSPILL_FE_R&#39;,&#39;ISR_TFPSPILL_FE_R&#39;,&#39;ISR_TFP_FE_R&#39;,&#39;ISR_TFP_FE_R_AVG&#39;,&#39;ISR_TFP_R&#39;,&#39;ISR_TM&#39;,&#39;ISR_TPREM&#39;,&#39;ISR_TRANSFER_LIQ_N&#39;,&#39;ISR_TRANSFER_N&#39;,&#39;ISR_TRANSFER_OLG_N&#39;,&#39;ISR_TRANSFER_RAT&#39;,&#39;ISR_TRANSFER_TARG_N&#39;,&#39;ISR_TRANSFER_TARG_RAT&#39;,&#39;ISR_TRFPSPILL_FE_R&#39;,&#39;ISR_UFOOD_R&#39;,&#39;ISR_UNR&#39;,&#39;ISR_UNRH&#39;,&#39;ISR_UNRH_FE&#39;,&#39;ISR_UNR_FE&#39;,&#39;ISR_USA_SM&#39;,&#39;ISR_USA_WM&#39;,&#39;ISR_WAGEEFF_N&#39;,&#39;ISR_WAGEH_N&#39;,&#39;ISR_WAGE_N&#39;,&#39;ISR_WF_R&#39;,&#39;ISR_WH_R&#39;,&#39;ISR_WK_N&#39;,&#39;ISR_WO_R&#39;,&#39;ISR_W_R&#39;,&#39;ISR_W_R_AVG&#39;,&#39;ISR_XFOOD_R&#39;,&#39;ISR_XMA_R&#39;,&#39;ISR_XM_R&#39;,&#39;ISR_XT_R&#39;,&#39;ISR_XT_RAT&#39;,&#39;ISR_YCAP_N&#39;,&#39;ISR_YD_R&#39;,&#39;ISR_YLABH_N&#39;,&#39;ISR_YLAB_N&#39;,&#39;ISR_Z&#39;,&#39;ISR_Z_AVG&#39;,&#39;ISR_Z_NFA&#39;,&#39;PFOOD_P&#39;,&#39;PMETAL_P&#39;,&#39;POIL_P&#39;,&#39;RC0_ACT_R&#39;,&#39;RC0_BREVAL_N&#39;,&#39;RC0_B_N&#39;,&#39;RC0_B_RAT&#39;,&#39;RC0_CFOOD_R&#39;,&#39;RC0_CNCOM_R&#39;,&#39;RC0_COIL_R&#39;,&#39;RC0_COM_FE_R&#39;,&#39;RC0_COM_RK_P&#39;,&#39;RC0_CPINCOM_P&#39;,&#39;RC0_CPIX_P&#39;,&#39;RC0_CPI_P&#39;,&#39;RC0_CURBAL_N&#39;,&#39;RC0_C_LIQ_R&#39;,&#39;RC0_C_OLG_R&#39;,&#39;RC0_C_R&#39;,&#39;RC0_C_RAT&#39;,&#39;RC0_DELTA&#39;,&#39;RC0_EPS&#39;,&#39;RC0_FACTFOOD_R&#39;,&#39;RC0_FACTMETAL_R&#39;,&#39;RC0_FACTOIL_R&#39;,&#39;RC0_FACT_R&#39;,&#39;RC0_FXPREM&#39;,&#39;RC0_GC_N&#39;,&#39;RC0_GC_R&#39;,&#39;RC0_GC_RAT&#39;,&#39;RC0_GDEF_N&#39;,&#39;RC0_GDEF_RAT&#39;,&#39;RC0_GDEF_TAR&#39;,&#39;RC0_GDPINC_N&#39;,&#39;RC0_GDPSIZE&#39;,&#39;RC0_GDP_FE_R&#39;,&#39;RC0_GDP_N&#39;,&#39;RC0_GDP_R&#39;,&#39;RC0_GE_N&#39;,&#39;RC0_GISTOCK_R&#39;,&#39;RC0_GI_N&#39;,&#39;RC0_GI_R&#39;,&#39;RC0_GI_RAT&#39;,&#39;RC0_GNP_R&#39;,&#39;RC0_GOVCHECK&#39;,&#39;RC0_GSUB_N&#39;,&#39;RC0_GTARIFF_N&#39;,&#39;RC0_G_R&#39;,&#39;RC0_IFOODA_R&#39;,&#39;RC0_IFOOD_R&#39;,&#39;RC0_IMETALA_R&#39;,&#39;RC0_IMETAL_R&#39;,&#39;RC0_IM_R&#39;,&#39;RC0_INFCPI&#39;,&#39;RC0_INFCPIX&#39;,&#39;RC0_INFEXP&#39;,&#39;RC0_INFL&#39;,&#39;RC0_INFPIM&#39;,&#39;RC0_INFWAGE&#39;,&#39;RC0_INFWAGEEFF&#39;,&#39;RC0_INFWEXP&#39;,&#39;RC0_INT&#39;,&#39;RC0_INT10&#39;,&#39;RC0_INTC&#39;,&#39;RC0_INTCORP&#39;,&#39;RC0_INTCOST_N&#39;,&#39;RC0_INTCOST_RAT&#39;,&#39;RC0_INTGB&#39;,&#39;RC0_INTMP&#39;,&#39;RC0_INTMPU&#39;,&#39;RC0_INTNFA&#39;,&#39;RC0_INTRF&#39;,&#39;RC0_INTRF10&#39;,&#39;RC0_INTXM10&#39;,&#39;RC0_INVESTP_R&#39;,&#39;RC0_INVEST_R&#39;,&#39;RC0_INVEST_RAT&#39;,&#39;RC0_IOILA_R&#39;,&#39;RC0_IOIL_R&#39;,&#39;RC0_ISR_SM&#39;,&#39;RC0_ISR_WM&#39;,&#39;RC0_IT_R&#39;,&#39;RC0_IT_RAT&#39;,&#39;RC0_J&#39;,&#39;RC0_KG_R&#39;,&#39;RC0_K_R&#39;,&#39;RC0_LABH_FE_R&#39;,&#39;RC0_LABH_R&#39;,&#39;RC0_LAB_FE_R&#39;,&#39;RC0_LAB_R&#39;,&#39;RC0_LF_FE_R&#39;,&#39;RC0_LF_R&#39;,&#39;RC0_LSTAX_RAT&#39;,&#39;RC0_MET_RK_P&#39;,&#39;RC0_MKTPREM&#39;,&#39;RC0_MKTPREMSM&#39;,&#39;RC0_MPC&#39;,&#39;RC0_MPCINV&#39;,&#39;RC0_MROYALTIES_N&#39;,&#39;RC0_MROYALTY&#39;,&#39;RC0_NFAREVAL_N&#39;,&#39;RC0_NFA_D&#39;,&#39;RC0_NFA_RAT&#39;,&#39;RC0_NPOPB_R&#39;,&#39;RC0_NPOPH_R&#39;,&#39;RC0_NPOP_R&#39;,&#39;RC0_NTRFPSPILL_FE_R&#39;,&#39;RC0_OILPAY_N&#39;,&#39;RC0_OILRECEIPT_N&#39;,&#39;RC0_OILSHARF&#39;,&#39;RC0_OILSUB_N&#39;,&#39;RC0_PART&#39;,&#39;RC0_PARTH&#39;,&#39;RC0_PARTH_DES&#39;,&#39;RC0_PARTH_FE&#39;,&#39;RC0_PARTH_W&#39;,&#39;RC0_PART_DES&#39;,&#39;RC0_PART_FE&#39;,&#39;RC0_PCFOOD_P&#39;,&#39;RC0_PCOIL_P&#39;,&#39;RC0_PCW_P&#39;,&#39;RC0_PC_P&#39;,&#39;RC0_PFM_P&#39;,&#39;RC0_PFOOD_P&#39;,&#39;RC0_PGDP_P&#39;,&#39;RC0_PGDP_P_AVG&#39;,&#39;RC0_PG_P&#39;,&#39;RC0_PIMADJ_P&#39;,&#39;RC0_PIMA_P&#39;,&#39;RC0_PIM_P&#39;,&#39;RC0_PIT_P&#39;,&#39;RC0_PI_P&#39;,&#39;RC0_PMETAL_P&#39;,&#39;RC0_POIL_P&#39;,&#39;RC0_POIL_P_SUB&#39;,&#39;RC0_PRIMSUR_N&#39;,&#39;RC0_PRIMSUR_TAR&#39;,&#39;RC0_PRODFOOD_R&#39;,&#39;RC0_PRODMETAL_R&#39;,&#39;RC0_PRODOIL_R&#39;,&#39;RC0_PSAVING_N&#39;,&#39;RC0_PXMF_P&#39;,&#39;RC0_PXMUNADJ_P&#39;,&#39;RC0_PXM_P&#39;,&#39;RC0_PXT_P&#39;,&#39;RC0_Q_P&#39;,&#39;RC0_R&#39;,&#39;RC0_R10&#39;,&#39;RC0_RC&#39;,&#39;RC0_RCI&#39;,&#39;RC0_RCORP&#39;,&#39;RC0_REER&#39;,&#39;RC0_RK_P&#39;,&#39;RC0_ROYALTIES_N&#39;,&#39;RC0_ROYALTIES_RAT&#39;,&#39;RC0_ROYALTY&#39;,&#39;RC0_RPREM&#39;,&#39;RC0_R_NEUT&#39;,&#39;RC0_SOVPREM&#39;,&#39;RC0_SOVPREMSM&#39;,&#39;RC0_SUB_OIL&#39;,&#39;RC0_TAU_C&#39;,&#39;RC0_TAU_K&#39;,&#39;RC0_TAU_L&#39;,&#39;RC0_TAU_OIL&#39;,&#39;RC0_TAXC_N&#39;,&#39;RC0_TAXC_RAT&#39;,&#39;RC0_TAXK_N&#39;,&#39;RC0_TAXK_RAT&#39;,&#39;RC0_TAXLH_N&#39;,&#39;RC0_TAXL_N&#39;,&#39;RC0_TAXL_RAT&#39;,&#39;RC0_TAXOIL_N&#39;,&#39;RC0_TAX_N&#39;,&#39;RC0_TAX_RAT&#39;,&#39;RC0_TB_N&#39;,&#39;RC0_TFPEFFECT_R&#39;,&#39;RC0_TFPKGSPILL_FE_R&#39;,&#39;RC0_TFPSPILL_FE_R&#39;,&#39;RC0_TFP_FE_R&#39;,&#39;RC0_TFP_FE_R_AVG&#39;,&#39;RC0_TFP_R&#39;,&#39;RC0_TM&#39;,&#39;RC0_TPREM&#39;,&#39;RC0_TRANSFER_LIQ_N&#39;,&#39;RC0_TRANSFER_N&#39;,&#39;RC0_TRANSFER_OLG_N&#39;,&#39;RC0_TRANSFER_RAT&#39;,&#39;RC0_TRANSFER_TARG_N&#39;,&#39;RC0_TRANSFER_TARG_RAT&#39;,&#39;RC0_TRFPSPILL_FE_R&#39;,&#39;RC0_UFOOD_R&#39;,&#39;RC0_UMETAL_R&#39;,&#39;RC0_UNR&#39;,&#39;RC0_UNRH&#39;,&#39;RC0_UNRH_FE&#39;,&#39;RC0_UNR_FE&#39;,&#39;RC0_UOIL_R&#39;,&#39;RC0_USA_SM&#39;,&#39;RC0_USA_WM&#39;,&#39;RC0_WAGEEFF_N&#39;,&#39;RC0_WAGEH_N&#39;,&#39;RC0_WAGE_N&#39;,&#39;RC0_WF_R&#39;,&#39;RC0_WH_R&#39;,&#39;RC0_WK_N&#39;,&#39;RC0_WO_R&#39;,&#39;RC0_W_R&#39;,&#39;RC0_W_R_AVG&#39;,&#39;RC0_XFOOD_R&#39;,&#39;RC0_XMA_R&#39;,&#39;RC0_XMETAL_R&#39;,&#39;RC0_XM_R&#39;,&#39;RC0_XOIL_R&#39;,&#39;RC0_XT_R&#39;,&#39;RC0_XT_RAT&#39;,&#39;RC0_YCAP_N&#39;,&#39;RC0_YD_R&#39;,&#39;RC0_YLABH_N&#39;,&#39;RC0_YLAB_N&#39;,&#39;RC0_Z&#39;,&#39;RC0_Z_AVG&#39;,&#39;RC0_Z_NFA&#39;,&#39;RPFOOD&#39;,&#39;RPMETAL&#39;,&#39;RPMETAL_ADJ&#39;,&#39;RPMETAL_AVG&#39;,&#39;RPOIL&#39;,&#39;RPOIL_ADJ&#39;,&#39;RPOIL_AVG&#39;,&#39;USA_ACT_R&#39;,&#39;USA_BREVAL_N&#39;,&#39;USA_B_N&#39;,&#39;USA_B_RAT&#39;,&#39;USA_CFOOD_R&#39;,&#39;USA_CNCOM_R&#39;,&#39;USA_COIL_R&#39;,&#39;USA_COM_FE_R&#39;,&#39;USA_COM_RK_P&#39;,&#39;USA_CPINCOM_P&#39;,&#39;USA_CPIX_P&#39;,&#39;USA_CPI_P&#39;,&#39;USA_CURBAL_N&#39;,&#39;USA_C_LIQ_R&#39;,&#39;USA_C_OLG_R&#39;,&#39;USA_C_R&#39;,&#39;USA_C_RAT&#39;,&#39;USA_DELTA&#39;,&#39;USA_EPS&#39;,&#39;USA_FACTFOOD_R&#39;,&#39;USA_FACTMETAL_R&#39;,&#39;USA_FACTOIL_R&#39;,&#39;USA_FACT_R&#39;,&#39;USA_FXPREM&#39;,&#39;USA_GC_N&#39;,&#39;USA_GC_R&#39;,&#39;USA_GC_RAT&#39;,&#39;USA_GDEF_N&#39;,&#39;USA_GDEF_RAT&#39;,&#39;USA_GDEF_TAR&#39;,&#39;USA_GDPINC_N&#39;,&#39;USA_GDPSIZE&#39;,&#39;USA_GDP_FE_R&#39;,&#39;USA_GDP_N&#39;,&#39;USA_GDP_R&#39;,&#39;USA_GE_N&#39;,&#39;USA_GISTOCK_R&#39;,&#39;USA_GI_N&#39;,&#39;USA_GI_R&#39;,&#39;USA_GI_RAT&#39;,&#39;USA_GNP_R&#39;,&#39;USA_GOVCHECK&#39;,&#39;USA_GSUB_N&#39;,&#39;USA_GTARIFF_N&#39;,&#39;USA_G_R&#39;,&#39;USA_IFOODA_R&#39;,&#39;USA_IFOOD_R&#39;,&#39;USA_IMETALA_R&#39;,&#39;USA_IMETAL_R&#39;,&#39;USA_IM_R&#39;,&#39;USA_INFCPI&#39;,&#39;USA_INFCPIX&#39;,&#39;USA_INFEXP&#39;,&#39;USA_INFL&#39;,&#39;USA_INFPIM&#39;,&#39;USA_INFWAGE&#39;,&#39;USA_INFWAGEEFF&#39;,&#39;USA_INFWEXP&#39;,&#39;USA_INT&#39;,&#39;USA_INT10&#39;,&#39;USA_INTC&#39;,&#39;USA_INTCORP&#39;,&#39;USA_INTCOST_N&#39;,&#39;USA_INTCOST_RAT&#39;,&#39;USA_INTGB&#39;,&#39;USA_INTMP&#39;,&#39;USA_INTMPU&#39;,&#39;USA_INTNFA&#39;,&#39;USA_INTRF&#39;,&#39;USA_INTRF10&#39;,&#39;USA_INTXM10&#39;,&#39;USA_INVESTP_R&#39;,&#39;USA_INVEST_R&#39;,&#39;USA_INVEST_RAT&#39;,&#39;USA_IOILA_R&#39;,&#39;USA_IOIL_R&#39;,&#39;USA_ISR_SM&#39;,&#39;USA_ISR_WM&#39;,&#39;USA_IT_R&#39;,&#39;USA_IT_RAT&#39;,&#39;USA_J&#39;,&#39;USA_KG_R&#39;,&#39;USA_K_R&#39;,&#39;USA_LABH_FE_R&#39;,&#39;USA_LABH_R&#39;,&#39;USA_LAB_FE_R&#39;,&#39;USA_LAB_R&#39;,&#39;USA_LF_FE_R&#39;,&#39;USA_LF_R&#39;,&#39;USA_LSTAX_RAT&#39;,&#39;USA_MET_RK_P&#39;,&#39;USA_MKTPREM&#39;,&#39;USA_MKTPREMSM&#39;,&#39;USA_MPC&#39;,&#39;USA_MPCINV&#39;,&#39;USA_MROYALTIES_N&#39;,&#39;USA_MROYALTY&#39;,&#39;USA_NFAREVAL_N&#39;,&#39;USA_NFA_D&#39;,&#39;USA_NFA_RAT&#39;,&#39;USA_NPOPB_R&#39;,&#39;USA_NPOPH_R&#39;,&#39;USA_NPOP_R&#39;,&#39;USA_NTRFPSPILL_FE_R&#39;,&#39;USA_OILPAY_N&#39;,&#39;USA_OILRECEIPT_N&#39;,&#39;USA_OILSHARF&#39;,&#39;USA_OILSUB_N&#39;,&#39;USA_PART&#39;,&#39;USA_PARTH&#39;,&#39;USA_PARTH_DES&#39;,&#39;USA_PARTH_FE&#39;,&#39;USA_PARTH_W&#39;,&#39;USA_PART_DES&#39;,&#39;USA_PART_FE&#39;,&#39;USA_PCFOOD_P&#39;,&#39;USA_PCOIL_P&#39;,&#39;USA_PCW_P&#39;,&#39;USA_PC_P&#39;,&#39;USA_PFM_P&#39;,&#39;USA_PFOOD_P&#39;,&#39;USA_PGDP_P&#39;,&#39;USA_PGDP_P_AVG&#39;,&#39;USA_PG_P&#39;,&#39;USA_PIMADJ_P&#39;,&#39;USA_PIMA_P&#39;,&#39;USA_PIM_P&#39;,&#39;USA_PIT_P&#39;,&#39;USA_PI_P&#39;,&#39;USA_PMETAL_P&#39;,&#39;USA_POIL_P&#39;,&#39;USA_POIL_P_SUB&#39;,&#39;USA_PRIMSUR_N&#39;,&#39;USA_PRIMSUR_TAR&#39;,&#39;USA_PRODFOOD_R&#39;,&#39;USA_PRODMETAL_R&#39;,&#39;USA_PRODOIL_R&#39;,&#39;USA_PSAVING_N&#39;,&#39;USA_PXMF_P&#39;,&#39;USA_PXMUNADJ_P&#39;,&#39;USA_PXM_P&#39;,&#39;USA_PXT_P&#39;,&#39;USA_Q_P&#39;,&#39;USA_R&#39;,&#39;USA_R10&#39;,&#39;USA_RC&#39;,&#39;USA_RC0_SM&#39;,&#39;USA_RC0_WM&#39;,&#39;USA_RCI&#39;,&#39;USA_RCORP&#39;,&#39;USA_REER&#39;,&#39;USA_RK_P&#39;,&#39;USA_ROYALTIES_N&#39;,&#39;USA_ROYALTIES_RAT&#39;,&#39;USA_ROYALTY&#39;,&#39;USA_RPREM&#39;,&#39;USA_R_NEUT&#39;,&#39;USA_SOVPREM&#39;,&#39;USA_SOVPREMSM&#39;,&#39;USA_SUB_OIL&#39;,&#39;USA_TAU_C&#39;,&#39;USA_TAU_K&#39;,&#39;USA_TAU_L&#39;,&#39;USA_TAU_OIL&#39;,&#39;USA_TAXC_N&#39;,&#39;USA_TAXC_RAT&#39;,&#39;USA_TAXK_N&#39;,&#39;USA_TAXK_RAT&#39;,&#39;USA_TAXLH_N&#39;,&#39;USA_TAXL_N&#39;,&#39;USA_TAXL_RAT&#39;,&#39;USA_TAXOIL_N&#39;,&#39;USA_TAX_N&#39;,&#39;USA_TAX_RAT&#39;,&#39;USA_TB_N&#39;,&#39;USA_TFPEFFECT_R&#39;,&#39;USA_TFPKGSPILL_FE_R&#39;,&#39;USA_TFPSPILL_FE_R&#39;,&#39;USA_TFP_FE_R&#39;,&#39;USA_TFP_FE_R_AVG&#39;,&#39;USA_TFP_R&#39;,&#39;USA_TM&#39;,&#39;USA_TPREM&#39;,&#39;USA_TRANSFER_LIQ_N&#39;,&#39;USA_TRANSFER_N&#39;,&#39;USA_TRANSFER_OLG_N&#39;,&#39;USA_TRANSFER_RAT&#39;,&#39;USA_TRANSFER_TARG_N&#39;,&#39;USA_TRANSFER_TARG_RAT&#39;,&#39;USA_TRFPSPILL_FE_R&#39;,&#39;USA_UFOOD_R&#39;,&#39;USA_UMETAL_R&#39;,&#39;USA_UNR&#39;,&#39;USA_UNRH&#39;,&#39;USA_UNRH_FE&#39;,&#39;USA_UNR_FE&#39;,&#39;USA_UOIL_R&#39;,&#39;USA_WAGEEFF_N&#39;,&#39;USA_WAGEH_N&#39;,&#39;USA_WAGE_N&#39;,&#39;USA_WF_R&#39;,&#39;USA_WH_R&#39;,&#39;USA_WK_N&#39;,&#39;USA_WO_R&#39;,&#39;USA_W_R&#39;,&#39;USA_W_R_AVG&#39;,&#39;USA_XFOOD_R&#39;,&#39;USA_XMA_R&#39;,&#39;USA_XMETAL_R&#39;,&#39;USA_XM_R&#39;,&#39;USA_XOIL_R&#39;,&#39;USA_XT_R&#39;,&#39;USA_XT_RAT&#39;,&#39;USA_YCAP_N&#39;,&#39;USA_YD_R&#39;,&#39;USA_YLABH_N&#39;,&#39;USA_YLAB_N&#39;,&#39;USA_Z&#39;,&#39;USA_Z_AVG&#39;,&#39;USA_Z_NFA&#39;,&#39;WRL_GDP_FE_METAL_R&#39;,&#39;WRL_GDP_FE_OIL_R&#39;,&#39;WRL_GDP_FE_R&#39;,&#39;WRL_GDP_METAL_R&#39;,&#39;WRL_GDP_OIL_R&#39;,&#39;WRL_GDP_R&#39;,&#39;WRL_PRODFOOD_R&#39;,&#39;WRL_PRODMETAL_R&#39;,&#39;WRL_PRODOIL_R&#39;,&#39;WRL_XFOOD_R&#39;,&#39;WRL_XMETAL_R&#39;,&#39;WRL_XOIL_R&#39;,&#39;WTRADE_FOOD_N&#39;,&#39;WTRADE_FOOD_R&#39;,&#39;WTRADE_METAL_N&#39;,&#39;WTRADE_METAL_R&#39;,&#39;WTRADE_M_N&#39;,&#39;WTRADE_M_R&#39;,&#39;WTRADE_OIL_N&#39;,&#39;WTRADE_OIL_R&#39;]  </span>
    <span class="c1"># eq = &quot;1+ISR_INTGB = ((1+ISR_INT-E_ISR_INT)/(1+ISR_MKTPREM)+E_ISR_INT)**(1-ISR_INTGB1)*(((1+ISR_INTXM10(-2))**(1/3))*((1+ISR_INTXM10(-1))**(1/3))*((1+ISR_INTXM10)**(1/3)))**ISR_INTGB1*(1+RES_ISR_INTGB)*(1+E_ISR_INTGB)&quot;</span>
    <span class="c1"># mod_eqs, new_endog, map_new_endog, leads, lags = fixEquations([eq],endog,tagBeg=&quot;(&quot;,tagEnd=&quot;)&quot;)</span>
    
    <span class="c1"># print()</span>
    <span class="c1"># print(eq)</span>
    <span class="c1"># print()</span>
    <span class="c1"># print(mod_eqs[0])</span>
    
    
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">Python Platform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules.html">snowdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../info.html">Python Platform</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Alexei Goumilevski.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>