<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>snowdrop.src.epidemic.ert &#8212; Python Platform 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for snowdrop.src.epidemic.ert</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Monday December 28, 2020</span>
<span class="sd">@author: A.Goumilevski</span>

<span class="sd">This code solves and simulates the model developed by </span>
<span class="sd">Eichenbaum M.S., Rebelo S., Trabandt M. (2020) in</span>
<span class="sd">“Epidemics in the Neoclassical and New Keynesian Models”.</span>
<span class="sd">NBER Working Paper 27430, http://www.nber.org/papers/w27430</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="c1">#from scipy.optimize import root</span>
<span class="c1">#from scipy import signal</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span><span class="p">,</span><span class="n">Bounds</span>
<span class="kn">from</span> <span class="nn">timeit</span> <span class="kn">import</span> <span class="n">default_timer</span> <span class="k">as</span> <span class="n">timer</span> 

<span class="n">fdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="n">working_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">fdir</span> <span class="o">+</span> <span class="s2">&quot;/../../..&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">working_dir</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">snowdrop.src.driver</span> <span class="kn">import</span> <span class="n">run</span> <span class="k">as</span> <span class="n">simulate</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.driver</span> <span class="kn">import</span> <span class="n">importModel</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.graphs.util</span> <span class="kn">import</span> <span class="n">plotTimeSeries</span>
<span class="c1">#from snowdrop.src.model.util import setCalibration</span>
<span class="c1">#from snowdrop.src.numeric.filters.filters import LRXfilter as lrx</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.numeric.solver</span> <span class="kn">import</span> <span class="n">nonlinear_solver</span> <span class="k">as</span> <span class="n">ns</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.numeric.solver.nonlinear_solver</span> <span class="kn">import</span> <span class="n">homotopy_solver</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">simulationRange</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">getPeriods</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.misc.termcolor</span> <span class="kn">import</span> <span class="n">cprint</span>


<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span> 

<span class="n">graphs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;graphs&quot;</span><span class="p">))</span>
<span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s1">&#39;supplements/data/COVID19&#39;</span><span class="p">))</span>

<span class="n">CALIBRATE</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">HOMOTOPY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">LOCKDOWN</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">VACCINATION</span> <span class="o">=</span> <span class="kc">False</span> 

<span class="n">I_ini</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">D_ini</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">pir</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">pid</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">mult2</span><span class="o">=</span><span class="mf">1.e10</span><span class="p">;</span><span class="n">virus_variant_start</span><span class="o">=</span><span class="mi">0</span>
<span class="n">Pi1_shr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">Pi2_shr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">Pi3_shr_target</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">sigma</span><span class="o">=</span><span class="mi">1</span>
<span class="n">RplusD_target</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">C_ss</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">N_ss</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">Model_R</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">vaccination_rate</span><span class="o">=</span><span class="mi">0</span>
<span class="n">I</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">S</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">D</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">R</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">I_OBS</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">D_OBS</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">R_OBS</span><span class="o">=</span><span class="kc">None</span><span class="p">;</span><span class="n">S_OBS</span><span class="o">=</span><span class="kc">None</span>
<span class="n">scale1</span><span class="o">=</span><span class="mf">1.e6</span><span class="p">;</span> <span class="n">scale2</span><span class="o">=</span><span class="mf">1.e3</span> <span class="c1"># scale pi for numerical solver</span>

<span class="n">Tmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">52</span><span class="p">);</span> <span class="n">Nmax</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span> <span class="n">MULT</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Model file</span>
<span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;ert1_model.yaml&#39;</span>

    
<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">Plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Forecast based on ERT model.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.utils.load</span> <span class="kn">import</span> <span class="n">getCalibration</span>
    <span class="k">global</span> <span class="n">Tmax</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">I_OBS</span><span class="p">,</span><span class="n">D_OBS</span><span class="p">,</span><span class="n">R_OBS</span><span class="p">,</span><span class="n">S_OBS</span><span class="p">,</span><span class="n">C_ss</span><span class="p">,</span><span class="n">N_ss</span><span class="p">,</span><span class="n">Pir</span><span class="p">,</span><span class="n">Pid</span><span class="p">,</span><span class="n">I_ini</span><span class="p">,</span><span class="n">D_ini</span>
    <span class="k">global</span> <span class="n">Pi1_shr_target</span><span class="p">,</span><span class="n">Pi2_shr_target</span><span class="p">,</span><span class="n">Pi3_shr_target</span><span class="p">,</span><span class="n">RplusD_target</span>
    <span class="k">global</span> <span class="n">vaccination_rate</span><span class="p">,</span><span class="n">virus_variant_start</span><span class="p">,</span><span class="n">mult</span><span class="p">,</span><span class="n">mult2</span><span class="p">,</span><span class="n">sigma</span>
    
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s1">&#39;supplements/models/COVID19/&#39;</span><span class="o">+</span><span class="n">fname</span><span class="p">))</span>

    <span class="c1"># Create model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">importModel</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="n">model_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">graph_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">Solver</span><span class="o">=</span><span class="s2">&quot;LBJ&quot;</span><span class="p">,</span><span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">anticipate</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">var_names</span>  <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span>
    <span class="c1">#var_values = model.calibration[&quot;variables&quot;]</span>
    <span class="c1">#var = dict(zip(var_names,var_values))</span>
    <span class="n">par_names</span>  <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
    <span class="n">par_values</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
    <span class="n">par</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">par_names</span><span class="p">,</span><span class="n">par_values</span><span class="p">))</span>
    <span class="k">if</span> <span class="s2">&quot;mult&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="s2">&quot;mult&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;mult2&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">mult2</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="s2">&quot;mult2&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;sigma&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;vaccination_rate&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">vaccination_rate</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="s2">&quot;vaccination_rate&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;virus_variant_start&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="p">:</span>
        <span class="n">virus_variant_start</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="s2">&quot;virus_variant_start&quot;</span><span class="p">]</span>
    
    <span class="c1"># Get calibration values</span>
    <span class="n">var_names</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span>
    <span class="c1">#shock_names = model.symbols[&quot;shocks&quot;]</span>
    <span class="c1">#n_shocks = len(shock_names)</span>
    
    <span class="n">SHIFT</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;periods&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Simulations start two quarters before the start of epidemimc</span>
    
    
    <span class="n">calib</span> <span class="o">=</span> <span class="n">getCalibration</span><span class="p">(</span><span class="n">fpath</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)</span>

    <span class="n">I_ini</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;i_ini&quot;</span><span class="p">];</span> <span class="n">D_ini</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;d_ini&quot;</span><span class="p">];</span> <span class="n">share</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s1">&#39;share&#39;</span><span class="p">]</span>
    <span class="n">Pir</span> <span class="o">=</span> <span class="n">pir</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;pir&quot;</span><span class="p">];</span> <span class="n">Pid</span> <span class="o">=</span> <span class="n">pid</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;pid&quot;</span><span class="p">]</span>
    <span class="n">pi1</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;pi1&quot;</span><span class="p">];</span> <span class="n">pi2</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;pi2&quot;</span><span class="p">];</span> <span class="n">pi3</span> <span class="o">=</span> <span class="n">pi3_final</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;pi3&quot;</span><span class="p">]</span>
    <span class="n">C_ss</span> <span class="o">=</span> <span class="n">c_ss</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;c_ss&quot;</span><span class="p">];</span>  <span class="n">N_ss</span> <span class="o">=</span> <span class="n">n_ss</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;n_ss&quot;</span><span class="p">]</span>
    <span class="n">y_ss</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;y_ss&quot;</span><span class="p">];</span>  <span class="n">x_ss</span>  <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;x_ss&quot;</span><span class="p">];</span> <span class="n">k_ss</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;k_ss&quot;</span><span class="p">]</span>
    <span class="c1"># cs_ss = calib[&quot;cs_ss&quot;]; ci_ss = calib[&quot;ci_ss&quot;]</span>
    <span class="c1"># ns_ss = calib[&quot;ns_ss&quot;]; ni_ss  = calib[&quot;ni_ss&quot;]</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;xi&quot;</span><span class="p">];</span> <span class="n">xi_final</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;xi_final&quot;</span><span class="p">]</span>
    <span class="c1">#pie_ss = calib[&quot;pie_ss&quot;]</span>
    <span class="n">Pi1_shr_target</span> <span class="o">=</span> <span class="n">pi1_shr_target</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;pi1_shr_target&quot;</span><span class="p">]</span>
    <span class="n">Pi2_shr_target</span> <span class="o">=</span> <span class="n">pi2_shr_target</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;pi2_shr_target&quot;</span><span class="p">]</span>
    <span class="n">Pi3_shr_target</span> <span class="o">=</span> <span class="n">pi3_shr_target</span> <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;pi3_shr_target&quot;</span><span class="p">]</span>
    <span class="n">RplusD_target</span>  <span class="o">=</span> <span class="n">calib</span><span class="p">[</span><span class="s2">&quot;RplusD_target&quot;</span><span class="p">]</span>
    
    <span class="c1"># Read SIR model parameters data</span>
    <span class="n">data_path</span>  <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;supplements/data/COVID19/epidemic.csv&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">data_path</span><span class="p">):</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Convert to weekly frequency</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;W&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">SHIFT</span><span class="p">)</span>
        <span class="n">i_obs</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OBS_i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">();</span> <span class="n">i_total_obs</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OBS_itotal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">r_obs</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OBS_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">();</span> <span class="n">d_obs</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OBS_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> 
        <span class="n">s_obs</span><span class="o">=</span><span class="mi">100</span><span class="o">-</span><span class="n">i_obs</span><span class="o">-</span><span class="n">d_obs</span><span class="o">-</span><span class="n">r_obs</span>
        <span class="n">I_OBS</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">i_obs</span><span class="o">.</span><span class="n">values</span><span class="p">;</span> <span class="n">D_OBS</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">d_obs</span><span class="o">.</span><span class="n">values</span><span class="p">;</span> <span class="n">R_OBS</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">r_obs</span><span class="o">.</span><span class="n">values</span><span class="p">;</span> <span class="n">S_OBS</span> <span class="o">=</span> <span class="mf">0.01</span><span class="o">*</span><span class="n">s_obs</span><span class="o">.</span><span class="n">values</span>
  
    <span class="c1"># Calibrate pi values</span>
    <span class="k">if</span> <span class="n">CALIBRATE</span><span class="p">:</span>
        <span class="n">Model_R</span><span class="p">,</span><span class="n">pi1_final</span><span class="p">,</span><span class="n">pi2_final</span><span class="p">,</span><span class="n">pi3_final</span> <span class="o">=</span> <span class="n">calibrate</span><span class="p">(</span><span class="n">pi1</span><span class="p">,</span><span class="n">pi2</span><span class="p">,</span><span class="n">pi3</span><span class="p">,</span><span class="n">pi1_shr_target</span><span class="p">,</span><span class="n">pi2_shr_target</span><span class="p">)</span>
        <span class="n">pi1</span> <span class="o">=</span> <span class="n">pi1_final</span><span class="p">;</span> <span class="n">pi2</span> <span class="o">=</span> <span class="n">pi2_final</span><span class="p">;</span> <span class="n">pi3</span> <span class="o">=</span> <span class="n">pi3_final</span><span class="p">;</span>
        <span class="n">SIR_R</span> <span class="o">=</span> <span class="n">pi3</span><span class="o">/</span><span class="p">(</span><span class="n">pir</span><span class="o">+</span><span class="n">pid</span><span class="p">)</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Solution: pi1 = </span><span class="si">{:.2e}</span><span class="s2">, pi2 = </span><span class="si">{:.2e}</span><span class="s2">, pi3 = </span><span class="si">{:.2f}</span><span class="s2">, R+D = </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pi1</span><span class="p">,</span><span class="n">pi2</span><span class="p">,</span><span class="n">pi3</span><span class="p">,</span><span class="n">RplusD_target</span><span class="p">),</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">setCalibration</span><span class="p">(</span><span class="s1">&#39;pi1&#39;</span><span class="p">,</span><span class="n">pi1</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">setCalibration</span><span class="p">(</span><span class="s1">&#39;pi2&#39;</span><span class="p">,</span><span class="n">pi2</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">setCalibration</span><span class="p">(</span><span class="s1">&#39;pi3&#39;</span><span class="p">,</span><span class="n">pi3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">SIR_R</span> <span class="o">=</span> <span class="n">Model_R</span> <span class="o">=</span> <span class="n">pi3</span><span class="o">/</span><span class="p">(</span><span class="n">pir</span><span class="o">+</span><span class="n">pid</span><span class="p">)</span> 
        
    <span class="c1">#cprint(&quot;pir={:.2e}, pid={:.2e}, pi3={:.2f}\n&quot;.format(pir,pid,pi3),&quot;green&quot;)    </span>
    <span class="n">cprint</span><span class="p">(</span><span class="s1">&#39;Share=</span><span class="si">{:.2f}</span><span class="s1">, pi1_shr_target: </span><span class="si">{:.2f}</span><span class="s1">, pi2_shr_target: </span><span class="si">{:.2f}</span><span class="s1">, pi3_shr_target: </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">share</span><span class="p">,</span><span class="n">Pi1_shr_target</span><span class="p">,</span><span class="n">Pi2_shr_target</span><span class="p">,</span><span class="n">Pi3_shr_target</span><span class="p">),</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;SIR and ERT models basic reproduction numbers: </span><span class="si">{:.2f}</span><span class="s2"> and </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SIR_R</span><span class="p">,</span> <span class="n">Model_R</span><span class="p">),</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
    
    
    <span class="c1"># SIR model forecast</span>
    <span class="n">lockdown_rate</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="s2">&quot;theta_lockdown&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">LOCKDOWN</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="c1">#SIR_R = 1.3; pi3=SIR_R*(pir+pid)</span>
    <span class="n">tau</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">dd</span><span class="p">,</span><span class="n">pop</span><span class="p">,</span><span class="n">vaccinated</span> <span class="o">=</span> <span class="n">SIR</span><span class="p">(</span><span class="n">pi3</span><span class="p">,</span><span class="n">pir</span><span class="p">,</span><span class="n">pid</span><span class="p">,</span><span class="n">s0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">i0</span><span class="o">=</span><span class="n">I_ini</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dd0</span><span class="o">=</span><span class="n">D_ini</span><span class="p">,</span><span class="n">pop0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                      <span class="n">lockdown_rate</span><span class="o">=</span><span class="n">lockdown_rate</span><span class="p">,</span><span class="n">vaccination_rate</span><span class="o">=</span><span class="n">vaccination_rate</span><span class="p">)</span>
    
    <span class="n">dates</span>        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Tmax</span><span class="p">)</span><span class="o">/</span><span class="mf">13.0</span>
    <span class="n">i</span>            <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">i</span><span class="p">[:</span><span class="n">Tmax</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
    <span class="n">tau</span>          <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tau</span><span class="p">[:</span><span class="n">Tmax</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
    <span class="c1">#i_tot        = np.cumsum(tau)</span>
    <span class="n">dd</span>           <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dd</span><span class="p">[:</span><span class="n">Tmax</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
    <span class="n">pop</span>          <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">pop</span><span class="p">[:</span><span class="n">Tmax</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
    <span class="n">s</span>            <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">Tmax</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
    <span class="n">r</span>            <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">r</span><span class="p">[:</span><span class="n">Tmax</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
    <span class="n">vaccinated</span>   <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">vaccinated</span><span class="p">[:</span><span class="n">Tmax</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">Plot</span><span class="p">:</span>
        
        <span class="c1"># SIR model forecast</span>
        <span class="k">if</span> <span class="n">VACCINATION</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span><span class="n">dd</span><span class="p">],[</span><span class="n">pop</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">vaccinated</span><span class="p">]]</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Infected&#39;</span><span class="p">,</span><span class="s1">&#39;Deaths&#39;</span><span class="p">],[</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span><span class="s1">&#39;Sucseptible&#39;</span><span class="p">,</span><span class="s1">&#39;Recovered&#39;</span><span class="p">,</span><span class="s1">&#39;Vaccinated&#39;</span><span class="p">]]</span>
        
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span><span class="n">dd</span><span class="p">],[</span><span class="n">pop</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">r</span><span class="p">]]</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Infected&#39;</span><span class="p">,</span><span class="s1">&#39;Deaths&#39;</span><span class="p">],[</span><span class="s1">&#39;Population&#39;</span><span class="p">,</span><span class="s1">&#39;Sucseptible&#39;</span><span class="p">,</span><span class="s1">&#39;Recovered&#39;</span><span class="p">]]</span>
        
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;SIR Model Forecast&#39;</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Basic Reproduction Number, Rb = </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SIR_R</span><span class="p">),</span>
                  <span class="s1">&#39;Rb = </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">SIR_R</span><span class="p">)]</span>
 
        <span class="c1">#plotTimeSeries(path_to_dir=graphs_path,header=header,titles=titles,labels=labels,series=series,sizes=[2,2],stacked=False,save=save)</span>
       
    
        <span class="c1"># Comparison of SIR model forecast with Data</span>
        <span class="n">I</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">T</span> <span class="o">=</span> <span class="n">func</span><span class="p">([</span><span class="n">scale1</span><span class="o">*</span><span class="n">pi1</span><span class="p">,</span><span class="n">scale2</span><span class="o">*</span><span class="n">pi2</span><span class="p">,</span><span class="n">pi3</span><span class="p">])</span>
        
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_obs</span><span class="p">);</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span>
        <span class="n">i</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">I</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
        <span class="n">d</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">D</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
        <span class="n">r</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">R</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
        <span class="n">s</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">S</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span><span class="n">dates</span><span class="p">)</span>
        <span class="n">series</span> <span class="o">=</span> <span class="p">[</span>
                  <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">i_obs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">dates</span><span class="p">),</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">i_total_obs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">dates</span><span class="p">)],</span>
                  <span class="p">[</span><span class="n">d</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">d_obs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">dates</span><span class="p">)]</span>
                 <span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;Calibrated SIR Model Forecast&#39;</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Infected&#39;</span><span class="p">,</span><span class="s1">&#39;Deaths&#39;</span><span class="p">]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span>
                  <span class="p">[</span><span class="s1">&#39;Infected&#39;</span><span class="p">,</span><span class="s1">&#39;Active Cases&#39;</span><span class="p">,</span><span class="s1">&#39;Total Cases&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;Deaths&#39;</span><span class="p">,</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span>
                 <span class="p">]</span>

        <span class="c1">#plotTimeSeries(path_to_dir=graphs_path,header=header,titles=titles,labels=labels,series=series,sizes=[2,2],stacked=False,save=save)</span>
        

    <span class="c1"># Append zeros at the beginning of arrays</span>
    <span class="n">i_obs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shift</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">i_obs</span><span class="o">.</span><span class="n">values</span><span class="p">));</span> <span class="n">d_obs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shift</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">d_obs</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">r_obs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shift</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">r_obs</span><span class="o">.</span><span class="n">values</span><span class="p">));</span> <span class="n">i_total_obs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shift</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">i_total_obs</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">s_obs</span><span class="o">=</span><span class="mi">100</span><span class="o">-</span><span class="n">i_obs</span><span class="o">-</span><span class="n">d_obs</span><span class="o">-</span><span class="n">r_obs</span>
        
    <span class="c1"># Add starting time of virus strain</span>
    <span class="n">VIRUS_STRAIN_START</span> <span class="o">=</span> <span class="n">SHIFT</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="s2">&quot;virus_variant_start&quot;</span><span class="p">])</span>  <span class="c1"># vaccination strain starts one year after epidemics begins</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">VIRUS_STRAIN_START</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">500</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;virus_resistant_strain&quot;</span><span class="p">:</span> <span class="n">arr</span><span class="p">}</span>
    <span class="n">model</span><span class="o">.</span><span class="n">setParameters</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                
    <span class="k">if</span> <span class="n">LOCKDOWN</span><span class="p">:</span>
        <span class="n">n_lockdown</span> <span class="o">=</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">VACCINATION</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_lockdown</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">VACCINATION</span><span class="p">:</span>
        <span class="n">n_vaccination</span> <span class="o">=</span> <span class="mi">5</span> <span class="k">if</span> <span class="n">LOCKDOWN</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_vaccination</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">polycies</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_lockdown</span><span class="p">,</span><span class="n">n_vaccination</span><span class="p">))</span>
    
    
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lockdown</span><span class="p">):</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">ii</span><span class="o">/</span><span class="p">(</span><span class="n">n_lockdown</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span> <span class="k">if</span> <span class="n">n_lockdown</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_vaccination</span><span class="p">):</span>
            <span class="n">fv</span> <span class="o">=</span> <span class="n">jj</span><span class="o">/</span><span class="p">(</span><span class="n">n_vaccination</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span> <span class="k">if</span> <span class="n">n_vaccination</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">yy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">prev_yy</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">LOCKDOWN</span><span class="p">:</span>
                <span class="c1"># Set lockdown duration of eight weeks</span>
                <span class="n">LOCKDOWN_DURATION</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="mi">13</span><span class="o">+</span><span class="mi">2</span>      <span class="c1"># lockdown duration of three quarters</span>
                <span class="n">LOCKDOWN_START</span> <span class="o">=</span> <span class="n">SHIFT</span> <span class="o">+</span> <span class="mi">13</span>   <span class="c1"># lockdown starts at the second quarter of epidemics</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LOCKDOWN_DURATION</span><span class="p">):</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">LOCKDOWN_START</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">fl</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="n">LOCKDOWN_DURATION</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))))</span>   
                <span class="n">p</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lockdown_policy&quot;</span><span class="p">:</span> <span class="n">arr</span><span class="p">}</span>
                <span class="n">model</span><span class="o">.</span><span class="n">setParameters</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">ind1</span> <span class="o">=</span> <span class="n">par_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;lockdown_policy&quot;</span><span class="p">)</span>
                <span class="n">lockdown_policy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">][</span><span class="n">ind1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lockdown_policy</span> <span class="o">=</span> <span class="kc">None</span>
                
            <span class="k">if</span> <span class="n">VACCINATION</span><span class="p">:</span>
                <span class="c1"># Set vaccination duration of eight weeks</span>
                <span class="n">VACCINATION_DURATION</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="mi">13</span>        <span class="c1"># vaccination duration of three quarters</span>
                <span class="n">VACCINATION_START</span> <span class="o">=</span> <span class="n">SHIFT</span> <span class="o">+</span> <span class="mi">13</span> <span class="c1">#5 + 8 + 9 # 5 + 8 + 9# 13  # vaccination starts at the second quarter of epidemics</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">VACCINATION_DURATION</span><span class="p">):</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">VACCINATION_START</span><span class="o">+</span><span class="n">i</span><span class="p">,</span><span class="n">fv</span><span class="p">))</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">VACCINATION_START</span><span class="o">+</span><span class="n">VACCINATION_DURATION</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> 
                <span class="n">p</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vaccination_policy&quot;</span><span class="p">:</span> <span class="n">arr</span><span class="p">}</span>
                <span class="n">model</span><span class="o">.</span><span class="n">setParameters</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">ind2</span> <span class="o">=</span> <span class="n">par_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;vaccination_policy&quot;</span><span class="p">)</span>
                <span class="n">vaccination_policy</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">][</span><span class="n">ind2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vaccination_policy</span> <span class="o">=</span> <span class="kc">None</span>
           
            <span class="n">t0</span> <span class="o">=</span> <span class="n">timer</span><span class="p">()</span>
            <span class="c1">### Framework requires user to solve model by adjusting parameters step-by-step </span>
            <span class="c1">### and solving this model since it can not directly solve it for final parameters.  </span>
            <span class="c1"># Homotopy for pi3 and xi parameters (otherwise no solution if you set them to final values right away)</span>
            <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">rng</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">T</span> <span class="o">=</span> <span class="n">simulationRange</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>   
            <span class="n">periods</span> <span class="o">=</span> <span class="n">getPeriods</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">rng</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">MULT</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">HOMOTOPY</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> 
                    <span class="c1"># Homotopy for pi3 </span>
                    <span class="n">pi3_final_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">pi3_final</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="n">pi3_final</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.005</span><span class="p">,</span><span class="n">pi3_final</span><span class="o">/</span><span class="mi">30</span><span class="p">))</span>
                    <span class="n">yy</span><span class="p">,</span><span class="n">prev_yy</span><span class="p">,</span><span class="n">y0</span> <span class="o">=</span> <span class="n">homotopy_solver</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">],</span><span class="n">par_name</span><span class="o">=</span><span class="s1">&#39;pi3&#39;</span><span class="p">,</span><span class="n">par_steps</span><span class="o">=</span><span class="n">pi3_final_steps</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1.e-4</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># Homotopy for xi </span>
                    <span class="n">xi_final_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">xi</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="n">xi_final</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,(</span><span class="n">xi_final</span><span class="o">-</span><span class="n">xi</span><span class="p">)</span><span class="o">/</span><span class="mi">30</span><span class="p">))</span>
                    <span class="n">yy</span><span class="p">,</span><span class="n">prev_yy</span><span class="p">,</span><span class="n">y0</span> <span class="o">=</span> <span class="n">homotopy_solver</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">par_name</span><span class="o">=</span><span class="s1">&#39;xi&#39;</span><span class="p">,</span><span class="n">par_steps</span><span class="o">=</span><span class="n">xi_final_steps</span><span class="p">,</span><span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1.e-4</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">cprint</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y0</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
                    
            <span class="c1"># Get the final solution</span>
            <span class="n">pi3</span> <span class="o">=</span> <span class="n">pi3_final</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setCalibration</span><span class="p">(</span><span class="s1">&#39;pi3&#39;</span><span class="p">,</span><span class="n">pi3</span><span class="p">)</span>
            <span class="n">cprint</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">pi3 = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pi3</span><span class="p">),</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
            <span class="n">xi</span> <span class="o">=</span> <span class="n">xi_final</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setCalibration</span><span class="p">(</span><span class="s1">&#39;xi&#39;</span><span class="p">,</span><span class="n">xi</span><span class="p">)</span>
            <span class="n">cprint</span><span class="p">(</span><span class="s1">&#39;xi = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
            <span class="n">ns</span><span class="o">.</span><span class="n">TOLERANCE</span> <span class="o">=</span> <span class="mf">1.e-7</span>
            <span class="n">results</span><span class="p">,</span><span class="n">dates</span> <span class="o">=</span> <span class="n">simulate</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span><span class="n">MULT</span><span class="o">=</span><span class="n">MULT</span><span class="p">,</span><span class="n">graph_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">model_info</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
            <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Total CPU time: </span><span class="si">{:.1f}</span><span class="s2"> seconds.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timer</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span><span class="s2">&quot;underline&quot;</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            
            <span class="n">rows</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">start_date</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">SHIFT</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">to_pydatetime</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">-</span><span class="n">SHIFT</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">4.</span><span class="o">/</span><span class="mi">52</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">]</span>
                <span class="n">start_date</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">if</span> <span class="n">LOCKDOWN</span> <span class="ow">and</span> <span class="n">VACCINATION</span><span class="p">:</span>
                <span class="n">highlight</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">((</span><span class="n">LOCKDOWN_START</span><span class="o">-</span><span class="n">SHIFT</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span><span class="p">,(</span><span class="n">VACCINATION_START</span><span class="o">-</span><span class="n">SHIFT</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span><span class="p">),</span>
                           <span class="nb">max</span><span class="p">((</span><span class="n">LOCKDOWN_START</span><span class="o">+</span><span class="n">LOCKDOWN_DURATION</span><span class="o">-</span><span class="n">SHIFT</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span><span class="p">,(</span><span class="n">VACCINATION_START</span><span class="o">+</span><span class="n">VACCINATION_DURATION</span><span class="o">-</span><span class="n">SHIFT</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span><span class="p">)]</span>   
            <span class="k">elif</span> <span class="n">LOCKDOWN</span><span class="p">:</span>
                <span class="n">highlight</span><span class="o">=</span><span class="p">[(</span><span class="n">LOCKDOWN_START</span><span class="o">-</span><span class="n">SHIFT</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span><span class="p">,(</span><span class="n">LOCKDOWN_START</span><span class="o">+</span><span class="n">LOCKDOWN_DURATION</span><span class="o">-</span><span class="n">SHIFT</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">VACCINATION</span><span class="p">:</span>
                <span class="n">highlight</span><span class="o">=</span><span class="p">[(</span><span class="n">VACCINATION_START</span><span class="o">-</span><span class="n">SHIFT</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span><span class="p">,(</span><span class="n">VACCINATION_START</span><span class="o">+</span><span class="n">VACCINATION_DURATION</span><span class="o">-</span><span class="n">SHIFT</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">13.</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">highlight</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">var_names</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">results</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> 
                <span class="n">ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">Tmax</span><span class="p">],</span><span class="n">dates</span><span class="p">[:</span><span class="n">Tmax</span><span class="p">])</span>
                <span class="n">d</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">ts</span> 
            <span class="k">if</span> <span class="s2">&quot;iw&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;iw&quot;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;iv&quot;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ivr&quot;</span><span class="p">]])</span>
                <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            
            
            <span class="c1"># Retrieve shock to infected.   </span>
            <span class="n">Tincome</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># years of income</span>
            <span class="n">utility</span><span class="p">,</span><span class="n">cost_of_lives</span> <span class="o">=</span> <span class="n">integral</span><span class="p">(</span><span class="n">par</span><span class="p">[</span><span class="s2">&quot;betta&quot;</span><span class="p">],</span><span class="n">par</span><span class="p">[</span><span class="s2">&quot;theta&quot;</span><span class="p">],</span>
                                            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;cs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ci&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                            <span class="n">d</span><span class="p">[</span><span class="s2">&quot;ns&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ni&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                            <span class="n">Tincome</span><span class="p">,</span><span class="n">par</span><span class="p">[</span><span class="s2">&quot;inc_target&quot;</span><span class="p">])</span>
            
            <span class="c1">#cost_of_lives = Tincome*par[&quot;inc_target&quot;]</span>
            <span class="n">cost_of_lives</span> <span class="o">*=</span> <span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;dd&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Household lifetime utility </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">utility</span><span class="p">),</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Cost of lives lost </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cost_of_lives</span><span class="p">),</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Total utility </span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">utility</span><span class="o">+</span><span class="n">cost_of_lives</span><span class="p">),</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="n">Z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">utility</span><span class="o">+</span><span class="n">cost_of_lives</span>
            
            <span class="n">polycies</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">fl</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">fv</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">utility</span><span class="o">-</span><span class="n">cost_of_lives</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">utility</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">cost_of_lives</span><span class="p">)])</span>
           
            <span class="k">if</span> <span class="n">LOCKDOWN</span> <span class="ow">or</span> <span class="n">VACCINATION</span><span class="p">:</span>
                <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&lt;----  Completed </span><span class="si">{:.0f}% o</span><span class="s2">f total tasks.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ii</span><span class="o">*</span><span class="n">n_vaccination</span><span class="o">+</span><span class="n">jj</span><span class="p">)</span><span class="o">/</span><span class="n">n_lockdown</span><span class="o">/</span><span class="n">n_vaccination</span><span class="p">),</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
           
            
    
    <span class="k">if</span> <span class="n">LOCKDOWN</span><span class="p">:</span> 
        <span class="n">lockdown_policy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">lockdown_policy</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="n">Tmax</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lockdown_policy</span><span class="p">))],</span><span class="n">dates</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="n">Tmax</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lockdown_policy</span><span class="p">))])</span>
    <span class="k">if</span> <span class="n">VACCINATION</span><span class="p">:</span> 
        <span class="n">vaccination_policy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">vaccination_policy</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="n">Tmax</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vaccination_policy</span><span class="p">))],</span><span class="n">dates</span><span class="p">[:</span><span class="nb">min</span><span class="p">(</span><span class="n">Tmax</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">vaccination_policy</span><span class="p">))])</span>

    <span class="c1">#Normalize macro variables</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;y_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">y_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>          <span class="n">d</span><span class="p">[</span><span class="s2">&quot;yF_n&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;yF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">y_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;c_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">c_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>          <span class="n">d</span><span class="p">[</span><span class="s2">&quot;cF_n&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">c_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;w_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">calib</span><span class="p">[</span><span class="s2">&quot;w_ss&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;wF_n&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;wF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">calib</span><span class="p">[</span><span class="s2">&quot;w_ss&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;n_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">n_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>          <span class="n">d</span><span class="p">[</span><span class="s2">&quot;nF_n&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">n_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;x_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">x_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>          <span class="n">d</span><span class="p">[</span><span class="s2">&quot;xF_n&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;xF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">x_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;rr_n&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;rr&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">52</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>          <span class="n">d</span><span class="p">[</span><span class="s2">&quot;rrF_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;rrF&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">52</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;Rb_n&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;Rb&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">52</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>          <span class="n">d</span><span class="p">[</span><span class="s2">&quot;RbF_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;RbF&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">52</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;k_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">k_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>          <span class="n">d</span><span class="p">[</span><span class="s2">&quot;kF_n&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;kF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">k_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pie&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;pie&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">52</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pieF&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;pieF&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">52</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;cs_n&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cs&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">c_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="n">d</span><span class="p">[</span><span class="s2">&quot;csF_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;csF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">c_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;ci_n&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ci&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">c_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="n">d</span><span class="p">[</span><span class="s2">&quot;ciF_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ciF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">c_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;cr_n&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cr&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">c_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="n">d</span><span class="p">[</span><span class="s2">&quot;crF_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;crF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">c_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;ns_n&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ns&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">n_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="n">d</span><span class="p">[</span><span class="s2">&quot;nsF_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nsF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">n_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;ni_n&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ni&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">n_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="n">d</span><span class="p">[</span><span class="s2">&quot;niF_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;niF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">n_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;nr_n&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nr&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">n_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>         <span class="n">d</span><span class="p">[</span><span class="s2">&quot;nrF_n&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nrF&quot;</span><span class="p">]</span><span class="o">/</span><span class="n">n_ss</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span>       <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">];</span>                   <span class="n">d</span><span class="p">[</span><span class="s2">&quot;rF&quot;</span><span class="p">]</span>        <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;rF&quot;</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;i_total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;tau&quot;</span><span class="p">]);</span>      <span class="n">d</span><span class="p">[</span><span class="s2">&quot;iF_total&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;tauF&quot;</span><span class="p">])</span>
    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;v_total&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;v&quot;</span><span class="p">]);</span>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;vF_total&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;vF&quot;</span><span class="p">])</span>
      
    <span class="n">y_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;y_n&quot;</span><span class="p">]);</span>                    <span class="c1">#yF_min = np.min(d[&quot;y_n&quot;]);</span>
    <span class="n">c_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;c_n&quot;</span><span class="p">]);</span>                    <span class="c1">#cF_min = np.min(d[&quot;cF_n&quot;]);</span>
    <span class="n">cs_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cs_n&quot;</span><span class="p">]);</span>                  <span class="c1">#csF_min = np.min(d[&quot;csF_n&quot;]);</span>
    <span class="n">ci_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ci_n&quot;</span><span class="p">]);</span>                  <span class="c1">#ciF_min = np.min(d[&quot;ciF_n&quot;]);</span>
    <span class="n">cr_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cr_n&quot;</span><span class="p">]);</span>                  <span class="c1">#crF_min = np.min(d[&quot;crF_n&quot;]);</span>
    <span class="n">n_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;n_n&quot;</span><span class="p">]);</span>                    <span class="c1">#nF_min = np.min(d[&quot;nF_n&quot;]);    </span>
    <span class="n">ns_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ns_n&quot;</span><span class="p">]);</span>                  <span class="c1">#nsF_min = np.min(d[&quot;nsF_n&quot;]);    </span>
    <span class="n">ni_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ni_n&quot;</span><span class="p">]);</span>                  <span class="c1">#niF_min = np.min(d[&quot;niF_n&quot;]); </span>
    <span class="n">nr_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nr_n&quot;</span><span class="p">]);</span>                  <span class="c1">#nrF_min = np.min(d[&quot;nrF_n&quot;]); </span>
    <span class="n">i_max</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]);</span>                  <span class="c1">#iF_max = 100*np.max(d[&quot;iF&quot;]);</span>
    <span class="n">d_max</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;dd&quot;</span><span class="p">]);</span>                 <span class="c1">#dF_max = 100*np.max(d[&quot;ddF&quot;]);</span>
    
    <span class="k">if</span> <span class="n">VACCINATION</span> <span class="ow">and</span> <span class="n">LOCKDOWN</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Vaccination and lockdown programs:&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span><span class="s2">&quot;underline&quot;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">VACCINATION</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Vaccination program:&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span><span class="s2">&quot;underline&quot;</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">LOCKDOWN</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Lockdown program:&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span><span class="s2">&quot;underline&quot;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Baseline scenario:&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span><span class="s2">&quot;underline&quot;</span><span class="p">])</span>
        
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum number of infected </span><span class="si">{</span><span class="n">i_max</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% and death </span><span class="si">{</span><span class="n">d_max</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum output </span><span class="si">{</span><span class="n">y_min</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%, aggregated consumption </span><span class="si">{</span><span class="n">c_min</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% and work hours </span><span class="si">{</span><span class="n">n_min</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum consumption of susceptible</span><span class="si">{</span><span class="n">cs_min</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%, infectious </span><span class="si">{</span><span class="n">ci_min</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">% and recovered </span><span class="si">{</span><span class="n">cr_min</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum working hours of susceptible</span><span class="si">{</span><span class="n">ns_min</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%, infectious </span><span class="si">{</span><span class="n">ni_min</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">% and recovered </span><span class="si">{</span><span class="n">nr_min</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    
    <span class="c1"># Save aggregate working hours</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;data/Dignar/inputs.xlsm&quot;</span><span class="p">))</span>
    <span class="n">getYearlySeries</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;n_n&quot;</span><span class="p">],</span><span class="n">fpath</span><span class="p">,</span><span class="s2">&quot;Exogenous series&quot;</span><span class="p">,</span><span class="s2">&quot;AP&quot;</span><span class="p">,</span><span class="n">SHIFT</span><span class="p">)</span>

    <span class="c1"># # Compute output loss</span>
    <span class="c1"># loss = 0.01*np.sum(d[&quot;y_n&quot;])/52.</span>
    <span class="c1"># drop = 0.01*min(d[&quot;y_n&quot;])</span>
    <span class="c1"># print(f&#39;{par[&quot;theta_lockdown&quot;]},{loss},{drop}\n&#39;)</span>
    <span class="c1"># fout = os.path.abspath(os.path.join(dir_path,&#39;output_loss.csv&#39;))</span>
    <span class="c1"># with open(fout, mode=&#39;a&#39;) as file:</span>
    <span class="c1">#     file.write(f&#39;{par[&quot;theta_lockdown&quot;]},{loss},{drop}\n&#39;)</span>
           
            
    <span class="k">if</span> <span class="n">Plot</span><span class="p">:</span>
        
        <span class="n">list_headers</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Compare SIR model forecast against data</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">;</span> <span class="n">T</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Tmax</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">i_obs</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="n">i_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">i_obs</span><span class="p">[:</span><span class="n">T</span><span class="p">],</span><span class="n">index</span><span class="p">[:</span><span class="n">T</span><span class="p">]);</span> <span class="n">d_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">d_obs</span><span class="p">[:</span><span class="n">T</span><span class="p">],</span><span class="n">index</span><span class="p">[:</span><span class="n">T</span><span class="p">])</span>
        <span class="n">r_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">r_obs</span><span class="p">[:</span><span class="n">T</span><span class="p">],</span><span class="n">index</span><span class="p">[:</span><span class="n">T</span><span class="p">]);</span> <span class="n">s_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">s_obs</span><span class="p">[:</span><span class="n">T</span><span class="p">],</span><span class="n">index</span><span class="p">[:</span><span class="n">T</span><span class="p">])</span>
        <span class="n">i_total_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">i_total_obs</span><span class="p">[:</span><span class="n">T</span><span class="p">],</span><span class="n">index</span><span class="p">[:</span><span class="n">T</span><span class="p">])</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;Virus&#39;</span>
        <span class="n">list_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Infected&#39;</span><span class="p">,</span><span class="s1">&#39;Deaths&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;i1&quot;</span> <span class="ow">in</span> <span class="n">d</span> <span class="ow">and</span> <span class="s2">&quot;i2&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i1&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i2&quot;</span><span class="p">])[</span><span class="n">start_date</span><span class="p">:],</span><span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OBS_i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span><span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i1&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i2&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],[</span><span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;dd&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OBS_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i1&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i2&quot;</span><span class="p">])[</span><span class="mf">1.e-6</span><span class="p">:</span><span class="n">T</span><span class="p">],</span><span class="n">i_obs</span><span class="p">[</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i1&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:</span><span class="n">T</span><span class="p">],</span><span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i2&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:</span><span class="n">T</span><span class="p">]],</span>
                          <span class="p">[</span><span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;dd&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:</span><span class="n">T</span><span class="p">],</span><span class="n">d_obs</span><span class="p">[</span><span class="mf">1.e-6</span><span class="p">:]]]</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span><span class="s1">&#39;Active Cases&#39;</span><span class="p">,</span><span class="s1">&#39;Strain 1&#39;</span><span class="p">,</span><span class="s1">&#39;Strain 2&#39;</span><span class="p">],[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span><span class="s1">&#39;Data&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i1&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i2&quot;</span><span class="p">]),</span><span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OBS_i&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()],[</span><span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;dd&quot;</span><span class="p">],</span><span class="mi">100</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;OBS_d&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i1&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;i2&quot;</span><span class="p">])[</span><span class="mf">1.e-6</span><span class="p">:</span><span class="n">T</span><span class="p">],</span><span class="n">i_obs</span><span class="p">[</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                          <span class="p">[</span><span class="mi">100</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;dd&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:</span><span class="n">T</span><span class="p">],</span><span class="n">d_obs</span><span class="p">[</span><span class="mf">1.e-6</span><span class="p">:]]]</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span><span class="s1">&#39;Current Cases&#39;</span><span class="p">],[</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span><span class="s1">&#39;Data&#39;</span><span class="p">]]</span>

        <span class="n">plotTimeSeries</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">graphs_path</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span><span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">,</span><span class="n">sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fig_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">bPercent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>


        <span class="c1"># ERT model economy forecast</span>
        <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;y_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;yF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;c_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;w_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;wF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;n_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;x_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;xF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;rr_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;rrF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;Rb_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;RbF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;k_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;kF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;pie&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;pieF&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]]</span>
                 <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;y_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;yF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;c_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;w_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;wF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;n_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;x_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;xF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;rr_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;rrF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;Rb_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;RbF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;k_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;kF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                      <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;pie&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;pieF&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]]</span>
                 <span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;Economy&#39;</span>
        <span class="n">list_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Output&#39;</span><span class="p">,</span><span class="s1">&#39;Aggregate Consumption&#39;</span><span class="p">,</span><span class="s1">&#39;Wage Rate&#39;</span><span class="p">,</span> <span class="s1">&#39;Aggregate Hours&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Investment&#39;</span><span class="p">,</span><span class="s1">&#39;Real Interest Rate&#39;</span><span class="p">,</span><span class="s1">&#39;Policy Rate&#39;</span><span class="p">,</span><span class="s1">&#39;Capital&#39;</span><span class="p">,</span><span class="s1">&#39;Inflation&#39;</span>
                 <span class="p">]</span>
        
        <span class="n">labels</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Sticky Price Economy&#39;</span><span class="p">,</span><span class="s1">&#39;Flexible Price Economy&#39;</span><span class="p">],[],[],[],[],[],[],[],[]]</span>
    
        <span class="n">plotTimeSeries</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">graphs_path</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span><span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">,</span><span class="n">sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">highlight</span><span class="o">=</span><span class="n">highlight</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fig_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>
    
        
        <span class="c1"># ERT model economy forecast (continued)</span>
        <span class="k">if</span> <span class="s2">&quot;range&quot;</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cs_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;csF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ci_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ciF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                     <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cr_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;crF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ns_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nsF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                     <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ni_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;niF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nr_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nrF_n&quot;</span><span class="p">][</span><span class="n">start_date</span><span class="p">:]],</span>
                    <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">series</span> <span class="o">=</span> <span class="p">[[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cs_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;csF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ci_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ciF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                     <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;cr_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;crF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ns_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nsF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                     <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;ni_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;niF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nr_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:],</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;nrF_n&quot;</span><span class="p">][</span><span class="mf">1.e-6</span><span class="p">:]],</span>
                    <span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;Economy (continued)&#39;</span>
        <span class="n">list_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Consumption of Susceptibles&#39;</span><span class="p">,</span><span class="s1">&#39;Consumption of Infected&#39;</span><span class="p">,</span><span class="s1">&#39;Consumption of Recovered&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Work Hours of Susceptibles &#39;</span><span class="p">,</span><span class="s1">&#39;Work Hours of Infected &#39;</span><span class="p">,</span><span class="s1">&#39;Work Hours of Recovered&#39;</span>
                 <span class="p">]</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;Sticky Price Economy&#39;</span><span class="p">,</span><span class="s1">&#39;Flexible Price Economy&#39;</span><span class="p">],[],[],[],[],[]]</span>
        <span class="n">plotTimeSeries</span><span class="p">(</span><span class="n">path_to_dir</span><span class="o">=</span><span class="n">graphs_path</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">titles</span><span class="o">=</span><span class="n">titles</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span><span class="n">series</span><span class="o">=</span><span class="n">series</span><span class="p">,</span><span class="n">sizes</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span><span class="n">highlight</span><span class="o">=</span><span class="n">highlight</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fig_sizes</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">bPercent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">list_headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SIR Model Forecast&#39;</span><span class="p">,</span><span class="s1">&#39;Sticky and Flexible Prices Economies&#39;</span><span class="p">,</span><span class="s1">&#39;Economies&#39;</span><span class="p">]</span>
        
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
        <span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">LinearLocator</span>
        <span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.merge</span> <span class="kn">import</span> <span class="n">merge</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">saveTimeSeries</span>
        
        
        <span class="k">if</span> <span class="n">Plot</span><span class="p">:</span>
            <span class="n">outputFile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;results/ERT.pdf&quot;</span><span class="p">))</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">list_headers</span><span class="p">:</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span><span class="s2">&quot;graphs/&quot;</span><span class="o">+</span><span class="n">f</span><span class="o">+</span><span class="s2">&quot;.pdf&quot;</span><span class="p">))))</span>
            <span class="n">merge</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span><span class="n">files</span><span class="p">)</span>
                      
            <span class="k">if</span> <span class="n">n_lockdown</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">n_vaccination</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Make mesh grid.</span>
                <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">n_lockdown</span><span class="p">)</span> <span class="c1"># * theta_lockdown</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">n_vaccination</span><span class="p">)</span> <span class="c1"># * vaccination_rate</span>
                <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
                <span class="c1"># Plot the surface.</span>
                
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
                <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
                <span class="n">surf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">antialiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># Customize the z axis.</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">LinearLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
                <span class="c1"># A StrMethodFormatter is used automatically</span>
                <span class="c1">#ax.zaxis.set_major_formatter(&#39;{x:.0f}&#39;)</span>
                <span class="c1"># Add a color bar which maps values to colors.</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Lockdown&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Vaccination&#39;</span><span class="p">)</span>
                <span class="c1">#ax.set_zlabel(&#39;Utility&#39;)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Utility Function&#39;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphs_path</span><span class="p">,</span><span class="s1">&#39;Polycies.png&#39;</span><span class="p">)))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>     
        <span class="k">if</span> <span class="n">LOCKDOWN</span> <span class="ow">and</span> <span class="n">VACCINATION</span><span class="p">:</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span><span class="n">list_headers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_lockdown_vaccination.csv&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">LOCKDOWN</span><span class="p">:</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span><span class="n">list_headers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_lockdown.csv&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">VACCINATION</span><span class="p">:</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span><span class="n">list_headers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_vaccination.csv&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span><span class="n">list_headers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">))</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">100</span><span class="p">;</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">100</span><span class="p">;</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">100</span><span class="p">;</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;dd&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">100</span><span class="p">;</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;pop&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">100</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">SHIFT</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">saveTimeSeries</span><span class="p">(</span><span class="n">fname</span><span class="o">=</span><span class="n">fout</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
        
        <span class="n">fout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span><span class="s1">&#39;polycies.csv&#39;</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fout</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Lockdown,Vaccination,Total Utility,Utility,Cost of Loss of Lives</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">polycies</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
  
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done with ERT model simulations!!!&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="SIR">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.SIR">[docs]</a>
<span class="k">def</span> <span class="nf">SIR</span><span class="p">(</span><span class="n">pii</span><span class="p">,</span><span class="n">pir</span><span class="p">,</span><span class="n">pid</span><span class="p">,</span><span class="n">s0</span><span class="p">,</span><span class="n">i0</span><span class="p">,</span><span class="n">r0</span><span class="p">,</span><span class="n">dd0</span><span class="p">,</span><span class="n">pop0</span><span class="p">,</span><span class="n">lockdown_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">vaccination_rate</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SIR model forecast.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">Nmax</span><span class="p">,</span><span class="n">mult</span><span class="p">,</span><span class="n">mult2</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Nmax</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="n">tau1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span> <span class="n">tau2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">vaccinated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>   <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s0</span>
    <span class="n">i</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>   <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i0</span>
    <span class="n">i1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>   <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i0</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>   <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">i0</span>
    <span class="n">r</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>   <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r0</span>
    <span class="n">dd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>   <span class="n">dd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dd0</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>  <span class="n">pop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop0</span>
    
    <span class="k">if</span> <span class="n">fname</span> <span class="o">==</span> <span class="s2">&quot;ert1_model.yaml&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="c1"># Vaccinated</span>
            <span class="n">vaccinated</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">vaccinated</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">vaccination_rate</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">pii</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">i1</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">+</span><span class="n">mult</span><span class="o">*</span><span class="n">pii</span><span class="o">*</span><span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">*</span><span class="n">vaccinated</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="c1"># Wildtype virus infection</span>
            <span class="n">tau1</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pii</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">i1</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">i1</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i1</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">tau1</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pii</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">i1</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">vaccinated</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span> <span class="p">(</span><span class="n">pir</span><span class="o">+</span><span class="n">pid</span><span class="p">)</span><span class="o">*</span><span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="c1"># Virus variant infection</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="o">*</span><span class="n">virus_variant_start</span><span class="p">:</span>
                <span class="n">tau2</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mult</span><span class="o">*</span><span class="n">pii</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> 
                <span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">tau2</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">mult</span><span class="o">*</span><span class="n">pii</span><span class="o">*</span><span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">vaccinated</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">pir</span><span class="o">+</span><span class="n">pid</span><span class="o">/</span><span class="n">mult2</span><span class="p">)</span><span class="o">*</span><span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="c1"># Susceptible</span>
            <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">tau1</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tau2</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">vaccination_rate</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="c1"># Total infected</span>
            <span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i1</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Recovered</span>
            <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">pir</span><span class="o">*</span><span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="c1"># Deceased </span>
            <span class="n">dd</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">pid</span><span class="o">*</span><span class="n">i1</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">pid</span><span class="o">/</span><span class="n">mult2</span><span class="o">*</span><span class="n">i2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
            
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">vaccination_rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">newly_vaccinated</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">vaccination_rate</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newly_vaccinated</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">lockdown_rate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lockdown</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">lockdown_rate</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lockdown</span> <span class="o">=</span> <span class="mi">1</span>
                
            <span class="n">vaccinated</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">vaccinated</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">newly_vaccinated</span>
            <span class="c1"># New infections</span>
            <span class="n">tau</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pii</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">lockdown</span><span class="o">**</span><span class="mi">2</span>
            <span class="c1"># Susceptibles</span>
            <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">tau</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">newly_vaccinated</span>
            <span class="c1"># Infected</span>
            <span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">tau</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">pir</span><span class="o">+</span><span class="n">pid</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="c1"># Recovered</span>
            <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">pir</span><span class="o">*</span><span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">newly_vaccinated</span>
            <span class="c1"># Total deaths </span>
            <span class="n">dd</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">pid</span><span class="o">*</span><span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> 
            <span class="c1"># Population</span>
            <span class="n">pop</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pop</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">pid</span><span class="o">*</span><span class="n">i</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">tau</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">dd</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">pop</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">vaccinated</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span></div>



<div class="viewcode-block" id="func">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.func">[docs]</a>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate infection spread.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">Nmax</span><span class="p">,</span><span class="n">I_ini</span><span class="p">,</span><span class="n">D_ini</span><span class="p">,</span><span class="n">Pir</span><span class="p">,</span><span class="n">Pid</span><span class="p">,</span><span class="n">C_ss</span><span class="p">,</span><span class="n">N_ss</span>
    <span class="k">global</span> <span class="n">I</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">T</span>
    
    <span class="c1"># Preallocate arrays</span>
    <span class="n">I</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="n">S</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="n">D</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span><span class="n">T</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nmax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Initial guess</span>
    <span class="n">pi1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">scale1</span>
    <span class="n">pi2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">scale2</span>
    <span class="n">pi3</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Initial conditions</span>
    <span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I_ini</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">D</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">D_ini</span>
    <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># Iterate SIR model equations</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nmax</span><span class="p">):</span>
        <span class="n">T</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>   <span class="o">=</span> <span class="n">pi1</span><span class="o">*</span><span class="n">S</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">C_ss</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">pi2</span><span class="o">*</span><span class="n">S</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">N_ss</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">pi3</span><span class="o">*</span><span class="n">S</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">S</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">T</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">Pir</span><span class="o">+</span><span class="n">Pid</span><span class="p">)</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">R</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">Pir</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">Pid</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">I</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">T</span></div>



<div class="viewcode-block" id="func1">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.func1">[docs]</a>
<span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calibration function.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">Pi1_shr_target</span><span class="p">,</span><span class="n">Pi2_shr_target</span><span class="p">,</span><span class="n">Pi3_shr_target</span><span class="p">,</span><span class="n">RplusD_target</span><span class="p">,</span><span class="n">C_ss</span><span class="p">,</span><span class="n">N_ss</span><span class="p">,</span><span class="n">scale1</span><span class="p">,</span><span class="n">scale2</span><span class="p">,</span><span class="n">Model_R</span>
    <span class="k">global</span> <span class="n">I</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">T</span>
    
    <span class="c1"># Initial guess</span>
    <span class="n">pi1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">scale1</span>
    <span class="n">pi2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">scale2</span>
    <span class="n">pi3</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="n">RplusD_target</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">pi3_shr_target</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">share</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">Pi1_shr_target</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pi3_shr_target</span><span class="p">)</span><span class="o">*</span><span class="n">share</span>
        <span class="n">Pi2_shr_target</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pi3_shr_target</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">share</span><span class="p">)</span>
        <span class="n">Pi3_shr_target</span> <span class="o">=</span> <span class="n">pi3_shr_target</span>
    
    <span class="c1"># Calculate infection desease spread.</span>
    <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1"># Calculate residuals for target equations</span>
    <span class="n">err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pi1_shr_target</span><span class="o">-</span><span class="p">(</span><span class="n">pi1</span><span class="o">*</span><span class="n">C_ss</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pi1</span><span class="o">*</span><span class="n">C_ss</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">pi2</span><span class="o">*</span><span class="n">N_ss</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">pi3</span><span class="p">)</span>
    <span class="n">err</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pi2_shr_target</span><span class="o">-</span><span class="p">(</span><span class="n">pi2</span><span class="o">*</span><span class="n">N_ss</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pi1</span><span class="o">*</span><span class="n">C_ss</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">pi2</span><span class="o">*</span><span class="n">N_ss</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">pi3</span><span class="p">)</span>
    <span class="n">err</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">RplusD_target</span><span class="o">-</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">D</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    
    <span class="n">Model_R</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">Pir</span><span class="o">+</span><span class="n">Pid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">err</span></div>



<div class="viewcode-block" id="func_squared">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.func_squared">[docs]</a>
<span class="k">def</span> <span class="nf">func_squared</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error function for constrained calibration.&quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">func1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span></div>



<div class="viewcode-block" id="func2_squared">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.func2_squared">[docs]</a>
<span class="k">def</span> <span class="nf">func2_squared</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error function for constrained calibration.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">RplusD_target</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">func1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">err1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">I_OBS</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">D_OBS</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">err2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>    
        <span class="n">err2</span> <span class="o">=</span> <span class="p">(</span> <span class="n">D_OBS</span><span class="o">-</span><span class="n">D</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">D_OBS</span><span class="p">)])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">I_OBS</span><span class="o">-</span><span class="n">I</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">I_OBS</span><span class="p">)])</span><span class="o">**</span><span class="mi">2</span> 
        <span class="c1">#err2 += (R_OBS-R[:len(R_OBS)])**2+(S_OBS-S[:len(S_OBS)])**2</span>
        <span class="c1">#print(100*np.sqrt(err2))</span>
    <span class="n">err2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">err2</span><span class="p">)</span>
    <span class="n">err</span>  <span class="o">=</span> <span class="n">err1</span> <span class="o">+</span> <span class="n">err2</span>
    <span class="k">return</span> <span class="n">err</span></div>



<div class="viewcode-block" id="calibrate">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.calibrate">[docs]</a>
<span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="n">pi1</span><span class="p">,</span><span class="n">pi2</span><span class="p">,</span><span class="n">pi3</span><span class="p">,</span><span class="n">pi1_shr_target</span><span class="p">,</span><span class="n">pi2_shr_target</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calibrate pi1, pi2 and pi3 using SIR model.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">Nmax</span><span class="p">,</span><span class="n">Pi1_shr_target</span><span class="p">,</span><span class="n">Pi2_shr_target</span><span class="p">,</span><span class="n">RplusD_target</span><span class="p">,</span><span class="n">scale1</span><span class="p">,</span><span class="n">scale2</span><span class="p">,</span><span class="n">Model_R</span> 
    
    <span class="n">Pi1_shr_target</span> <span class="o">=</span> <span class="n">pi1_shr_target</span><span class="p">;</span> <span class="n">Pi2_shr_target</span> <span class="o">=</span> <span class="n">pi2_shr_target</span>

    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pi1</span><span class="o">*</span><span class="n">scale1</span><span class="p">,</span><span class="n">pi2</span><span class="o">*</span><span class="n">scale2</span><span class="p">,</span><span class="n">pi3</span><span class="p">])</span>
    <span class="c1">#Unconstrained optimization</span>
    <span class="c1">#sol = root(func,x0,method=&#39;lm&#39;,tol=1e-7,options={&quot;maxiter&quot;:1000})</span>
    
    <span class="c1"># Constrained optimization.</span>
    <span class="c1"># We assume that weekly infaction rate can not be smaller than the sum of</span>
    <span class="c1"># weekly recovery and death rates.</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="n">Bounds</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Pir</span><span class="o">+</span><span class="n">Pid</span><span class="p">],[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
    <span class="c1"># ERT paper uses unconstrained optimization... </span>
    <span class="c1"># So, uncomment this line to match ERT results.</span>
    <span class="c1"># bounds = Bounds([0,0,0],[1.,1.,np.inf])</span>
    <span class="n">sol</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">func_squared</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;trust-constr&#39;</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
    
    <span class="n">pi</span>  <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">x</span>
    <span class="n">pi1</span> <span class="o">=</span> <span class="n">pi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale1</span>
    <span class="n">pi2</span> <span class="o">=</span> <span class="n">pi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">scale2</span>
    <span class="n">pi3</span> <span class="o">=</span> <span class="n">pi</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">fun</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">status</span>
            
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sol</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Could not calibrate SIR model: error=</span><span class="si">{</span><span class="n">err</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">, status=</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cprint</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Calibrated SIR model: error=</span><span class="si">{</span><span class="n">err</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">, status=</span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="p">(</span><span class="n">Model_R</span><span class="p">,</span><span class="n">pi1</span><span class="p">,</span><span class="n">pi2</span><span class="p">,</span><span class="n">pi3</span><span class="p">)</span></div>



<div class="viewcode-block" id="integral">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.integral">[docs]</a>
<span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="n">betta</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="n">ci</span><span class="p">,</span><span class="n">cr</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ni</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">Ti</span><span class="p">,</span><span class="n">income</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute household lifetime utility.</span>
<span class="sd">    </span>
<span class="sd">     Cost of loss of lives is a discounted value of &#39;Ti&#39; years of individual income.</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="n">utility</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">I</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
        <span class="n">utility</span> <span class="o">+=</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span><span class="n">cs</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">ns</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
        <span class="n">utility</span> <span class="o">+=</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span><span class="n">ci</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">ni</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
        <span class="n">utility</span> <span class="o">+=</span> <span class="n">beta</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span><span class="n">cr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">nr</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))))</span>
        <span class="n">beta</span> <span class="o">*=</span> <span class="n">betta</span>
    <span class="n">utility</span> <span class="o">/=</span> <span class="mi">52</span>
        
    <span class="n">cost_of_lives</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">52</span><span class="o">*</span><span class="n">Ti</span><span class="p">):</span>
        <span class="n">cost_of_lives</span> <span class="o">+=</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">income</span>
        <span class="n">beta</span> <span class="o">*=</span> <span class="n">betta</span>
    <span class="n">cost_of_lives</span> <span class="o">/=</span> <span class="mi">52</span>
        
    <span class="k">return</span> <span class="n">utility</span><span class="p">,</span><span class="n">cost_of_lives</span></div>

    

<div class="viewcode-block" id="getYearlySeries">
<a class="viewcode-back" href="../../../../source/snowdrop.src.epidemic.html#snowdrop.src.epidemic.ert.getYearlySeries">[docs]</a>
<span class="k">def</span> <span class="nf">getYearlySeries</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="n">fpath</span><span class="p">,</span><span class="n">sheet_name</span><span class="p">,</span><span class="n">column</span><span class="p">,</span><span class="n">startrow</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert weekly frequency to yearly frequency.</span>
<span class="sd">    </span>
<span class="sd">       This approximates shortage of labor supply due to COVID-19 effects.</span>
<span class="sd">       It is used in DIGNAR-19 toolkitf to calibrate model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="c1"># Convert weekly frequency to daily</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="n">startrow</span><span class="p">:]</span>
            <span class="n">weeks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">weeks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="mi">13</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
        
        <span class="n">values</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span>
        
        <span class="c1"># Aggregate by year</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">lst</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">yprev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weeks</span><span class="p">):</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">w</span><span class="o">//</span><span class="mi">52</span>
            <span class="k">if</span> <span class="n">y</span><span class="o">-</span><span class="n">yprev</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span>
                <span class="n">yprev</span> <span class="o">=</span> <span class="n">y</span>
                <span class="n">lst</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            
        <span class="c1"># Append the last batch</span>
        <span class="k">if</span> <span class="n">weeks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">52</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span>
            
            
        <span class="n">agg</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Minimum yearly working hours drop:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">agg</span><span class="p">))</span>
        
        <span class="n">agg</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Average yearly working hours drop:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">agg</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">agg</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">agg</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">agg</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="c1"># Save data</span>
            <span class="kn">from</span> <span class="nn">openpyxl</span> <span class="kn">import</span> <span class="n">load_workbook</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
                <span class="n">sh</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">sh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">row_num</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">agg</span><span class="p">):</span>
                        <span class="n">rng</span> <span class="o">=</span> <span class="n">column</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">startrow</span><span class="o">+</span><span class="n">row_num</span><span class="p">)</span>
                        <span class="n">sh</span><span class="p">[</span><span class="n">rng</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

                
                
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The main program.&quot;&quot;&quot;</span>
    <span class="n">main</span><span class="p">(</span><span class="n">Plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">Python Platform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules.html">snowdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../info.html">Python Platform</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Alexei Goumilevski.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>