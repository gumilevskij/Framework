<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>snowdrop.src.model.model &#8212; Python Platform 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=61cd365c" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=12dfc556" />
    <script src="../../../../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for snowdrop.src.model.model</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Model class.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.model.settings</span> <span class="kn">import</span> <span class="n">SolverMethod</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.model.util</span> <span class="kn">import</span> <span class="n">setValues</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.utils.equations</span> <span class="kn">import</span> <span class="n">getMaxLeadsLags</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.misc.termcolor</span> <span class="kn">import</span> <span class="n">cprint</span><span class="p">,</span> <span class="n">colored</span>
<span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.function</span> <span class="kn">import</span> <span class="n">get_function_and_jacobian</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="n">lst1</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">lst2</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">lst3</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Model">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model">[docs]</a>
<span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">interface</span><span class="p">,</span><span class="n">anticipate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">infos</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">bCompileAll</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct Model class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            :param interface: Interface object.</span>
<span class="sd">            :type interface: `Interface&#39;.</span>
<span class="sd">            :param anticipate: If True future shocks are anticipated.</span>
<span class="sd">            :type anticipate: bool.</span>
<span class="sd">            :param options: Model options.</span>
<span class="sd">            :type options: dict.</span>
<span class="sd">            :param infos: Model Info.</span>
<span class="sd">            :type infos: dict.</span>
<span class="sd">            :param bCompileAll: If True compiles all functions source code.</span>
<span class="sd">            :type bCompileAll:  bool, optional.</span>
<span class="sd">            :returns:  Instance of a `Model&#39; class.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span>             <span class="o">=</span> <span class="n">interface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span>              <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span>          <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">calibration_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eq_vars</span>              <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">eq_vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steady_state</span>         <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">steady_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">steady_growth</span>        <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ss</span>                   <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">ss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eqLabels</span>             <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">eqLabels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numberOfNewEqs</span>       <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">numberOfNewEqs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">terminal_values</span>      <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">terminal_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autodiff</span>             <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">autodiff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jaxdiff</span>              <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">jaxdiff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SOLVER</span>               <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">SOLVER</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span>                <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">interface</span><span class="o">.</span><span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">interface</span><span class="o">.</span><span class="n">order</span>
        
        <span class="c1">#self.variables = sum( [tuple(e) for k,e in  self.symbols.items() if k not in (&#39;parameters&#39;,&#39;shocks&#39;,&#39;exogenous&#39;, &#39;values&#39;,&#39;equations_labels&#39;)], ())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span>              <span class="o">=</span> <span class="n">options</span> <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_sources</span>         <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">data_sources</span> <span class="k">if</span> <span class="n">interface</span><span class="o">.</span><span class="n">data_sources</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infos</span>                <span class="o">=</span> <span class="n">infos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>                 <span class="o">=</span> <span class="s2">&quot;model&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">priors</span>               <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">priors</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">isLinear</span>             <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solved</span>               <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ev</span>                   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nUnit</span>                <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anticipate</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span>              <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condShocks</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_range</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span>                <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span>                    <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FILTER</span>               <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SMOOTHER</span>             <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INIT_COND_CORRECTION</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PRIOR</span>                <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_nmbr_shocks</span>    <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimate</span>             <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Topology</span>             <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stable</span>               <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unstable</span>             <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_lead_shock</span>       <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_lag_shock</span>        <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_lead_exog</span>        <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_lag_exog</span>         <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LOG_LINEARIZE_EQS</span>    <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;log_variables&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="s2">&quot;log_variables&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">COMPLEMENTARITY_CONDITIONS</span>   <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">COMPLEMENTARITY_CONDITIONS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flippedEndogVariables</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flippedExogVariables</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedEndogVariables</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedExogVariables</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span>                     <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span>             <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bCompileAll</span>           <span class="o">=</span> <span class="n">bCompileAll</span>
        
        <span class="c1"># Use sparse algebra matrix calculations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bSparse</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">bSparse</span> <span class="ow">or</span> <span class="n">interface</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">==</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">ABLR</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">anticipate</span>           <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lead_lag_incidence</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_rows_incidence</span>   <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear_model</span>         <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FILTER</span>               <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SMOOTHER</span>             <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INIT_COND_CORRECTION</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PRIOR</span>                <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_vars</span>           <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">state_vars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eqs_number</span>           <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">eqs_number</span> 
        
        <span class="c1"># Update calibration parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__update_from_symbolic__</span><span class="p">()</span>
        
        <span class="c1"># Save exogenous series</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">getExogenousSeries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;exogenous&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">getExogenousSeries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">bCompileAll</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__compile_functions__</span><span class="p">()</span>
                
            <span class="c1"># Check if model is linear</span>
            <span class="n">var</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">,</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span><span class="s1">&#39;shocks&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
                
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">))</span>
            <span class="n">jacob1</span> <span class="o">=</span> <span class="n">get_function_and_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">jacob2</span> <span class="o">=</span> <span class="n">get_function_and_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.001</span><span class="o">+</span><span class="n">z</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">isLinear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">jacob1</span> <span class="o">==</span> <span class="n">jacob2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isLinear</span> <span class="o">=</span> <span class="n">isLinear</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOLVER</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isLinear</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">AndersonMoore</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">SOLVER</span> <span class="o">=</span> <span class="n">SolverMethod</span><span class="o">.</span><span class="n">LBJ</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLinear</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">snowdrop.src.utils.equations</span> <span class="kn">import</span> <span class="n">getLeadLagIncidence</span>
                <span class="kn">from</span> <span class="nn">snowdrop.src.utils.equations</span> <span class="kn">import</span> <span class="n">topology</span>
                <span class="c1"># from snowdrop.src.utils.equations import getVarRowsIncidence</span>
                <span class="c1"># Get Lead Lag Incidence matrix</span>
                <span class="n">lli</span> <span class="o">=</span> <span class="n">getLeadLagIncidence</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="c1"># getVarRowsIncidence(self)</span>
                <span class="c1"># Get variables topology. Find variables position in equations.     </span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">bellman</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">interface</span><span class="o">.</span><span class="n">objective_function</span><span class="p">):</span>
                    <span class="n">topology</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lli</span> <span class="o">=</span> <span class="kc">None</span>
    
         
    <span class="k">def</span> <span class="nf">__update_from_symbolic__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update calibration dictionary according to the symbols definitions.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.misc</span> <span class="kn">import</span> <span class="n">CalibrationDict</span><span class="p">,</span> <span class="n">calibration_to_vector</span>
        
        
        <span class="c1"># Check if calibration dictionary or options contain symbolic expressions</span>
        <span class="n">b</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;distribution&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">distribution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="n">shock_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;shock_values&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">shock_values</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">shock_values</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                        <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                                <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">break</span>
                    
        <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.eval_solver</span> <span class="kn">import</span> <span class="n">evaluate</span>
            <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.symbolic_eval</span> <span class="kn">import</span> <span class="n">NumericEval</span>
            
            <span class="c1"># x=dict(self.symbolic.calibration_dict)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibration_dict</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">calibration_dict</span><span class="p">)</span>
    
            <span class="n">calib</span> <span class="o">=</span> <span class="n">calibration_to_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span> <span class="o">=</span> <span class="n">CalibrationDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="n">calib</span><span class="p">)</span>
    
            <span class="c1"># Read symbolic structure</span>
            <span class="n">evaluator</span> <span class="o">=</span> <span class="n">NumericEval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calibration_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">distribution</span><span class="p">)</span>
    
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">covariances</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">covariances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">cov</span><span class="p">))</span>
                
        <span class="k">else</span><span class="p">:</span>   
            <span class="n">calib</span> <span class="o">=</span> <span class="n">calibration_to_vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span> <span class="o">=</span> <span class="n">CalibrationDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">,</span> <span class="n">calib</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">options</span>


<div class="viewcode-block" id="Model.get_calibration">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.get_calibration">[docs]</a>
    <span class="k">def</span> <span class="nf">get_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pname</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return calibration value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            :param pname: name of the variable.</span>
<span class="sd">            :type pname: str</span>
<span class="sd">            :param args: Variable number of arguments.</span>
<span class="sd">            :type args: Tuple</span>
<span class="sd">            :returns:  Calibration value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pname</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_calibration</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pname</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pname</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">get_calibration</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pname</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">pnames</span> <span class="o">=</span> <span class="p">(</span><span class="n">pname</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_calibration</span><span class="p">(</span><span class="n">pnames</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">pname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">g</span><span class="p">]]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown symbol </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pname</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="n">group</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pname</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">v</span></div>



<div class="viewcode-block" id="Model.set_calibration">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.set_calibration">[docs]</a>
    <span class="k">def</span> <span class="nf">set_calibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the calibration value.</span>
<span class="sd">        </span>
<span class="sd">        .. note::</span>
<span class="sd">            PLEASE USE THIS FUNCTION ONLY WHEN VALUE IS A SCALAR!!!</span>
<span class="sd">            IN OTHER WORDS THIS VALUE SHOULD NOT BE TIME DEPENDENT.</span>
<span class="sd">            </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;</span>
<span class="sd">            :param args: Variable number of arguments.</span>
<span class="sd">            :type args: Tuple</span>
<span class="sd">            :param kwargs: Arbitrary number of keyword arguments </span>
<span class="sd">            :type kwargs: dict</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># raise exception if unknown symbol ?</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">pname</span><span class="p">,</span> <span class="n">pvalue</span> <span class="o">=</span> <span class="n">args</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pname</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_calibration</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">pname</span><span class="p">:</span><span class="n">pvalue</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># else ignore pname and pvalue</span>
            <span class="n">calib</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">calibration_dict</span>
            <span class="n">calib</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__update_from_symbolic__</span><span class="p">()</span></div>



    <span class="k">def</span> <span class="nf">__compile_functions__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compile model equations function and compute Jacobian matrix up to the third order.</span>
<span class="sd">            </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Parameter.</span>
<span class="sd">            :type self: Model.</span>
<span class="sd">            :returns:  List of functions.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.function_compiler_sympy</span> <span class="kn">import</span> <span class="n">compile_higher_order_function</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.function_compiler_sympy</span> <span class="kn">import</span> <span class="n">compile_function</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.function_compiler_sympy</span> <span class="kn">import</span> <span class="n">compile_jacobian</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.equations</span> <span class="kn">import</span> <span class="n">getRHS</span>
        <span class="kn">import</span> <span class="nn">snowdrop.src.preprocessor.function_compiler_sympy</span> <span class="k">as</span> <span class="nn">fc</span>
        
        <span class="n">func</span> <span class="o">=</span> <span class="n">f_jacob</span> <span class="o">=</span> <span class="n">f_hessian</span> <span class="o">=</span> <span class="n">f_tensor</span> <span class="o">=</span> <span class="n">src_dynamic</span> <span class="o">=</span> <span class="n">src_sparse</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="n">shocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;shocks&#39;</span><span class="p">,[])</span>
        <span class="n">measurement_shocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;measurement_shocks&#39;</span><span class="p">,[])</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
        <span class="n">logv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_variables&#39;</span><span class="p">,[])</span>
        <span class="n">ss_vv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;endogenous&#39;</span><span class="p">]</span>
            
        <span class="c1"># Gets maximum of leads and minimum of lags of equations variables</span>
        <span class="n">max_lead</span><span class="p">,</span><span class="n">min_lag</span><span class="p">,</span><span class="n">n_fwd_looking_var</span><span class="p">,</span><span class="n">n_bkwd_looking_var</span><span class="p">,</span><span class="n">var_lead</span><span class="p">,</span><span class="n">var_lag</span> <span class="o">=</span> \
            <span class="n">getMaxLeadsLags</span><span class="p">(</span><span class="n">eqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="n">vv</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_lead</span> <span class="o">=</span> <span class="n">max_lead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_lag</span> <span class="o">=</span> <span class="n">min_lag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_fwd_looking_var</span> <span class="o">=</span> <span class="n">n_fwd_looking_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_bkwd_looking_var</span> <span class="o">=</span> <span class="n">n_bkwd_looking_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_lead</span> <span class="o">=</span> <span class="n">var_lead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_lag</span> <span class="o">=</span> <span class="n">var_lag</span>
        
        <span class="c1"># Gets maximum of leads and minimum of lags of equations shock variables</span>
        <span class="n">max_lead_shock</span><span class="p">,</span><span class="n">min_lag_shock</span><span class="p">,</span><span class="n">n_fwd_looking_shocks</span><span class="p">,</span><span class="n">n_bkwd_looking_shocks</span><span class="p">,</span><span class="n">shock_lead</span><span class="p">,</span><span class="n">shock_lag</span> <span class="o">=</span> \
            <span class="n">getMaxLeadsLags</span><span class="p">(</span><span class="n">eqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="n">shocks</span><span class="p">)</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">max_lead_shock</span> <span class="o">=</span> <span class="n">max_lead_shock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_lag_shock</span> <span class="o">=</span> <span class="n">min_lag_shock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_fwd_looking_shocks</span> <span class="o">=</span> <span class="n">n_fwd_looking_shocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_bkwd_looking_shocks</span> <span class="o">=</span> <span class="n">n_bkwd_looking_shocks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_lead</span> <span class="o">=</span> <span class="n">shock_lead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_lag</span> <span class="o">=</span> <span class="n">shock_lag</span>
           
        <span class="c1"># Constructs arguments of function f([y(1),y,y(-1),e],p)</span>
        <span class="n">syms</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">]</span>
        <span class="n">syms_shock</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_lag_shock</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">max_lead_shock</span><span class="p">):</span>
            <span class="n">syms_shock</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shocks</span><span class="p">]</span>
        
        <span class="n">syms</span> <span class="o">+=</span> <span class="n">syms_shock</span>
        <span class="n">syms_ss</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ss_vv</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">shocks</span><span class="p">]</span>
        
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;exogenous&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">exog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">syms_exog</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">syms_exog_ss</span> <span class="o">=</span> <span class="p">[]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get maximum of leads and minimum of lags of equations exogenous variables</span>
            <span class="n">max_lead_exog</span><span class="p">,</span><span class="n">min_lag_exog</span><span class="p">,</span><span class="n">n_fwd_looking_exog</span><span class="p">,</span><span class="n">n_bkwd_looking_exog</span><span class="p">,</span><span class="n">exog_lead</span><span class="p">,</span><span class="n">exoglag</span> <span class="o">=</span> \
                <span class="n">getMaxLeadsLags</span><span class="p">(</span><span class="n">eqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="n">exog</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">max_lead_exog</span> <span class="o">=</span> <span class="n">max_lead_exog</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_lag_exog</span> <span class="o">=</span> <span class="n">min_lag_exog</span>
            
            <span class="n">syms_exog</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_lag_exog</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">max_lead_exog</span><span class="p">):</span>
                <span class="n">syms_exog</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">exog</span><span class="p">]</span>
                
            <span class="n">syms_exog_ss</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">exog</span><span class="p">]</span>
            
         <span class="c1"># Measurement variables</span>
        <span class="k">if</span> <span class="s1">&#39;measurement_variables&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">:</span>
            <span class="n">vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;measurement_variables&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="n">vm</span> <span class="o">=</span> <span class="p">[]</span>
        
         <span class="c1"># Constructs arguments of function f(y,e,p)</span>
        <span class="n">meas_syms</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">]</span>
        <span class="n">meas_syms</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vm</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">measurement_shocks</span><span class="p">):</span>
            <span class="n">meas_syms</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">measurement_shocks</span><span class="p">]</span>
            
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>

        <span class="c1">### Construct list of equations to differentiate</span>
        <span class="c1"># Transient equations</span>
        <span class="n">eqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">eq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">equations</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">eq</span>
            <span class="n">eqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            
        <span class="n">steady_state_eqs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">eq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">ss_equations</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">eq</span>
            <span class="n">steady_state_eqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">measurement_equations</span><span class="p">):</span>
            <span class="c1"># Measurement equations   </span>
            <span class="n">meas_eqs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">eq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">measurement_equations</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">eq</span>
                <span class="n">meas_eqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    
            <span class="c1"># Compile measurement function and compute its partial derivatives </span>
            <span class="n">fc</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">meas_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;measurement_parameters&#39;</span><span class="p">]</span>
            <span class="n">f_measurement</span> <span class="o">=</span> <span class="n">compile_higher_order_function</span><span class="p">(</span><span class="n">equations</span><span class="o">=</span><span class="n">meas_eqs</span><span class="p">,</span><span class="n">syms</span><span class="o">=</span><span class="n">meas_syms</span><span class="p">,</span>
                                                          <span class="n">params</span><span class="o">=</span><span class="n">meas_params</span><span class="p">,</span><span class="n">syms_exog</span><span class="o">=</span><span class="n">syms_exog</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
                                                          <span class="n">function_name</span><span class="o">=</span><span class="s1">&#39;f_measurement&#39;</span><span class="p">,</span><span class="n">out</span><span class="o">=</span><span class="s1">&#39;f_measurement&#39;</span><span class="p">,</span>
                                                          <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">log_variables</span><span class="o">=</span><span class="n">logv</span><span class="p">)</span>
            <span class="n">f_measurement</span> <span class="o">=</span> <span class="n">f_measurement</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fc</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">False</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_measurement</span> <span class="o">=</span> <span class="kc">None</span>
                
     
        <span class="c1"># Right-hand-side of equations</span>
        <span class="n">b</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Compile right-hand-side equations </span>
        <span class="n">rhs_eqs</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">getRHS</span><span class="p">(</span><span class="n">eqs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span><span class="n">variables</span><span class="o">=</span><span class="n">vv</span><span class="p">,</span><span class="n">eqLabels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eqLabels</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        <span class="n">f_rhs</span><span class="p">,</span><span class="n">txt_rhs</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">src_rhs</span> <span class="o">=</span> <span class="n">compile_higher_order_function</span><span class="p">(</span><span class="n">equations</span><span class="o">=</span><span class="n">rhs_eqs</span><span class="p">,</span><span class="n">syms</span><span class="o">=</span><span class="n">syms</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span><span class="n">syms_exog</span><span class="o">=</span><span class="n">syms_exog</span><span class="p">,</span>
                                                                    <span class="n">eq_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_vars</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">function_name</span><span class="o">=</span><span class="s1">&#39;f_rhs&#39;</span><span class="p">,</span>
                                                                    <span class="n">out</span><span class="o">=</span><span class="s1">&#39;f_rhs&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">log_variables</span><span class="o">=</span><span class="p">[])</span>
            
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autodiff</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">jaxdiff</span><span class="p">:</span>
            
            <span class="c1"># Constructs arguments of function f(y(1),y,y(-1),p)</span>
            <span class="n">endog</span> <span class="o">=</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">v</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">]</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_lag_shock</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">max_lead_shock</span><span class="p">):</span>
                <span class="n">endog</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shocks</span><span class="p">]</span>
                
            <span class="n">func</span><span class="p">,</span><span class="n">txt_dynamic</span> <span class="o">=</span> <span class="n">compile_function</span><span class="p">(</span><span class="n">eqs</span><span class="p">,</span><span class="n">syms</span><span class="o">=</span><span class="n">endog</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span><span class="n">syms_exog</span><span class="o">=</span><span class="n">syms_exog</span><span class="p">,</span><span class="n">log_variables</span><span class="o">=</span><span class="n">logv</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">f_dynamic</span> <span class="o">=</span> <span class="n">f_steady</span> <span class="o">=</span> <span class="n">f_sparse</span> <span class="o">=</span> <span class="n">txt_sparse</span> <span class="o">=</span> <span class="n">src_ss</span> <span class="o">=</span> <span class="n">src_ss_jacob</span> <span class="o">=</span> <span class="kc">None</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bSparse</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">snowdrop.src.preprocessor.function_compiler_sympy</span> <span class="kn">import</span> <span class="n">get_indices</span>
                <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.solver</span> <span class="kn">import</span> <span class="n">LBJax</span>
                <span class="c1">#ind = get_indices(eqs,syms=endog)</span>
                <span class="n">LBJax</span><span class="o">.</span><span class="n">row_ind</span><span class="p">,</span> <span class="n">LBJax</span><span class="o">.</span><span class="n">col_ind</span> <span class="o">=</span> <span class="n">get_indices</span><span class="p">(</span><span class="n">eqs</span><span class="p">,</span><span class="n">syms</span><span class="o">=</span><span class="n">endog</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autodiff</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">autograd</span> <span class="kn">import</span> <span class="n">jacobian</span><span class="p">,</span><span class="n">hessian</span>  
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">f_jacob</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">f_hessian</span> <span class="o">=</span> <span class="n">hessian</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">f_tensor</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">hessian</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">jaxdiff</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jacobian</span><span class="p">,</span><span class="n">hessian</span><span class="p">,</span><span class="n">jit</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">f_jacob</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">jacobian</span><span class="p">(</span><span class="n">func</span><span class="p">),</span><span class="n">backend</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">f_hessian</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">hessian</span><span class="p">(</span><span class="n">func</span><span class="p">),</span><span class="n">backend</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">f_tensor</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">jacobian</span><span class="p">(</span><span class="n">hessian</span><span class="p">),</span><span class="n">backend</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
                <span class="n">func</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">backend</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="kc">True</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">bSparse</span><span class="p">:</span>
                <span class="c1"># Compile dynamic function and compute its partial derivatives  </span>
                <span class="n">f_sparse</span><span class="p">,</span><span class="n">txt_sparse</span><span class="p">,</span><span class="n">txt_der</span><span class="p">,</span><span class="n">txt_der2</span><span class="p">,</span><span class="n">txt_der3</span><span class="p">,</span><span class="n">src_sparse</span> <span class="o">=</span> <span class="n">compile_higher_order_function</span><span class="p">(</span>
                        <span class="n">equations</span><span class="o">=</span><span class="n">eqs</span><span class="p">,</span><span class="n">syms</span><span class="o">=</span><span class="n">syms</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span><span class="n">syms_exog</span><span class="o">=</span><span class="n">syms_exog</span><span class="p">,</span><span class="n">eq_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_vars</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
                        <span class="n">function_name</span><span class="o">=</span><span class="s1">&#39;f_sparse&#39;</span><span class="p">,</span><span class="n">out</span><span class="o">=</span><span class="s1">&#39;f_sparse&#39;</span><span class="p">,</span><span class="n">bSparse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">log_variables</span><span class="o">=</span><span class="n">logv</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f_sparse</span> <span class="o">=</span> <span class="n">txt_sparse</span> <span class="o">=</span> <span class="n">src_sparse</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Compile dynamic function and compute its partial derivatives  </span>
            <span class="n">f_dynamic</span><span class="p">,</span><span class="n">txt_dynamic</span><span class="p">,</span><span class="n">txt_der</span><span class="p">,</span><span class="n">txt_der2</span><span class="p">,</span><span class="n">txt_der3</span><span class="p">,</span><span class="n">src_dynamic</span> <span class="o">=</span> <span class="n">compile_higher_order_function</span><span class="p">(</span>
                    <span class="n">equations</span><span class="o">=</span><span class="n">eqs</span><span class="p">,</span><span class="n">syms</span><span class="o">=</span><span class="n">syms</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span><span class="n">syms_exog</span><span class="o">=</span><span class="n">syms_exog</span><span class="p">,</span><span class="n">eq_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_vars</span><span class="p">,</span>
                    <span class="n">order</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">,</span><span class="n">function_name</span><span class="o">=</span><span class="s1">&#39;f_dynamic&#39;</span><span class="p">,</span><span class="n">out</span><span class="o">=</span><span class="s1">&#39;f_dynamic&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span>
                    <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">log_variables</span><span class="o">=</span><span class="n">logv</span><span class="p">)</span>

            <span class="c1"># Compile steady-state function</span>
            <span class="n">f_steady</span><span class="p">,</span><span class="n">src_ss</span> <span class="o">=</span> <span class="n">compile_function</span><span class="p">(</span>
                <span class="n">equations</span><span class="o">=</span><span class="n">steady_state_eqs</span><span class="p">,</span><span class="n">syms</span><span class="o">=</span><span class="n">syms_ss</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span><span class="n">syms_exog</span><span class="o">=</span><span class="n">syms_exog_ss</span><span class="p">,</span>
                <span class="n">eq_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_vars</span><span class="p">,</span><span class="n">function_name</span><span class="o">=</span><span class="s1">&#39;f_steady&#39;</span><span class="p">,</span><span class="n">out</span><span class="o">=</span><span class="s1">&#39;f_steady&#39;</span><span class="p">,</span>
                <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">log_variables</span><span class="o">=</span><span class="n">logv</span><span class="p">)</span>
            
            <span class="c1"># Compile partial derivatives of steady-state function            </span>
            <span class="n">f_jacob</span><span class="p">,</span><span class="n">src_ss_jacob</span> <span class="o">=</span> <span class="n">compile_jacobian</span><span class="p">(</span>
                <span class="n">equations</span><span class="o">=</span><span class="n">steady_state_eqs</span><span class="p">,</span><span class="n">syms</span><span class="o">=</span><span class="n">syms_ss</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span><span class="n">syms_exog</span><span class="o">=</span><span class="n">syms_exog</span><span class="p">,</span>
                <span class="n">eq_vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eq_vars</span><span class="p">,</span><span class="n">function_name</span><span class="o">=</span><span class="s1">&#39;f_jacob&#39;</span><span class="p">,</span><span class="n">out</span><span class="o">=</span><span class="s1">&#39;f_jacob&#39;</span><span class="p">,</span>
                <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span><span class="n">log_variables</span><span class="o">=</span><span class="n">logv</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f_static</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.solver.util</span> <span class="kn">import</span> <span class="n">getExogenousData</span>
            
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>          
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_lag_shock</span><span class="p">,</span><span class="n">max_lead_shock</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">x</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">])</span> 
            
            <span class="c1"># Get exogenous time series</span>
            <span class="n">exog</span> <span class="o">=</span> <span class="n">getExogenousData</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    
            <span class="n">bHasAttr</span>  <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f_dynamic</span><span class="p">,</span><span class="s2">&quot;py_func&quot;</span><span class="p">)</span>   
            <span class="k">if</span> <span class="n">bHasAttr</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f_dynamic</span><span class="o">.</span><span class="n">py_func</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f_dynamic</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">exog</span><span class="o">=</span><span class="n">exog</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
            <span class="k">return</span> <span class="n">f</span>
        
        <span class="n">functions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;f_static&#39;</span><span class="p">:</span>       <span class="n">f_static</span><span class="p">,</span>
            <span class="s1">&#39;f_dynamic&#39;</span><span class="p">:</span>      <span class="n">f_dynamic</span><span class="p">,</span>
            <span class="s1">&#39;f_sparse&#39;</span><span class="p">:</span>       <span class="n">f_sparse</span><span class="p">,</span>
            <span class="s1">&#39;f_steady&#39;</span><span class="p">:</span>       <span class="n">f_steady</span><span class="p">,</span>
            <span class="s1">&#39;f_jacob&#39;</span><span class="p">:</span>        <span class="n">f_jacob</span><span class="p">,</span>
            <span class="s1">&#39;f_hessian&#39;</span><span class="p">:</span>      <span class="n">f_hessian</span><span class="p">,</span>
            <span class="s1">&#39;f_tensor&#39;</span><span class="p">:</span>       <span class="n">f_tensor</span><span class="p">,</span>
            <span class="s1">&#39;f_rhs&#39;</span><span class="p">:</span>          <span class="n">f_rhs</span><span class="p">,</span>
            <span class="s1">&#39;f_measurement&#39;</span><span class="p">:</span>  <span class="n">f_measurement</span><span class="p">,</span>
            <span class="s1">&#39;func&#39;</span><span class="p">:</span>           <span class="n">func</span>
        <span class="p">}</span>
        
        <span class="n">functions_src</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;f_dynamic_txt&#39;</span><span class="p">:</span> <span class="n">txt_dynamic</span><span class="p">,</span>
            <span class="s1">&#39;f_dynamic_src&#39;</span><span class="p">:</span> <span class="n">src_dynamic</span><span class="p">,</span>
            <span class="s1">&#39;f_sparse_txt&#39;</span><span class="p">:</span>  <span class="n">txt_sparse</span><span class="p">,</span>
            <span class="s1">&#39;f_sparse_src&#39;</span><span class="p">:</span>  <span class="n">src_sparse</span><span class="p">,</span>
            <span class="s1">&#39;f_steady_src&#39;</span><span class="p">:</span>  <span class="n">src_ss</span><span class="p">,</span>
            <span class="s1">&#39;f_jacob_src&#39;</span><span class="p">:</span>   <span class="n">src_ss_jacob</span><span class="p">,</span>
            <span class="s1">&#39;f_rhs_src&#39;</span><span class="p">:</span>     <span class="n">src_rhs</span>
        <span class="p">}</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="n">functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">functions_src</span> <span class="o">=</span> <span class="n">functions_src</span>
        <span class="k">return</span>


<div class="viewcode-block" id="Model.condition">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.condition">[docs]</a>
    <span class="k">def</span> <span class="nf">condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mapCond</span><span class="p">,</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set conditional shocks.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Parameter.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            :param mapCond: Dictionary of conditional shocks.</span>
<span class="sd">            :type mapCond: dict.</span>
<span class="sd">            :param reset: Flag to reset model swap dictionary.</span>
<span class="sd">            :type reset: bool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reset</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">condShocks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">condShocks</span> <span class="o">=</span> <span class="p">{}</span>
            
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">condShocks</span>
        <span class="n">n_range</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_range</span><span class="p">)</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">mapCond</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">var_names</span><span class="p">:</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">var_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">ts</span> <span class="o">=</span> <span class="n">mapCond</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">t</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_range</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_range</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">x1</span> <span class="ow">and</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">x2</span><span class="p">:</span>
                            <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">period</span> <span class="o">=</span> <span class="n">i</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">b</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">ind</span><span class="p">,</span><span class="n">v</span><span class="p">)]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ind</span><span class="p">,</span><span class="n">v</span><span class="p">)]</span>
                        <span class="n">m</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">condShocks</span> <span class="o">=</span> <span class="n">m</span></div>

        

<div class="viewcode-block" id="Model.swap">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.swap">[docs]</a>
    <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">var1</span><span class="p">,</span><span class="n">var2</span><span class="p">,</span><span class="n">val1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">val2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">delta1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">delta2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Swap variables, i.e. exogenize variable var1 and endogenize variable var2.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Parameter.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            :param var1: Endogenous variable.</span>
<span class="sd">            :type var1: str or list of str or dict.</span>
<span class="sd">            :param var2: Exogenous variable.</span>
<span class="sd">            :type var2: str or list of str.</span>
<span class="sd">            :param val1: New value of exogenized variable.</span>
<span class="sd">            :type val1: float or pandas.Series.</span>
<span class="sd">            :param val2: New value of endogenized variable.</span>
<span class="sd">            :type val2: float.</span>
<span class="sd">            :param delta1: New value of exogenized variable is the value of edogenized variable plus delta1.</span>
<span class="sd">            :type delta1: float.</span>
<span class="sd">            :param delta2: New value of endogenized variable is the value of exogenized variable plus delta2.</span>
<span class="sd">            :type delta2: float.</span>
<span class="sd">            :param rng: Simulation range or a date.</span>
<span class="sd">            :type rng: list of datetime.</span>
<span class="sd">            :param reset: Flag to reset model swap dictionary.</span>
<span class="sd">            :type reset: bool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">simulationRange</span>
        
        <span class="n">simulationRange</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__swap__</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span><span class="n">var2</span><span class="p">,</span><span class="n">val1</span><span class="p">,</span><span class="n">val2</span><span class="p">,</span><span class="n">delta1</span><span class="p">,</span><span class="n">delta2</span><span class="p">,</span><span class="n">rng</span><span class="p">)</span>
        
        <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">total_nmbr_shocks</span> <span class="o">=</span> <span class="n">size</span>
        
        <span class="k">return</span></div>

                
        
    <span class="k">def</span> <span class="nf">__swap__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">var1</span><span class="p">,</span><span class="n">var2</span><span class="p">,</span><span class="n">val1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">val2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">delta1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">delta2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Swap variables with their shocks (a.k.a. exogenizes variable var1 and endogenizes variable var2).</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Parameter.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            :param var1: Endogenous variable.</span>
<span class="sd">            :type var1: str or list of str or dict.</span>
<span class="sd">            :param var2: Exogenous variable.</span>
<span class="sd">            :type var2: str or list of str.</span>
<span class="sd">            :param val1: New value of exogenized variable.</span>
<span class="sd">            :type val1: float or pandas.Series.</span>
<span class="sd">            :param val2: New value of endogenized variable.</span>
<span class="sd">            :type val2: float.</span>
<span class="sd">            :param delta1: New value of exogenized variable is the value of edogenized variable plus delta1.</span>
<span class="sd">            :type delta1: float.</span>
<span class="sd">            :param delta2: New value of endogenized variable is the value of exogenized variable plus delta2.</span>
<span class="sd">            :type delta2: float.</span>
<span class="sd">            :param rng: Simulation range or a date.</span>
<span class="sd">            :type rng: list of datetime.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span><span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">sz1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
            <span class="n">sz2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var2</span><span class="p">):</span>
                <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Length of exogenized/endogenized variables </span><span class="si">{0}</span><span class="s2"> - </span><span class="si">{1}</span><span class="s2"> and </span><span class="si">{2}</span><span class="s2"> - </span><span class="si">{3}</span><span class="s2"> is different...  Skipping swap!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">var1</span><span class="p">),</span><span class="n">sz1</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">var2</span><span class="p">),</span><span class="n">sz2</span><span class="p">),</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="k">return</span>  
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> 
            <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">var1</span><span class="p">:</span>
                <span class="n">val1</span> <span class="o">=</span> <span class="n">var1</span><span class="p">[</span><span class="n">v1</span><span class="p">]</span>
                <span class="n">v2</span> <span class="o">=</span> <span class="n">var2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__swap__</span><span class="p">(</span><span class="n">var1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">var2</span><span class="o">=</span><span class="n">v2</span><span class="p">,</span><span class="n">val1</span><span class="o">=</span><span class="n">val1</span><span class="p">,</span><span class="n">val2</span><span class="o">=</span><span class="n">v2</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__swap__</span><span class="p">(</span><span class="n">var1</span><span class="o">=</span><span class="n">var1</span><span class="p">,</span><span class="n">var2</span><span class="o">=</span><span class="n">var2</span><span class="p">,</span><span class="n">val1</span><span class="o">=</span><span class="n">val1</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="n">val1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">sz1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
            <span class="n">sz2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Length of exogenized/endogenized variables </span><span class="si">{0}</span><span class="s2">:</span><span class="si">{1}</span><span class="s2"> and </span><span class="si">{2}</span><span class="s2">:</span><span class="si">{3}</span><span class="s2"> is different...  Skipping swap!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span><span class="n">sz1</span><span class="p">,</span><span class="n">var2</span><span class="p">,</span><span class="n">sz2</span><span class="p">),</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var1</span><span class="p">):</span>
                <span class="n">x2</span> <span class="o">=</span> <span class="n">var2</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">val1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">val1</span><span class="p">):</span>
                    <span class="n">v1</span> <span class="o">=</span> <span class="n">val1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v1</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">val2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val2</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">val2</span><span class="p">):</span>
                    <span class="n">v2</span> <span class="o">=</span> <span class="n">val2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v2</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">delta1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delta1</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">delta1</span><span class="p">):</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="n">delta1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d1</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">delta2</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delta2</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">delta2</span><span class="p">):</span>
                    <span class="n">d2</span> <span class="o">=</span> <span class="n">delta2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d2</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__swap__</span><span class="p">(</span><span class="n">var1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span><span class="n">var2</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span><span class="n">val1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">val2</span><span class="o">=</span><span class="n">v2</span><span class="p">,</span><span class="n">delta1</span><span class="o">=</span><span class="n">d1</span><span class="p">,</span><span class="n">delta2</span><span class="o">=</span><span class="n">d2</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var2</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">val1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__swap__</span><span class="p">(</span><span class="n">var1</span><span class="o">=</span><span class="n">var1</span><span class="p">,</span><span class="n">var2</span><span class="o">=</span><span class="n">var2</span><span class="p">,</span><span class="n">val1</span><span class="o">=</span><span class="n">v1</span><span class="p">,</span><span class="n">rng</span><span class="o">=</span><span class="n">rng</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">var1</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
                <span class="n">ind0</span> <span class="o">=</span> <span class="n">variables</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">var1</span> <span class="ow">in</span> <span class="n">lst1</span><span class="p">:</span>
                    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Swap: Variable &#39;</span><span class="si">{}</span><span class="s2">&#39; is not in the list of variables&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var1</span><span class="p">),</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="n">lst1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqLabels</span>
            <span class="k">if</span> <span class="n">var1</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
                <span class="n">ind1</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ind1</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">var1</span> <span class="ow">in</span> <span class="n">lst2</span><span class="p">:</span>
                    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Swap: Variable &#39;</span><span class="si">{}</span><span class="s2">&#39; is not in the list of equations labels&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var1</span><span class="p">),</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="n">lst2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
            <span class="n">shocks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;shocks&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">var2</span> <span class="ow">in</span> <span class="n">shocks</span><span class="p">:</span>
                <span class="n">ind2</span> <span class="o">=</span> <span class="n">shocks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">var2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ind2</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">var1</span> <span class="ow">in</span> <span class="n">lst3</span><span class="p">:</span>
                    <span class="n">cprint</span><span class="p">(</span><span class="s2">&quot;Swap: Variable &#39;</span><span class="si">{}</span><span class="s2">&#39; is not in the list of shocks&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var2</span><span class="p">),</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="n">lst3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">delta1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="n">var2</span><span class="p">]</span>
                <span class="n">val1</span> <span class="o">=</span> <span class="n">val</span><span class="o">+</span><span class="n">delta1</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">val1</span><span class="p">):</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">delta2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="n">var1</span><span class="p">]</span>
                <span class="n">val2</span> <span class="o">=</span> <span class="n">val</span><span class="o">+</span><span class="n">delta2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="n">period</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">b</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">n_range</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_range</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rng</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">period</span> <span class="o">=</span> <span class="n">n_range</span><span class="o">-</span><span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_range</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">x1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_range</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_range</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">rng</span> <span class="o">&gt;=</span> <span class="n">x1</span> <span class="ow">and</span> <span class="n">rng</span> <span class="o">&lt;</span> <span class="n">x2</span><span class="p">:</span>
                            <span class="n">b</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">period</span> <span class="o">=</span> <span class="n">i</span>
                            <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
                <span class="n">period</span> <span class="o">=</span> <span class="n">rng</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">period</span> <span class="o">=</span> <span class="n">rng</span>
            <span class="k">if</span> <span class="n">period</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[(</span><span class="n">ind0</span><span class="p">,</span><span class="n">ind1</span><span class="p">,</span><span class="n">val1</span><span class="p">,</span><span class="n">ind2</span><span class="p">,</span><span class="n">val2</span><span class="p">)]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">ind0</span><span class="p">,</span><span class="n">ind1</span><span class="p">,</span><span class="n">val1</span><span class="p">,</span><span class="n">ind2</span><span class="p">,</span><span class="n">val2</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span><span class="p">[</span><span class="n">period</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ind0</span><span class="p">,</span><span class="n">ind1</span><span class="p">,</span><span class="n">val1</span><span class="p">,</span><span class="n">ind2</span><span class="p">,</span><span class="n">val2</span><span class="p">)]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapSwap</span>
       
        
<div class="viewcode-block" id="Model.flip">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.flip">[docs]</a>
    <span class="k">def</span> <span class="nf">flip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">endogVariables</span><span class="p">,</span><span class="n">exogVariables</span><span class="p">,</span><span class="n">bParams</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flip endogenous variables with their exogenous counterparts.</span>
<span class="sd">        </span>
<span class="sd">        .. note:: This method is in DEVELOPMENT stage and needs testing.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: instance of Model.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            :param endogVariables: Endogenous variables to be flipped.</span>
<span class="sd">            :type endogVariables: list.</span>
<span class="sd">            :param exogVariables: Exogenous (shock) variables or parameters to be flipped.  </span>
<span class="sd">            :type exogVariables: list.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">endogVariables</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">endogVariables</span> <span class="o">=</span> <span class="p">[</span><span class="n">endogVariables</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exogVariables</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">exogVariables</span> <span class="o">=</span> <span class="p">[</span><span class="n">exogVariables</span><span class="p">]</span>
            
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">endogVariables</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">exogVariables</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Number of endogenous variables </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">endogVariables</span><span class="p">)</span><span class="si">}</span><span class="s2"> and exogenous variables </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">exogVariables</span><span class="p">)</span><span class="si">}</span><span class="s2"> is different!&quot;</span>
        
        <span class="k">if</span> <span class="n">bParams</span><span class="p">:</span>
            <span class="n">variables_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;endogenous&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">exog_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">variables_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">exog_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;shocks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">nv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span>
        <span class="n">ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span>
        
        <span class="c1"># Treat wildcards - replace astericks with the names of endogenous variables</span>
        <span class="n">arr_variables</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">arr1</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">swapped_endog</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">endogVariables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                <span class="n">arr_variables</span> <span class="o">+=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables_names</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arr_variables</span><span class="p">]</span>
                <span class="n">swapped_endog</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arr_variables</span><span class="p">)</span>
                <span class="n">arr1</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arr_variables</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">swapped_endog</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">arr1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
        <span class="n">swapped_endog</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">swapped_endog</span><span class="p">)</span>
           
        <span class="c1"># Treat wildcards - replace astericks with the names of exoogenous variables or parameters names</span>
        <span class="n">arr_shocks</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">arr2</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">swapped_exog</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">exogVariables</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                <span class="n">arr_shocks</span> <span class="o">+=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">exog_names</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arr_shocks</span><span class="p">]</span>
                <span class="n">swapped_exog</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arr_shocks</span><span class="p">)</span>
                <span class="n">arr2</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">arr_shocks</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">swapped_exog</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">arr2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
        <span class="n">swapped_exog</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">swapped_exog</span><span class="p">)</span>
                
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">swapped_endog</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">swapped_exog</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Number of swapped endogenous </span><span class="si">{</span><span class="n">swapped_endog</span><span class="si">}</span><span class="s2"> and exogenous variables </span><span class="si">{</span><span class="n">swapped_exog</span><span class="si">}</span><span class="s2"> have different number of elements and cannot be swapped!&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">flippedEndogVariables</span> <span class="o">=</span> <span class="n">swapped_endog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flippedExogVariables</span> <span class="o">=</span> <span class="n">swapped_exog</span>
        
        <span class="c1"># Order of variables in partial derivatives matrix: lead, current, lag variables (i+nv,i,i-nv)</span>
        <span class="c1"># order of shocks in partial derivatives matrix: lag, current, lead shocks (i-ns,i,i+ns)</span>
        <span class="c1"># Mapping: i-nv -&gt; i+ns; i -&gt; i; i+nv -&gt; i-ns</span>
        <span class="k">if</span> <span class="n">bParams</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedEndogVariables</span> <span class="o">=</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedExogVariables</span>  <span class="o">=</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lead_shock</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_lag_shock</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedEndogVariables</span> <span class="o">=</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">nv</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedExogVariables</span>  <span class="o">=</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>
                
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lead_shock</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_lag_shock</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>        
                <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedEndogVariables</span> <span class="o">=</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nv</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span>   \
                                                  <span class="o">+</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">nv</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedExogVariables</span>  <span class="o">=</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>    \
                                                  <span class="o">+</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">ns</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>
                
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lead_shock</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_lag_shock</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>   
                <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedEndogVariables</span> <span class="o">=</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span>     \
                                                  <span class="o">+</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">nv</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span>        
                <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedExogVariables</span>  <span class="o">=</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">ns</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>      \
                                                  <span class="o">+</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>
                                              
            <span class="k">else</span><span class="p">:</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedEndogVariables</span> <span class="o">=</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span>     \
                                                  <span class="o">+</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">nv</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span>   \
                                                  <span class="o">+</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nv</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">variables_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_endog</span><span class="p">]</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">indexOfFlippedExogVariables</span>  <span class="o">=</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">ns</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>    \
                                                  <span class="o">+</span>  <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">ns</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>      \
                                                  <span class="o">+</span>  <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">exog_names</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">swapped_exog</span><span class="p">]</span>
        
        <span class="c1">#cprint(f&quot;Endogenus variable(s)\n{&#39;,&#39;.join(swapped_endog)} \nwere flipped with exogenous variable(s)\n{&#39;,&#39;.join(swapped_exog)}\n&quot;,&quot;blue&quot;)</span>
            
        <span class="k">return</span>   </div>

    

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Represent Model class object as a string.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.utils.util</span> <span class="kn">import</span> <span class="n">findVariableLead</span><span class="p">,</span><span class="n">findVariableLag</span>
        <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span>
        <span class="kn">import</span> <span class="nn">re</span>
        
        <span class="n">delimiters</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;)&quot;</span>
        <span class="n">regexPattern</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">,</span> <span class="n">delimiters</span><span class="p">))</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Model:</span>
<span class="s1">------</span>
<span class="s1">name: &quot;</span><span class="si">{name}</span><span class="s1">&quot;</span>
<span class="s1">file: &quot;</span><span class="si">{filename}</span><span class="se">\n</span><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">infos</span><span class="p">)</span>


        <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLinear</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">=</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Linear Model</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;underline&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>        	
                <span class="n">ss</span> <span class="o">=</span> <span class="n">colored</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Non-Linear Model</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">attrs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;underline&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            
        <span class="n">meas_eqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">measurement_equations</span>
        <span class="k">if</span> <span class="n">meas_eqs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meas_eqs</span> <span class="o">=</span> <span class="p">[]</span>
         
        <span class="n">numberOfNewEqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numberOfNewEqs</span>
        <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Transition Equations:</span><span class="se">\n</span><span class="s1">---------------------</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">()</span>
        <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;definitions&#39;</span><span class="p">:</span> <span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)})</span>

        <span class="n">equations</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;equations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">copy</span><span class="p">()}</span>
        <span class="n">definitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">definitions</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">deftype</span> <span class="ow">in</span> <span class="n">definitions</span><span class="p">:</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deftype</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="n">definitions</span><span class="p">[</span><span class="n">deftype</span><span class="p">])</span>
        <span class="n">definitions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;definitions&#39;</span><span class="p">:</span> <span class="n">tmp</span><span class="p">}</span>
        <span class="n">equations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">definitions</span><span class="p">)</span>
        <span class="c1"># for eqgroup, eqlist in self.symbolic.equations.items():</span>
        <span class="k">for</span> <span class="n">eqgroup</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">eqgroup</span> <span class="o">==</span> <span class="s1">&#39;equations&#39;</span><span class="p">:</span>
                <span class="n">eqlist</span> <span class="o">=</span> <span class="n">equations</span>
            <span class="k">if</span> <span class="n">eqgroup</span> <span class="o">==</span> <span class="s1">&#39;definitions&#39;</span><span class="p">:</span>
                <span class="n">eqlist</span> <span class="o">=</span> <span class="n">equations</span><span class="p">[</span><span class="n">eqgroup</span><span class="p">]</span>
                <span class="c1"># Update the residuals section with the right number of empty</span>
                <span class="c1"># values. Note: adding &#39;zeros&#39; was easiest (rather than empty</span>
                <span class="c1"># cells), since other variable types have  arrays of zeros.</span>
                <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;definitions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">eqlist</span><span class="p">))]})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eqlist</span> <span class="o">=</span> <span class="n">equations</span><span class="p">[</span><span class="n">eqgroup</span><span class="p">]</span>
            <span class="c1">#ss += u&quot;{}\n&quot;.format(eqgroup)</span>
            <span class="n">eqLabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqLabels</span>
            <span class="n">neq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">eqlist</span><span class="p">)</span> <span class="o">-</span> <span class="n">numberOfNewEqs</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">eq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">eqlist</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">neq</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">eqLabels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">eqLabels</span><span class="p">):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">eqLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="n">val</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">eqgroup</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">regexPattern</span><span class="p">,</span><span class="n">eq</span><span class="p">)</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="n">arr</span><span class="p">))</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">eq</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">endog</span><span class="p">:</span>
                        <span class="n">ind</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                        <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">ind</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">):]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;)&quot;</span> <span class="ow">in</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">ind</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
                            <span class="n">vv</span> <span class="o">=</span> <span class="n">v</span> <span class="o">+</span> <span class="n">e</span><span class="p">[:</span><span class="mi">1</span><span class="o">+</span><span class="n">ind</span><span class="p">]</span>
                            <span class="k">if</span> <span class="s2">&quot;_plus_&quot;</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">:</span>
                                <span class="n">lead</span> <span class="o">=</span> <span class="n">findVariableLead</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                                <span class="n">ind</span> <span class="o">=</span> <span class="n">vv</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;_plus&quot;</span><span class="p">)</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lead</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="s2">&quot;_minus_&quot;</span>  <span class="ow">in</span> <span class="n">vv</span><span class="p">:</span>
                                <span class="n">lag</span>  <span class="o">=</span> <span class="n">findVariableLag</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                                <span class="n">ind</span> <span class="o">=</span> <span class="n">vv</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;_minus&quot;</span><span class="p">)</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[:</span><span class="n">ind</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
                                <span class="n">eq</span> <span class="o">=</span> <span class="n">eq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">vv</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">objective_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
                    <span class="n">ss</span> <span class="o">+=</span> <span class="sa">u</span><span class="s2">&quot; </span><span class="si">{label:4}</span><span class="s2"> :  </span><span class="si">{eqn}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">eqn</span><span class="o">=</span><span class="n">eq</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:6.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">:</span>
                        <span class="n">vals</span> <span class="o">=</span> <span class="n">colored</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vals</span> <span class="o">=</span> <span class="n">colored</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">ss</span> <span class="o">+=</span> <span class="sa">u</span><span class="s2">&quot; </span><span class="si">{lbl:2}</span><span class="se">\t</span><span class="si">{vals:6}</span><span class="s2"> :  </span><span class="si">{eqn}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lbl</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span><span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span><span class="n">eqn</span><span class="o">=</span><span class="n">eq</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ss</span> <span class="o">+=</span> <span class="sa">u</span><span class="s2">&quot; </span><span class="si">{label:2}</span><span class="se">\t</span><span class="si">{vals:6}</span><span class="s2"> :  </span><span class="si">{eqn}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span><span class="n">eqn</span><span class="o">=</span><span class="n">eq</span><span class="p">)</span>
                        
            <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">measurement_equations</span><span class="p">):</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Measurement Equations:</span><span class="se">\n</span><span class="s1">----------------------</span><span class="se">\n\n</span><span class="s1">&#39;</span> 
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">eq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">measurement_equations</span><span class="p">):</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="sa">u</span><span class="s2">&quot; </span><span class="si">{eqn:2}</span><span class="s2">  :  </span><span class="si">{eqs}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eqn</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">eqs</span><span class="o">=</span><span class="n">eq</span><span class="p">)</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">FILTER</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">measurement_equations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;Kalman Filter: </span><span class="si">{Filter}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Filter</span><span class="o">=</span><span class="n">colored</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FILTER</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">SMOOTHER</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;Kalman Smoother: </span><span class="si">{Smoother}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Smoother</span><span class="o">=</span><span class="n">colored</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SMOOTHER</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;No Kalman Smoother.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">INIT_COND_CORRECTION</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;Method to initialize the error covariance matrix: </span><span class="si">{Prior}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Prior</span><span class="o">=</span><span class="n">colored</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INIT_COND_CORRECTION</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">PRIOR</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;Method to initialize the error covariance matrix: </span><span class="si">{Prior}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Prior</span><span class="o">=</span><span class="n">colored</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PRIOR</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;No transformation of the error covariance matrix.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;Initial condition of endogenous variables: </span><span class="si">{initCond}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initCond</span><span class="o">=</span><span class="n">colored</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INITIAL_CONDITION</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="s2">&quot;Initial values of endogenous variables are set in a model file.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="nb">print</span> <span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">priors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;Prior distribution of parameters:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">priors</span><span class="p">:</span>
                <span class="n">distr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">priors</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;distribution&#39;</span><span class="p">]</span>
                <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">priors</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
                <span class="n">init_val</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">lb</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ub</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">prior_params</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">distr</span><span class="si">}</span><span class="s2">, val=</span><span class="si">{</span><span class="n">init_val</span><span class="si">}</span><span class="s2">, lb=</span><span class="si">{</span><span class="n">lb</span><span class="si">}</span><span class="s2">, ub=</span><span class="si">{</span><span class="n">ub</span><span class="si">}</span><span class="s2">, prior parameters=</span><span class="si">{</span><span class="n">prior_params</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="n">colored</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sampling algorithm: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">SAMPLING_ALGORITHM</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            
        <span class="c1"># Print parameters and variables starting values</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">,</span><span class="s2">&quot;METHOD&quot;</span><span class="p">):</span>
            <span class="n">var_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
            <span class="n">var_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Variables Starting Values: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">var_names</span><span class="p">,</span><span class="n">var_values</span><span class="p">):</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                
            <span class="n">par_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
            <span class="n">par_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Parameters: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">par_names</span><span class="p">,</span><span class="n">par_values</span><span class="p">):</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">objective_function</span><span class="p">):</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Objective Function: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;func = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">objective_function</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
          
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ss</span> <span class="o">+=</span> <span class="n">colored</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Constraints:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="c1">#ss += &quot;-&quot;*12 + &quot;\n&quot;</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.lt.&quot;</span><span class="p">,</span> <span class="s2">&quot; &lt; &quot;</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.le.&quot;</span><span class="p">,</span> <span class="s2">&quot; &lt;= &quot;</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.gt.&quot;</span><span class="p">,</span> <span class="s2">&quot; &gt; &quot;</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.ge.&quot;</span><span class="p">,</span> <span class="s2">&quot; &gt;= &quot;</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.eq.&quot;</span><span class="p">,</span> <span class="s2">&quot; = &quot;</span><span class="p">)</span>
                <span class="n">ss</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            
        <span class="n">s</span> <span class="o">+=</span> <span class="n">ss</span>

        <span class="k">return</span> <span class="n">s</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Official representation of Model class object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        HTML representation of Model class object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.misc.latex</span> <span class="kn">import</span> <span class="n">eq2tex</span>

        <span class="c1"># general informations</span>
        <span class="n">infos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infos</span>
        <span class="n">table_infos</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">     &lt;table&gt;</span>
<span class="s2">         &lt;td&gt;&lt;b&gt;Model&lt;/b&gt;&lt;/td&gt;</span>
<span class="s2">      &lt;tr&gt;</span>
<span class="s2">        &lt;td&gt;name&lt;/td&gt;</span>
<span class="s2">        &lt;td&gt;</span><span class="si">{name}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">      &lt;/tr&gt;</span>
<span class="s2">      &lt;tr&gt;</span>
<span class="s2">        &lt;td&gt;filename&lt;/td&gt;</span>
<span class="s2">        &lt;td&gt;</span><span class="si">{filename}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">      &lt;/tr&gt;</span>
<span class="s2">     &lt;/table&gt;&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">infos</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="n">filename</span><span class="o">=</span><span class="n">infos</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="s2">&quot;&amp;lt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span><span class="s2">&quot;&amp;gt&quot;</span><span class="p">))</span>


        <span class="c1"># Equations and residuals</span>
        <span class="n">resids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span><span class="p">()</span>
        <span class="n">equations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;equations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">equations</span><span class="o">.</span><span class="n">copy</span><span class="p">()}</span>
        <span class="c1"># Create definitions equations and append to equations dictionary</span>
        <span class="n">definitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="o">.</span><span class="n">definitions</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">deftype</span> <span class="ow">in</span> <span class="n">definitions</span><span class="p">:</span>
            <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deftype</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="n">definitions</span><span class="p">[</span><span class="n">deftype</span><span class="p">])</span>

        <span class="n">definitions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;definitions&#39;</span><span class="p">:</span> <span class="n">tmp</span><span class="p">}</span>
        <span class="n">equations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">definitions</span><span class="p">)</span>

        <span class="n">variables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span>
        <span class="n">table</span> <span class="o">=</span> <span class="s2">&quot;&lt;tr&gt;&lt;td&gt;&lt;b&gt;Type&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Equation&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Residual&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">for</span> <span class="n">eq_type</span> <span class="ow">in</span> <span class="n">equations</span><span class="p">:</span>

            <span class="n">eq_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">equations</span><span class="p">[</span><span class="n">eq_type</span><span class="p">])):</span>
                <span class="n">eq</span> <span class="o">=</span> <span class="n">equations</span><span class="p">[</span><span class="n">eq_type</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">resids</span><span class="p">[</span><span class="n">eq_type</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="s1">&#39;&lt;span style=&quot;color: red;&quot;&gt;</span><span class="si">{:.4f}</span><span class="s1">&lt;/span&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">vals</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;|&#39;</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
                    <span class="c1"># keep only lhs for now</span>
                    <span class="n">eq</span><span class="p">,</span> <span class="n">comp</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">eq2tex</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">eq</span><span class="p">)</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="s1">&#39;$</span><span class="si">{}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
                <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">lat</span><span class="p">,</span> <span class="n">vals</span><span class="p">]</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">eq_type</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="n">fmt_line</span> <span class="o">=</span> <span class="s1">&#39;&lt;tr&gt;&lt;td&gt;</span><span class="si">{}</span><span class="s1">&lt;/td&gt;&lt;td&gt;</span><span class="si">{}</span><span class="s1">&lt;/td&gt;&lt;td&gt;</span><span class="si">{}</span><span class="s1">&lt;/td&gt;&lt;/tr&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">line</span><span class="p">)</span>
        <span class="c1">#         print(fmt_line)</span>
                <span class="n">eq_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fmt_line</span><span class="p">)</span>
            <span class="n">table</span> <span class="o">+=</span> <span class="nb">str</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">eq_lines</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="s2">&quot;&lt;table&gt;</span><span class="si">{}</span><span class="s2">&lt;/table&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">table_infos</span> <span class="o">+</span> <span class="n">table</span>


<div class="viewcode-block" id="Model.residuals">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.residuals">[docs]</a>
    <span class="k">def</span> <span class="nf">residuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute residuals of model equations.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.solver.util</span> <span class="kn">import</span> <span class="n">getParameters</span>
     
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">getParameters</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;shocks&#39;</span><span class="p">]</span>  
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autodiff</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">jaxdiff</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s1">&#39;func&#39;</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">max_lead_shock</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">min_lag_shock</span>  
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">e</span><span class="p">])</span>
            <span class="n">bHasAttr</span>  <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="s1">&#39;py_func&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bHasAttr</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">py_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">[</span><span class="s1">&#39;f_static&#39;</span><span class="p">]</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
         
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;equations&#39;</span><span class="p">:</span> <span class="n">res</span><span class="p">}</span></div>

    
            
<div class="viewcode-block" id="Model.setStartingValues">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.setStartingValues">[docs]</a>
    <span class="k">def</span> <span class="nf">setStartingValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hist</span><span class="p">,</span><span class="n">skip_rows</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">bTreatMissingObs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set starting values for current and lagged endogenous variables.</span>
<span class="sd">            </span>
<span class="sd">        Parameters:</span>
<span class="sd">            :param self: Model object.</span>
<span class="sd">            :type self: `Model&#39;.</span>
<span class="sd">            :param hist: Path to historical data file or dictionary.</span>
<span class="sd">            :type hist: str or dict.</span>
<span class="sd">            :param skip_rows: The number of rows to skip.</span>
<span class="sd">            :type skip_rows: int.</span>
<span class="sd">            :param bTreatMissingObs: If True find missing variables values by minimizing residuals of steady state equations given the observations.</span>
<span class="sd">            :type bTreatMissingObs: bool.</span>
<span class="sd">            :param debug: If True print missing variables information.</span>
<span class="sd">            :type debug: bool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">itr</span>
        <span class="kn">from</span> <span class="nn">snowdrop.src.model.util</span> <span class="kn">import</span> <span class="n">getStartingValues</span>
    
        <span class="n">var_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span>
        <span class="n">var_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span>
        <span class="n">var_values</span><span class="p">,</span><span class="n">calib</span><span class="p">,</span><span class="n">missing</span> <span class="o">=</span> <span class="n">getStartingValues</span><span class="p">(</span><span class="n">hist</span><span class="o">=</span><span class="n">hist</span><span class="p">,</span><span class="n">var_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">,</span><span class="n">orig_var_values</span><span class="o">=</span><span class="n">var_values</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span><span class="n">skip_rows</span><span class="o">=</span><span class="n">skip_rows</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">bTreatMissingObs</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">snowdrop.src.numeric.filters.utils</span> <span class="kn">import</span> <span class="n">getMissingInitialVariables</span>
            <span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_names</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;_plus_&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;_minus_&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
            <span class="n">ind1</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_names</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;_plus_&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;_minus_&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="n">var_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var_names</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;_plus_&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;_minus_&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
            <span class="n">ind2</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">]</span>         
            <span class="n">values</span> <span class="o">=</span> <span class="n">getMissingInitialVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ind</span><span class="o">=</span><span class="n">ind2</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">)</span>
            <span class="n">var_values</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">var_values</span>    
        <span class="c1">#x = dict(zip(self.symbols[&quot;variables&quot;],var_values ))</span>
        <span class="k">return</span> </div>

    
<div class="viewcode-block" id="Model.setShocks">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.setShocks">[docs]</a>
    <span class="k">def</span> <span class="nf">setShocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set shocks values given the time of their appearance.</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">            model : self</span>
<span class="sd">                self object.</span>
<span class="sd">            d : dict</span>
<span class="sd">                Map of shock name and shock values.</span>
<span class="sd">            start : datetime.</span>
<span class="sd">                Start date of simulations.  Default is None.</span>
<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shock_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;shocks&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">reset</span><span class="p">:</span>
            <span class="n">shock_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shock_names</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="k">if</span> <span class="s2">&quot;shock_values&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
                <span class="n">shock_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;shock_values&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shock_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;shocks&quot;</span><span class="p">]</span>
           
        <span class="n">calib</span><span class="p">,</span><span class="n">startingDate</span><span class="p">,</span><span class="n">interval</span> <span class="o">=</span> <span class="n">setValues</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">shock_names</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">shock_values</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span><span class="n">isShock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>           
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;shocks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calib</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;shock_values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calib</span><span class="o">.</span><span class="n">T</span>
        
        <span class="n">n_shk</span><span class="p">,</span><span class="n">n_t</span> <span class="o">=</span> <span class="n">calib</span><span class="o">.</span><span class="n">shape</span>
        
        <span class="k">return</span></div>

    
        
<div class="viewcode-block" id="Model.setParameters">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.setParameters">[docs]</a>
    <span class="k">def</span> <span class="nf">setParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set parameters values given the time of their appearance.</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">            self : Model</span>
<span class="sd">                self object.</span>
<span class="sd">            d : dict</span>
<span class="sd">                Map of parameters name and parameters values.</span>
<span class="sd">            start : datetime.</span>
<span class="sd">                Start date of simulations.  Default is None.</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
        
        <span class="n">calib</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">setValues</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">param_names</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="n">param_values</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span><span class="n">isShock</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">calib</span></div>

        
            
<div class="viewcode-block" id="Model.setCalibration">
<a class="viewcode-back" href="../../../../source/snowdrop.src.model.html#snowdrop.src.model.model.Model.setCalibration">[docs]</a>
    <span class="k">def</span> <span class="nf">setCalibration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">param_name</span><span class="p">,</span><span class="n">param_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set calibration dictionary values given the time of their appearance.</span>
<span class="sd">    </span>
<span class="sd">        Args:</span>
<span class="sd">            self : Model</span>
<span class="sd">                self object.</span>
<span class="sd">            param_name : str</span>
<span class="sd">                Parameter name.</span>
<span class="sd">            param_value : numeric.</span>
<span class="sd">                Parameter value.</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">            None.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
        <span class="n">param_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">param_name</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">param_values</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">param_values</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param_values</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">+</span> <span class="n">param_value</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_values</span></div>
</div>


<span class="c1">### End of Model definition</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point.&quot;&quot;&quot;</span>
    
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">from</span> <span class="nn">snowdrop.src.model.factory</span> <span class="kn">import</span> <span class="n">import_model</span>
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;../../models/Toy/JLMP98.yaml&quot;</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">fname</span><span class="p">))</span>

    <span class="n">interface</span> <span class="o">=</span> <span class="n">import_model</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">return_interface</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">infos</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;JLMP98&#39;</span><span class="p">,</span>
        <span class="s1">&#39;filename&#39;</span> <span class="p">:</span> <span class="n">fpath</span>
    <span class="p">}</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">infos</span><span class="o">=</span><span class="n">infos</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    
    <span class="n">model</span><span class="o">.</span><span class="n">set_calibration</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="c1"># model.setCalibration(&#39;g&#39;, 0.5)</span>
    <span class="c1"># model.set_calibration({&#39;g&#39;: 0.5})</span>
    <span class="c1"># model.set_calibration({&#39;g&#39;: &#39;0.5&#39;})</span>
    <span class="c1"># model.set_calibration(g=0.5)</span>
    <span class="c1"># model.setParameters(dict) - set time changing parameters</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Parameters:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calibration</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Variables values:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">Python Platform</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../source/modules.html">snowdrop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../info.html">Python Platform</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Alexei Goumilevski.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>